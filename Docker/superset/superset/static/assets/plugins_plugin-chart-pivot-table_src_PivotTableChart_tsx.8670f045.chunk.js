"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(globalThis["webpackChunksuperset"] = globalThis["webpackChunksuperset"] || []).push([["plugins_plugin-chart-pivot-table_src_PivotTableChart_tsx"],{

/***/ "./packages/superset-ui-core/src/utils/getSelectedText.ts":
/*!****************************************************************!*\
  !*** ./packages/superset-ui-core/src/utils/getSelectedText.ts ***!
  \****************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("{/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getSelectedText: () => (/* binding */ getSelectedText)\n/* harmony export */ });\n/* provided dependency */ var __react_refresh_utils__ = __webpack_require__(/*! ./node_modules/@pmmmwh/react-refresh-webpack-plugin/lib/runtime/RefreshUtils.js */ \"./node_modules/@pmmmwh/react-refresh-webpack-plugin/lib/runtime/RefreshUtils.js\");\n/* provided dependency */ var __react_refresh_error_overlay__ = __webpack_require__(/*! ./node_modules/@pmmmwh/react-refresh-webpack-plugin/overlay/index.js */ \"./node_modules/@pmmmwh/react-refresh-webpack-plugin/overlay/index.js\");\n__webpack_require__.$Refresh$.runtime = __webpack_require__(/*! ./node_modules/react-refresh/runtime.js */ \"./node_modules/react-refresh/runtime.js\");\n\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */ const getSelectedText = ()=>{\n    var _window_getSelection;\n    return (_window_getSelection = window.getSelection()) == null ? void 0 : _window_getSelection.toString();\n};\n\n\nconst $ReactRefreshModuleId$ = __webpack_require__.$Refresh$.moduleId;\nconst $ReactRefreshCurrentExports$ = __react_refresh_utils__.getModuleExports(\n\t$ReactRefreshModuleId$\n);\n\nfunction $ReactRefreshModuleRuntime$(exports) {\n\tif (true) {\n\t\tlet errorOverlay;\n\t\tif (typeof __react_refresh_error_overlay__ !== 'undefined') {\n\t\t\terrorOverlay = __react_refresh_error_overlay__;\n\t\t}\n\t\tlet testMode;\n\t\tif (typeof __react_refresh_test__ !== 'undefined') {\n\t\t\ttestMode = __react_refresh_test__;\n\t\t}\n\t\treturn __react_refresh_utils__.executeRuntime(\n\t\t\texports,\n\t\t\t$ReactRefreshModuleId$,\n\t\t\tmodule.hot,\n\t\t\terrorOverlay,\n\t\t\ttestMode\n\t\t);\n\t}\n}\n\nif (typeof Promise !== 'undefined' && $ReactRefreshCurrentExports$ instanceof Promise) {\n\t$ReactRefreshCurrentExports$.then($ReactRefreshModuleRuntime$);\n} else {\n\t$ReactRefreshModuleRuntime$($ReactRefreshCurrentExports$);\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy9zdXBlcnNldC11aS1jb3JlL3NyYy91dGlscy9nZXRTZWxlY3RlZFRleHQudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOzs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQTtBQUNBO0FBQUE7QUFBQSIsInNvdXJjZXMiOlsid2VicGFjazovL3N1cGVyc2V0Ly4vcGFja2FnZXMvc3VwZXJzZXQtdWktY29yZS9zcmMvdXRpbHMvZ2V0U2VsZWN0ZWRUZXh0LnRzPzkxMjEiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4gKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4gKiBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4gKiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuZXhwb3J0IGNvbnN0IGdldFNlbGVjdGVkVGV4dCA9ICgpID0+IHdpbmRvdy5nZXRTZWxlY3Rpb24oKT8udG9TdHJpbmcoKTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./packages/superset-ui-core/src/utils/getSelectedText.ts\n\n}");

/***/ }),

/***/ "./plugins/plugin-chart-pivot-table/src/PivotTableChart.tsx":
/*!******************************************************************!*\
  !*** ./plugins/plugin-chart-pivot-table/src/PivotTableChart.tsx ***!
  \******************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ PivotTableChart)\n/* harmony export */ });\n/* harmony import */ var _emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @emotion/react/jsx-dev-runtime */ \"./node_modules/@emotion/react/jsx-dev-runtime/dist/emotion-react-jsx-dev-runtime.browser.development.esm.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ \"webpack/sharing/consume/default/react/react\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _ant_design_icons__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @ant-design/icons */ \"./node_modules/@ant-design/icons/es/icons/MinusSquareOutlined.js\");\n/* harmony import */ var _ant_design_icons__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @ant-design/icons */ \"./node_modules/@ant-design/icons/es/icons/PlusSquareOutlined.js\");\n/* harmony import */ var _superset_ui_core__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @superset-ui/core */ \"./packages/superset-ui-core/src/translation/TranslatorSingleton.ts\");\n/* harmony import */ var _superset_ui_core__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @superset-ui/core */ \"./packages/superset-ui-core/src/currency-format/CurrencyFormatter.ts\");\n/* harmony import */ var _superset_ui_core__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @superset-ui/core */ \"./packages/superset-ui-core/src/query/types/Column.ts\");\n/* harmony import */ var _superset_ui_core__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @superset-ui/core */ \"./packages/superset-ui-core/src/number-format/NumberFormatterRegistrySingleton.ts\");\n/* harmony import */ var _superset_ui_core__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @superset-ui/core */ \"./packages/superset-ui-core/src/query/getColumnLabel.ts\");\n/* harmony import */ var _superset_ui_core__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @superset-ui/core */ \"./packages/superset-ui-core/src/utils/getSelectedText.ts\");\n/* harmony import */ var _superset_ui_core__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @superset-ui/core */ \"./packages/superset-ui-core/src/utils/featureFlags.ts\");\n/* harmony import */ var _apache_superset_core_ui__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @apache-superset/core/ui */ \"./packages/superset-core/src/ui/theme/index.tsx\");\n/* harmony import */ var _react_pivottable__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./react-pivottable */ \"./plugins/plugin-chart-pivot-table/src/react-pivottable/PivotTable.jsx\");\n/* harmony import */ var _react_pivottable__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./react-pivottable */ \"./plugins/plugin-chart-pivot-table/src/react-pivottable/utilities.js\");\n/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./types */ \"./plugins/plugin-chart-pivot-table/src/types.ts\");\n/* provided dependency */ var __react_refresh_utils__ = __webpack_require__(/*! ./node_modules/@pmmmwh/react-refresh-webpack-plugin/lib/runtime/RefreshUtils.js */ \"./node_modules/@pmmmwh/react-refresh-webpack-plugin/lib/runtime/RefreshUtils.js\");\n/* provided dependency */ var __react_refresh_error_overlay__ = __webpack_require__(/*! ./node_modules/@pmmmwh/react-refresh-webpack-plugin/overlay/index.js */ \"./node_modules/@pmmmwh/react-refresh-webpack-plugin/overlay/index.js\");\n__webpack_require__.$Refresh$.runtime = __webpack_require__(/*! ./node_modules/react-refresh/runtime.js */ \"./node_modules/react-refresh/runtime.js\");\n\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */ function _extends() {\n    _extends = Object.assign || function(target) {\n        for(var i = 1; i < arguments.length; i++){\n            var source = arguments[i];\n            for(var key in source){\n                if (Object.prototype.hasOwnProperty.call(source, key)) {\n                    target[key] = source[key];\n                }\n            }\n        }\n        return target;\n    };\n    return _extends.apply(this, arguments);\n}\n\nvar _s = __webpack_require__.$Refresh$.signature();\n\n\n\n\n\n\nconst Styles = _apache_superset_core_ui__WEBPACK_IMPORTED_MODULE_11__.styled.div`\n  ${({ height, width, margin })=>`\n      margin: ${margin}px;\n      height: ${height - margin * 2}px;\n      width: ${typeof width === 'string' ? parseInt(width, 10) : width - margin * 2}px;\n `}\n`;\n_c = Styles;\nconst PivotTableWrapper = _apache_superset_core_ui__WEBPACK_IMPORTED_MODULE_11__.styled.div`\n  ${({ theme })=>`\n    height: 100%;\n    max-width: inherit;\n    overflow: auto;\n\n    /* Chrome/Safari/Edge webkit scrollbar styling */\n    &::-webkit-scrollbar {\n      width: 8px;\n      height: 8px;\n    }\n\n    &::-webkit-scrollbar-track {\n      background: ${theme.colorFillQuaternary};\n    }\n\n    &::-webkit-scrollbar-thumb {\n      background: ${theme.colorFillSecondary};\n      border-radius: ${theme.borderRadiusSM}px;\n\n      &:hover {\n        background: ${theme.colorFillTertiary};\n      }\n    }\n\n    &::-webkit-scrollbar-corner {\n      background: ${theme.colorFillQuaternary};\n    }\n\n    /* Firefox scrollbar styling */\n    scrollbar-width: thin;\n    scrollbar-color: ${theme.colorFillSecondary} ${theme.colorFillQuaternary};\n  `}\n`;\n_c1 = PivotTableWrapper;\nconst METRIC_KEY = (0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_4__.t)('Metric');\nconst vals = [\n    'value'\n];\nconst StyledPlusSquareOutlined = (0,_apache_superset_core_ui__WEBPACK_IMPORTED_MODULE_11__.styled)((0,_ant_design_icons__WEBPACK_IMPORTED_MODULE_3__[\"default\"]))`\n  stroke: ${({ theme })=>theme.colorBorderSecondary};\n  stroke-width: 16px;\n`;\n_c2 = StyledPlusSquareOutlined;\nconst StyledMinusSquareOutlined = (0,_apache_superset_core_ui__WEBPACK_IMPORTED_MODULE_11__.styled)((0,_ant_design_icons__WEBPACK_IMPORTED_MODULE_2__[\"default\"]))`\n  stroke: ${({ theme })=>theme.colorBorderSecondary};\n  stroke-width: 16px;\n`;\n_c3 = StyledMinusSquareOutlined;\nconst aggregatorsFactory = (formatter)=>({\n        Count: _react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.count(formatter),\n        'Count Unique Values': _react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.countUnique(formatter),\n        'List Unique Values': _react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.listUnique(', ', formatter),\n        Sum: _react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.sum(formatter),\n        Average: _react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.average(formatter),\n        Median: _react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.median(formatter),\n        'Sample Variance': _react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.var(1, formatter),\n        'Sample Standard Deviation': _react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.stdev(1, formatter),\n        Minimum: _react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.min(formatter),\n        Maximum: _react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.max(formatter),\n        First: _react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.first(formatter),\n        Last: _react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.last(formatter),\n        'Sum as Fraction of Total': _react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.fractionOf(_react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.sum(), 'total', formatter),\n        'Sum as Fraction of Rows': _react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.fractionOf(_react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.sum(), 'row', formatter),\n        'Sum as Fraction of Columns': _react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.fractionOf(_react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.sum(), 'col', formatter),\n        'Count as Fraction of Total': _react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.fractionOf(_react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.count(), 'total', formatter),\n        'Count as Fraction of Rows': _react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.fractionOf(_react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.count(), 'row', formatter),\n        'Count as Fraction of Columns': _react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.fractionOf(_react_pivottable__WEBPACK_IMPORTED_MODULE_13__.aggregatorTemplates.count(), 'col', formatter)\n    });\n/* If you change this logic, please update the corresponding Python\n * function (https://github.com/apache/superset/blob/master/superset/charts/post_processing.py),\n * or reach out to @betodealmeida.\n */ function PivotTableChart(props) {\n    _s();\n    const { data, height, width, groupbyRows: groupbyRowsRaw, groupbyColumns: groupbyColumnsRaw, metrics, colOrder, rowOrder, aggregateFunction, transposePivot, combineMetric, rowSubtotalPosition, colSubtotalPosition, colTotals, colSubTotals, rowTotals, rowSubTotals, valueFormat, currencyFormat, emitCrossFilters, setDataMask, selectedFilters, verboseMap, columnFormats, currencyFormats, metricsLayout, metricColorFormatters, dateFormatters, onContextMenu, timeGrainSqla, allowRenderHtml } = props;\n    const theme = (0,_apache_superset_core_ui__WEBPACK_IMPORTED_MODULE_11__.useTheme)();\n    const defaultFormatter = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(()=>(currencyFormat == null ? void 0 : currencyFormat.symbol) ? new _superset_ui_core__WEBPACK_IMPORTED_MODULE_5__[\"default\"]({\n            currency: currencyFormat,\n            d3Format: valueFormat\n        }) : (0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_7__.getNumberFormatter)(valueFormat), [\n        valueFormat,\n        currencyFormat\n    ]);\n    const customFormatsArray = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(()=>Array.from(new Set([\n            ...Object.keys(columnFormats || {}),\n            ...Object.keys(currencyFormats || {})\n        ])).map((metricName)=>[\n                metricName,\n                columnFormats[metricName] || valueFormat,\n                currencyFormats[metricName] || currencyFormat\n            ]), [\n        columnFormats,\n        currencyFormat,\n        currencyFormats,\n        valueFormat\n    ]);\n    const hasCustomMetricFormatters = customFormatsArray.length > 0;\n    const metricFormatters = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(()=>hasCustomMetricFormatters ? {\n            [METRIC_KEY]: Object.fromEntries(customFormatsArray.map(([metric, d3Format, currency])=>[\n                    metric,\n                    currency ? new _superset_ui_core__WEBPACK_IMPORTED_MODULE_5__[\"default\"]({\n                        currency,\n                        d3Format\n                    }) : (0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_7__.getNumberFormatter)(d3Format)\n                ]))\n        } : undefined, [\n        customFormatsArray,\n        hasCustomMetricFormatters\n    ]);\n    const metricNames = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(()=>metrics.map((metric)=>typeof metric === 'string' ? metric : metric.label), [\n        metrics\n    ]);\n    const unpivotedData = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(()=>data.reduce((acc, record)=>[\n                ...acc,\n                ...metricNames.map((name)=>_extends({}, record, {\n                        [METRIC_KEY]: name,\n                        value: record[name]\n                    })).filter((record)=>record.value !== null)\n            ], []), [\n        data,\n        metricNames\n    ]);\n    const groupbyRows = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(()=>groupbyRowsRaw.map(_superset_ui_core__WEBPACK_IMPORTED_MODULE_8__[\"default\"]), [\n        groupbyRowsRaw\n    ]);\n    const groupbyColumns = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(()=>groupbyColumnsRaw.map(_superset_ui_core__WEBPACK_IMPORTED_MODULE_8__[\"default\"]), [\n        groupbyColumnsRaw\n    ]);\n    const sorters = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(()=>({\n            [METRIC_KEY]: (0,_react_pivottable__WEBPACK_IMPORTED_MODULE_13__.sortAs)(metricNames)\n        }), [\n        metricNames\n    ]);\n    const [rows, cols] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(()=>{\n        let [rows_, cols_] = transposePivot ? [\n            groupbyColumns,\n            groupbyRows\n        ] : [\n            groupbyRows,\n            groupbyColumns\n        ];\n        if (metricsLayout === _types__WEBPACK_IMPORTED_MODULE_14__.MetricsLayoutEnum.ROWS) {\n            rows_ = combineMetric ? [\n                ...rows_,\n                METRIC_KEY\n            ] : [\n                METRIC_KEY,\n                ...rows_\n            ];\n        } else {\n            cols_ = combineMetric ? [\n                ...cols_,\n                METRIC_KEY\n            ] : [\n                METRIC_KEY,\n                ...cols_\n            ];\n        }\n        return [\n            rows_,\n            cols_\n        ];\n    }, [\n        combineMetric,\n        groupbyColumns,\n        groupbyRows,\n        metricsLayout,\n        transposePivot\n    ]);\n    const handleChange = (0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)((filters)=>{\n        const filterKeys = Object.keys(filters);\n        const groupby = [\n            ...groupbyRowsRaw,\n            ...groupbyColumnsRaw\n        ];\n        setDataMask({\n            extraFormData: {\n                filters: filterKeys.length === 0 ? undefined : filterKeys.map((key)=>{\n                    const val = filters == null ? void 0 : filters[key];\n                    var _groupby_find;\n                    const col = (_groupby_find = groupby.find((item)=>{\n                        if ((0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_6__.isPhysicalColumn)(item)) {\n                            return item === key;\n                        }\n                        if ((0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_6__.isAdhocColumn)(item)) {\n                            return item.label === key;\n                        }\n                        return false;\n                    })) != null ? _groupby_find : '';\n                    if (val === null || val === undefined) return {\n                        col,\n                        op: 'IS NULL'\n                    };\n                    return {\n                        col,\n                        op: 'IN',\n                        val: val\n                    };\n                })\n            },\n            filterState: {\n                value: filters && Object.keys(filters).length ? Object.values(filters) : null,\n                selectedFilters: filters && Object.keys(filters).length ? filters : null\n            }\n        });\n    }, [\n        groupbyColumnsRaw,\n        groupbyRowsRaw,\n        setDataMask\n    ]);\n    const getCrossFilterDataMask = (0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)((value)=>{\n        const isActiveFilterValue = (key, val)=>{\n            var _selectedFilters_key;\n            return !!selectedFilters && ((_selectedFilters_key = selectedFilters[key]) == null ? void 0 : _selectedFilters_key.includes(val));\n        };\n        if (!value) {\n            return undefined;\n        }\n        const [key, val] = Object.entries(value)[0];\n        let values = _extends({}, selectedFilters);\n        if (isActiveFilterValue(key, val)) {\n            values = {};\n        } else {\n            values = {\n                [key]: [\n                    val\n                ]\n            };\n        }\n        const filterKeys = Object.keys(values);\n        const groupby = [\n            ...groupbyRowsRaw,\n            ...groupbyColumnsRaw\n        ];\n        return {\n            dataMask: {\n                extraFormData: {\n                    filters: filterKeys.length === 0 ? undefined : filterKeys.map((key)=>{\n                        const val = values == null ? void 0 : values[key];\n                        var _groupby_find;\n                        const col = (_groupby_find = groupby.find((item)=>{\n                            if ((0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_6__.isPhysicalColumn)(item)) {\n                                return item === key;\n                            }\n                            if ((0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_6__.isAdhocColumn)(item)) {\n                                return item.label === key;\n                            }\n                            return false;\n                        })) != null ? _groupby_find : '';\n                        if (val === null || val === undefined) return {\n                            col,\n                            op: 'IS NULL'\n                        };\n                        return {\n                            col,\n                            op: 'IN',\n                            val: val\n                        };\n                    })\n                },\n                filterState: {\n                    value: values && Object.keys(values).length ? Object.values(values) : null,\n                    selectedFilters: values && Object.keys(values).length ? values : null\n                }\n            },\n            isCurrentValueSelected: isActiveFilterValue(key, val)\n        };\n    }, [\n        groupbyColumnsRaw,\n        groupbyRowsRaw,\n        selectedFilters\n    ]);\n    const toggleFilter = (0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)((e, value, filters, pivotData, isSubtotal, isGrandTotal)=>{\n        if (isSubtotal || isGrandTotal || !emitCrossFilters) {\n            return;\n        }\n        // allow selecting text in a cell\n        if ((0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_9__.getSelectedText)()) {\n            return;\n        }\n        const isActiveFilterValue = (key, val)=>{\n            var _selectedFilters_key;\n            return !!selectedFilters && ((_selectedFilters_key = selectedFilters[key]) == null ? void 0 : _selectedFilters_key.includes(val));\n        };\n        const filtersCopy = _extends({}, filters);\n        delete filtersCopy[METRIC_KEY];\n        const filtersEntries = Object.entries(filtersCopy);\n        if (filtersEntries.length === 0) {\n            return;\n        }\n        const [key, val] = filtersEntries[filtersEntries.length - 1];\n        let updatedFilters = _extends({}, selectedFilters);\n        // multi select\n        // if (selectedFilters && isActiveFilterValue(key, val)) {\n        //   updatedFilters[key] = selectedFilters[key].filter((x: DataRecordValue) => x !== val);\n        // } else {\n        //   updatedFilters[key] = [...(selectedFilters?.[key] || []), val];\n        // }\n        // single select\n        if (selectedFilters && isActiveFilterValue(key, val)) {\n            updatedFilters = {};\n        } else {\n            updatedFilters = {\n                [key]: [\n                    val\n                ]\n            };\n        }\n        if (Array.isArray(updatedFilters[key]) && updatedFilters[key].length === 0) {\n            delete updatedFilters[key];\n        }\n        handleChange(updatedFilters);\n    }, [\n        emitCrossFilters,\n        selectedFilters,\n        handleChange\n    ]);\n    const tableOptions = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(()=>({\n            clickRowHeaderCallback: toggleFilter,\n            clickColumnHeaderCallback: toggleFilter,\n            colTotals,\n            colSubTotals,\n            rowTotals,\n            rowSubTotals,\n            highlightHeaderCellsOnHover: emitCrossFilters || (0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_10__.isFeatureEnabled)(_superset_ui_core__WEBPACK_IMPORTED_MODULE_10__.FeatureFlag.DrillBy) || (0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_10__.isFeatureEnabled)(_superset_ui_core__WEBPACK_IMPORTED_MODULE_10__.FeatureFlag.DrillToDetail),\n            highlightedHeaderCells: selectedFilters,\n            omittedHighlightHeaderGroups: [\n                METRIC_KEY\n            ],\n            cellColorFormatters: {\n                [METRIC_KEY]: metricColorFormatters\n            },\n            dateFormatters\n        }), [\n        colTotals,\n        colSubTotals,\n        dateFormatters,\n        emitCrossFilters,\n        metricColorFormatters,\n        rowTotals,\n        rowSubTotals,\n        selectedFilters,\n        toggleFilter\n    ]);\n    const subtotalOptions = (0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)(()=>({\n            colSubtotalDisplay: {\n                displayOnTop: colSubtotalPosition\n            },\n            rowSubtotalDisplay: {\n                displayOnTop: rowSubtotalPosition\n            },\n            arrowCollapsed: /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(StyledPlusSquareOutlined, {}, void 0, false, {\n                fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/PivotTableChart.tsx\",\n                lineNumber: 495,\n                columnNumber: 23\n            }, this),\n            arrowExpanded: /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(StyledMinusSquareOutlined, {}, void 0, false, {\n                fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/PivotTableChart.tsx\",\n                lineNumber: 496,\n                columnNumber: 22\n            }, this)\n        }), [\n        colSubtotalPosition,\n        rowSubtotalPosition\n    ]);\n    const handleContextMenu = (0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)((e, colKey, rowKey, dataPoint)=>{\n        if (onContextMenu) {\n            e.preventDefault();\n            e.stopPropagation();\n            const drillToDetailFilters = [];\n            if (colKey && colKey.length > 1) {\n                colKey.forEach((val, i)=>{\n                    const col = cols[i];\n                    const formatter = dateFormatters[col];\n                    const formattedVal = (formatter == null ? void 0 : formatter(val)) || String(val);\n                    if (i > 0) {\n                        drillToDetailFilters.push({\n                            col,\n                            op: '==',\n                            val,\n                            formattedVal,\n                            grain: formatter ? timeGrainSqla : undefined\n                        });\n                    }\n                });\n            }\n            if (rowKey) {\n                rowKey.forEach((val, i)=>{\n                    const col = rows[i];\n                    const formatter = dateFormatters[col];\n                    const formattedVal = (formatter == null ? void 0 : formatter(val)) || String(val);\n                    drillToDetailFilters.push({\n                        col,\n                        op: '==',\n                        val,\n                        formattedVal,\n                        grain: formatter ? timeGrainSqla : undefined\n                    });\n                });\n            }\n            onContextMenu(e.clientX, e.clientY, {\n                drillToDetail: drillToDetailFilters,\n                crossFilter: getCrossFilterDataMask(dataPoint),\n                drillBy: dataPoint && {\n                    filters: [\n                        {\n                            col: Object.keys(dataPoint)[0],\n                            op: '==',\n                            val: Object.values(dataPoint)[0]\n                        }\n                    ],\n                    groupbyFieldName: rowKey ? 'groupbyRows' : 'groupbyColumns'\n                }\n            });\n        }\n    }, [\n        cols,\n        dateFormatters,\n        getCrossFilterDataMask,\n        onContextMenu,\n        rows,\n        timeGrainSqla\n    ]);\n    return /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(Styles, {\n        height: height,\n        width: width,\n        margin: theme.sizeUnit * 4,\n        children: /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(PivotTableWrapper, {\n            children: /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(_react_pivottable__WEBPACK_IMPORTED_MODULE_12__[\"default\"], {\n                data: unpivotedData,\n                rows: rows,\n                cols: cols,\n                aggregatorsFactory: aggregatorsFactory,\n                defaultFormatter: defaultFormatter,\n                customFormatters: metricFormatters,\n                aggregatorName: aggregateFunction,\n                vals: vals,\n                colOrder: colOrder,\n                rowOrder: rowOrder,\n                sorters: sorters,\n                tableOptions: tableOptions,\n                subtotalOptions: subtotalOptions,\n                namesMapping: verboseMap,\n                onContextMenu: handleContextMenu,\n                allowRenderHtml: allowRenderHtml\n            }, void 0, false, {\n                fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/PivotTableChart.tsx\",\n                lineNumber: 571,\n                columnNumber: 9\n            }, this)\n        }, void 0, false, {\n            fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/PivotTableChart.tsx\",\n            lineNumber: 570,\n            columnNumber: 7\n        }, this)\n    }, void 0, false, {\n        fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/PivotTableChart.tsx\",\n        lineNumber: 569,\n        columnNumber: 5\n    }, this);\n}\n_s(PivotTableChart, \"NQpRqGniq7j6KfEPVRYMtGoummA=\", false, function() {\n    return [\n        _apache_superset_core_ui__WEBPACK_IMPORTED_MODULE_11__.useTheme\n    ];\n});\n_c4 = PivotTableChart;\nvar _c, _c1, _c2, _c3, _c4;\n__webpack_require__.$Refresh$.register(_c, \"Styles\");\n__webpack_require__.$Refresh$.register(_c1, \"PivotTableWrapper\");\n__webpack_require__.$Refresh$.register(_c2, \"StyledPlusSquareOutlined\");\n__webpack_require__.$Refresh$.register(_c3, \"StyledMinusSquareOutlined\");\n__webpack_require__.$Refresh$.register(_c4, \"PivotTableChart\");\n\n\nconst $ReactRefreshModuleId$ = __webpack_require__.$Refresh$.moduleId;\nconst $ReactRefreshCurrentExports$ = __react_refresh_utils__.getModuleExports(\n\t$ReactRefreshModuleId$\n);\n\nfunction $ReactRefreshModuleRuntime$(exports) {\n\tif (true) {\n\t\tlet errorOverlay;\n\t\tif (typeof __react_refresh_error_overlay__ !== 'undefined') {\n\t\t\terrorOverlay = __react_refresh_error_overlay__;\n\t\t}\n\t\tlet testMode;\n\t\tif (typeof __react_refresh_test__ !== 'undefined') {\n\t\t\ttestMode = __react_refresh_test__;\n\t\t}\n\t\treturn __react_refresh_utils__.executeRuntime(\n\t\t\texports,\n\t\t\t$ReactRefreshModuleId$,\n\t\t\tmodule.hot,\n\t\t\terrorOverlay,\n\t\t\ttestMode\n\t\t);\n\t}\n}\n\nif (typeof Promise !== 'undefined' && $ReactRefreshCurrentExports$ instanceof Promise) {\n\t$ReactRefreshCurrentExports$.then($ReactRefreshModuleRuntime$);\n} else {\n\t$ReactRefreshModuleRuntime$($ReactRefreshCurrentExports$);\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wbHVnaW5zL3BsdWdpbi1jaGFydC1waXZvdC10YWJsZS9zcmMvUGl2b3RUYWJsZUNoYXJ0LnRzeCIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQkE7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFlQTtBQUNBO0FBQ0E7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQVJBO0FBVUE7QUFDQTs7Ozs7Ozs7Ozs7O0FBWUE7Ozs7QUFJQTtBQUNBOzs7QUFHQTs7Ozs7QUFLQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFqQ0E7QUFtQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUNBOztBQUVBO0FBSEE7QUFLQTtBQUNBOztBQUVBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFLQTtBQUtBO0FBS0E7QUFLQTtBQUtBO0FBRUE7OztBQUdBOztBQUVBO0FBa0NBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFFQTtBQUlBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFJQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBRUE7QUFBQTtBQUFBO0FBR0E7QUFLQTtBQUFBO0FBR0E7QUFJQTtBQUNBO0FBR0E7QUFDQTtBQUVBO0FBQ0E7QUFHQTtBQUFBO0FBQUE7QUFFQTtBQUVBO0FBQUE7QUFFQTtBQUVBO0FBQUE7QUFHQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFFQTtBQURBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBRUE7QUFDQTtBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUVBO0FBREE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBU0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTs7Ozs7QUFDQTs7Ozs7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUdBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7QUFLQTtBQXZiQTs7QUFtQ0E7OztBQW5DQSIsInNvdXJjZXMiOlsid2VicGFjazovL3N1cGVyc2V0Ly4vcGx1Z2lucy9wbHVnaW4tY2hhcnQtcGl2b3QtdGFibGUvc3JjL1Bpdm90VGFibGVDaGFydC50c3g/N2QzMSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbiAqIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuICogZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbiAqIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbiAqIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuICogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbiAqIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4gKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbiAqIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5pbXBvcnQgeyB1c2VDYWxsYmFjaywgdXNlTWVtbyB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IE1pbnVzU3F1YXJlT3V0bGluZWQsIFBsdXNTcXVhcmVPdXRsaW5lZCB9IGZyb20gJ0BhbnQtZGVzaWduL2ljb25zJztcbmltcG9ydCB7XG4gIEFkaG9jTWV0cmljLFxuICBCaW5hcnlRdWVyeU9iamVjdEZpbHRlckNsYXVzZSxcbiAgQ3VycmVuY3lGb3JtYXR0ZXIsXG4gIERhdGFSZWNvcmRWYWx1ZSxcbiAgRmVhdHVyZUZsYWcsXG4gIGdldENvbHVtbkxhYmVsLFxuICBnZXROdW1iZXJGb3JtYXR0ZXIsXG4gIGdldFNlbGVjdGVkVGV4dCxcbiAgaXNBZGhvY0NvbHVtbixcbiAgaXNGZWF0dXJlRW5hYmxlZCxcbiAgaXNQaHlzaWNhbENvbHVtbixcbiAgTnVtYmVyRm9ybWF0dGVyLFxuICB0LFxufSBmcm9tICdAc3VwZXJzZXQtdWkvY29yZSc7XG5pbXBvcnQgeyBzdHlsZWQsIHVzZVRoZW1lIH0gZnJvbSAnQGFwYWNoZS1zdXBlcnNldC9jb3JlL3VpJztcbmltcG9ydCB7IGFnZ3JlZ2F0b3JUZW1wbGF0ZXMsIFBpdm90VGFibGUsIHNvcnRBcyB9IGZyb20gJy4vcmVhY3QtcGl2b3R0YWJsZSc7XG5pbXBvcnQge1xuICBGaWx0ZXJUeXBlLFxuICBNZXRyaWNzTGF5b3V0RW51bSxcbiAgUGl2b3RUYWJsZVByb3BzLFxuICBQaXZvdFRhYmxlU3R5bGVzUHJvcHMsXG4gIFNlbGVjdGVkRmlsdGVyc1R5cGUsXG59IGZyb20gJy4vdHlwZXMnO1xuXG5jb25zdCBTdHlsZXMgPSBzdHlsZWQuZGl2PFBpdm90VGFibGVTdHlsZXNQcm9wcz5gXG4gICR7KHsgaGVpZ2h0LCB3aWR0aCwgbWFyZ2luIH0pID0+IGBcbiAgICAgIG1hcmdpbjogJHttYXJnaW59cHg7XG4gICAgICBoZWlnaHQ6ICR7aGVpZ2h0IC0gbWFyZ2luICogMn1weDtcbiAgICAgIHdpZHRoOiAke1xuICAgICAgICB0eXBlb2Ygd2lkdGggPT09ICdzdHJpbmcnID8gcGFyc2VJbnQod2lkdGgsIDEwKSA6IHdpZHRoIC0gbWFyZ2luICogMlxuICAgICAgfXB4O1xuIGB9XG5gO1xuXG5jb25zdCBQaXZvdFRhYmxlV3JhcHBlciA9IHN0eWxlZC5kaXZgXG4gICR7KHsgdGhlbWUgfSkgPT4gYFxuICAgIGhlaWdodDogMTAwJTtcbiAgICBtYXgtd2lkdGg6IGluaGVyaXQ7XG4gICAgb3ZlcmZsb3c6IGF1dG87XG5cbiAgICAvKiBDaHJvbWUvU2FmYXJpL0VkZ2Ugd2Via2l0IHNjcm9sbGJhciBzdHlsaW5nICovXG4gICAgJjo6LXdlYmtpdC1zY3JvbGxiYXIge1xuICAgICAgd2lkdGg6IDhweDtcbiAgICAgIGhlaWdodDogOHB4O1xuICAgIH1cblxuICAgICY6Oi13ZWJraXQtc2Nyb2xsYmFyLXRyYWNrIHtcbiAgICAgIGJhY2tncm91bmQ6ICR7dGhlbWUuY29sb3JGaWxsUXVhdGVybmFyeX07XG4gICAgfVxuXG4gICAgJjo6LXdlYmtpdC1zY3JvbGxiYXItdGh1bWIge1xuICAgICAgYmFja2dyb3VuZDogJHt0aGVtZS5jb2xvckZpbGxTZWNvbmRhcnl9O1xuICAgICAgYm9yZGVyLXJhZGl1czogJHt0aGVtZS5ib3JkZXJSYWRpdXNTTX1weDtcblxuICAgICAgJjpob3ZlciB7XG4gICAgICAgIGJhY2tncm91bmQ6ICR7dGhlbWUuY29sb3JGaWxsVGVydGlhcnl9O1xuICAgICAgfVxuICAgIH1cblxuICAgICY6Oi13ZWJraXQtc2Nyb2xsYmFyLWNvcm5lciB7XG4gICAgICBiYWNrZ3JvdW5kOiAke3RoZW1lLmNvbG9yRmlsbFF1YXRlcm5hcnl9O1xuICAgIH1cblxuICAgIC8qIEZpcmVmb3ggc2Nyb2xsYmFyIHN0eWxpbmcgKi9cbiAgICBzY3JvbGxiYXItd2lkdGg6IHRoaW47XG4gICAgc2Nyb2xsYmFyLWNvbG9yOiAke3RoZW1lLmNvbG9yRmlsbFNlY29uZGFyeX0gJHt0aGVtZS5jb2xvckZpbGxRdWF0ZXJuYXJ5fTtcbiAgYH1cbmA7XG5cbmNvbnN0IE1FVFJJQ19LRVkgPSB0KCdNZXRyaWMnKTtcbmNvbnN0IHZhbHMgPSBbJ3ZhbHVlJ107XG5cbmNvbnN0IFN0eWxlZFBsdXNTcXVhcmVPdXRsaW5lZCA9IHN0eWxlZChQbHVzU3F1YXJlT3V0bGluZWQpYFxuICBzdHJva2U6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuY29sb3JCb3JkZXJTZWNvbmRhcnl9O1xuICBzdHJva2Utd2lkdGg6IDE2cHg7XG5gO1xuXG5jb25zdCBTdHlsZWRNaW51c1NxdWFyZU91dGxpbmVkID0gc3R5bGVkKE1pbnVzU3F1YXJlT3V0bGluZWQpYFxuICBzdHJva2U6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuY29sb3JCb3JkZXJTZWNvbmRhcnl9O1xuICBzdHJva2Utd2lkdGg6IDE2cHg7XG5gO1xuXG5jb25zdCBhZ2dyZWdhdG9yc0ZhY3RvcnkgPSAoZm9ybWF0dGVyOiBOdW1iZXJGb3JtYXR0ZXIpID0+ICh7XG4gIENvdW50OiBhZ2dyZWdhdG9yVGVtcGxhdGVzLmNvdW50KGZvcm1hdHRlciksXG4gICdDb3VudCBVbmlxdWUgVmFsdWVzJzogYWdncmVnYXRvclRlbXBsYXRlcy5jb3VudFVuaXF1ZShmb3JtYXR0ZXIpLFxuICAnTGlzdCBVbmlxdWUgVmFsdWVzJzogYWdncmVnYXRvclRlbXBsYXRlcy5saXN0VW5pcXVlKCcsICcsIGZvcm1hdHRlciksXG4gIFN1bTogYWdncmVnYXRvclRlbXBsYXRlcy5zdW0oZm9ybWF0dGVyKSxcbiAgQXZlcmFnZTogYWdncmVnYXRvclRlbXBsYXRlcy5hdmVyYWdlKGZvcm1hdHRlciksXG4gIE1lZGlhbjogYWdncmVnYXRvclRlbXBsYXRlcy5tZWRpYW4oZm9ybWF0dGVyKSxcbiAgJ1NhbXBsZSBWYXJpYW5jZSc6IGFnZ3JlZ2F0b3JUZW1wbGF0ZXMudmFyKDEsIGZvcm1hdHRlciksXG4gICdTYW1wbGUgU3RhbmRhcmQgRGV2aWF0aW9uJzogYWdncmVnYXRvclRlbXBsYXRlcy5zdGRldigxLCBmb3JtYXR0ZXIpLFxuICBNaW5pbXVtOiBhZ2dyZWdhdG9yVGVtcGxhdGVzLm1pbihmb3JtYXR0ZXIpLFxuICBNYXhpbXVtOiBhZ2dyZWdhdG9yVGVtcGxhdGVzLm1heChmb3JtYXR0ZXIpLFxuICBGaXJzdDogYWdncmVnYXRvclRlbXBsYXRlcy5maXJzdChmb3JtYXR0ZXIpLFxuICBMYXN0OiBhZ2dyZWdhdG9yVGVtcGxhdGVzLmxhc3QoZm9ybWF0dGVyKSxcbiAgJ1N1bSBhcyBGcmFjdGlvbiBvZiBUb3RhbCc6IGFnZ3JlZ2F0b3JUZW1wbGF0ZXMuZnJhY3Rpb25PZihcbiAgICBhZ2dyZWdhdG9yVGVtcGxhdGVzLnN1bSgpLFxuICAgICd0b3RhbCcsXG4gICAgZm9ybWF0dGVyLFxuICApLFxuICAnU3VtIGFzIEZyYWN0aW9uIG9mIFJvd3MnOiBhZ2dyZWdhdG9yVGVtcGxhdGVzLmZyYWN0aW9uT2YoXG4gICAgYWdncmVnYXRvclRlbXBsYXRlcy5zdW0oKSxcbiAgICAncm93JyxcbiAgICBmb3JtYXR0ZXIsXG4gICksXG4gICdTdW0gYXMgRnJhY3Rpb24gb2YgQ29sdW1ucyc6IGFnZ3JlZ2F0b3JUZW1wbGF0ZXMuZnJhY3Rpb25PZihcbiAgICBhZ2dyZWdhdG9yVGVtcGxhdGVzLnN1bSgpLFxuICAgICdjb2wnLFxuICAgIGZvcm1hdHRlcixcbiAgKSxcbiAgJ0NvdW50IGFzIEZyYWN0aW9uIG9mIFRvdGFsJzogYWdncmVnYXRvclRlbXBsYXRlcy5mcmFjdGlvbk9mKFxuICAgIGFnZ3JlZ2F0b3JUZW1wbGF0ZXMuY291bnQoKSxcbiAgICAndG90YWwnLFxuICAgIGZvcm1hdHRlcixcbiAgKSxcbiAgJ0NvdW50IGFzIEZyYWN0aW9uIG9mIFJvd3MnOiBhZ2dyZWdhdG9yVGVtcGxhdGVzLmZyYWN0aW9uT2YoXG4gICAgYWdncmVnYXRvclRlbXBsYXRlcy5jb3VudCgpLFxuICAgICdyb3cnLFxuICAgIGZvcm1hdHRlcixcbiAgKSxcbiAgJ0NvdW50IGFzIEZyYWN0aW9uIG9mIENvbHVtbnMnOiBhZ2dyZWdhdG9yVGVtcGxhdGVzLmZyYWN0aW9uT2YoXG4gICAgYWdncmVnYXRvclRlbXBsYXRlcy5jb3VudCgpLFxuICAgICdjb2wnLFxuICAgIGZvcm1hdHRlcixcbiAgKSxcbn0pO1xuXG4vKiBJZiB5b3UgY2hhbmdlIHRoaXMgbG9naWMsIHBsZWFzZSB1cGRhdGUgdGhlIGNvcnJlc3BvbmRpbmcgUHl0aG9uXG4gKiBmdW5jdGlvbiAoaHR0cHM6Ly9naXRodWIuY29tL2FwYWNoZS9zdXBlcnNldC9ibG9iL21hc3Rlci9zdXBlcnNldC9jaGFydHMvcG9zdF9wcm9jZXNzaW5nLnB5KSxcbiAqIG9yIHJlYWNoIG91dCB0byBAYmV0b2RlYWxtZWlkYS5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gUGl2b3RUYWJsZUNoYXJ0KHByb3BzOiBQaXZvdFRhYmxlUHJvcHMpIHtcbiAgY29uc3Qge1xuICAgIGRhdGEsXG4gICAgaGVpZ2h0LFxuICAgIHdpZHRoLFxuICAgIGdyb3VwYnlSb3dzOiBncm91cGJ5Um93c1JhdyxcbiAgICBncm91cGJ5Q29sdW1uczogZ3JvdXBieUNvbHVtbnNSYXcsXG4gICAgbWV0cmljcyxcbiAgICBjb2xPcmRlcixcbiAgICByb3dPcmRlcixcbiAgICBhZ2dyZWdhdGVGdW5jdGlvbixcbiAgICB0cmFuc3Bvc2VQaXZvdCxcbiAgICBjb21iaW5lTWV0cmljLFxuICAgIHJvd1N1YnRvdGFsUG9zaXRpb24sXG4gICAgY29sU3VidG90YWxQb3NpdGlvbixcbiAgICBjb2xUb3RhbHMsXG4gICAgY29sU3ViVG90YWxzLFxuICAgIHJvd1RvdGFscyxcbiAgICByb3dTdWJUb3RhbHMsXG4gICAgdmFsdWVGb3JtYXQsXG4gICAgY3VycmVuY3lGb3JtYXQsXG4gICAgZW1pdENyb3NzRmlsdGVycyxcbiAgICBzZXREYXRhTWFzayxcbiAgICBzZWxlY3RlZEZpbHRlcnMsXG4gICAgdmVyYm9zZU1hcCxcbiAgICBjb2x1bW5Gb3JtYXRzLFxuICAgIGN1cnJlbmN5Rm9ybWF0cyxcbiAgICBtZXRyaWNzTGF5b3V0LFxuICAgIG1ldHJpY0NvbG9yRm9ybWF0dGVycyxcbiAgICBkYXRlRm9ybWF0dGVycyxcbiAgICBvbkNvbnRleHRNZW51LFxuICAgIHRpbWVHcmFpblNxbGEsXG4gICAgYWxsb3dSZW5kZXJIdG1sLFxuICB9ID0gcHJvcHM7XG5cbiAgY29uc3QgdGhlbWUgPSB1c2VUaGVtZSgpO1xuICBjb25zdCBkZWZhdWx0Rm9ybWF0dGVyID0gdXNlTWVtbyhcbiAgICAoKSA9PlxuICAgICAgY3VycmVuY3lGb3JtYXQ/LnN5bWJvbFxuICAgICAgICA/IG5ldyBDdXJyZW5jeUZvcm1hdHRlcih7XG4gICAgICAgICAgICBjdXJyZW5jeTogY3VycmVuY3lGb3JtYXQsXG4gICAgICAgICAgICBkM0Zvcm1hdDogdmFsdWVGb3JtYXQsXG4gICAgICAgICAgfSlcbiAgICAgICAgOiBnZXROdW1iZXJGb3JtYXR0ZXIodmFsdWVGb3JtYXQpLFxuICAgIFt2YWx1ZUZvcm1hdCwgY3VycmVuY3lGb3JtYXRdLFxuICApO1xuICBjb25zdCBjdXN0b21Gb3JtYXRzQXJyYXkgPSB1c2VNZW1vKFxuICAgICgpID0+XG4gICAgICBBcnJheS5mcm9tKFxuICAgICAgICBuZXcgU2V0KFtcbiAgICAgICAgICAuLi5PYmplY3Qua2V5cyhjb2x1bW5Gb3JtYXRzIHx8IHt9KSxcbiAgICAgICAgICAuLi5PYmplY3Qua2V5cyhjdXJyZW5jeUZvcm1hdHMgfHwge30pLFxuICAgICAgICBdKSxcbiAgICAgICkubWFwKG1ldHJpY05hbWUgPT4gW1xuICAgICAgICBtZXRyaWNOYW1lLFxuICAgICAgICBjb2x1bW5Gb3JtYXRzW21ldHJpY05hbWVdIHx8IHZhbHVlRm9ybWF0LFxuICAgICAgICBjdXJyZW5jeUZvcm1hdHNbbWV0cmljTmFtZV0gfHwgY3VycmVuY3lGb3JtYXQsXG4gICAgICBdKSxcbiAgICBbY29sdW1uRm9ybWF0cywgY3VycmVuY3lGb3JtYXQsIGN1cnJlbmN5Rm9ybWF0cywgdmFsdWVGb3JtYXRdLFxuICApO1xuICBjb25zdCBoYXNDdXN0b21NZXRyaWNGb3JtYXR0ZXJzID0gY3VzdG9tRm9ybWF0c0FycmF5Lmxlbmd0aCA+IDA7XG4gIGNvbnN0IG1ldHJpY0Zvcm1hdHRlcnMgPSB1c2VNZW1vKFxuICAgICgpID0+XG4gICAgICBoYXNDdXN0b21NZXRyaWNGb3JtYXR0ZXJzXG4gICAgICAgID8ge1xuICAgICAgICAgICAgW01FVFJJQ19LRVldOiBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgICAgICAgICAgIGN1c3RvbUZvcm1hdHNBcnJheS5tYXAoKFttZXRyaWMsIGQzRm9ybWF0LCBjdXJyZW5jeV0pID0+IFtcbiAgICAgICAgICAgICAgICBtZXRyaWMsXG4gICAgICAgICAgICAgICAgY3VycmVuY3lcbiAgICAgICAgICAgICAgICAgID8gbmV3IEN1cnJlbmN5Rm9ybWF0dGVyKHtcbiAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeSxcbiAgICAgICAgICAgICAgICAgICAgICBkM0Zvcm1hdCxcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgIDogZ2V0TnVtYmVyRm9ybWF0dGVyKGQzRm9ybWF0KSxcbiAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICApLFxuICAgICAgICAgIH1cbiAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgW2N1c3RvbUZvcm1hdHNBcnJheSwgaGFzQ3VzdG9tTWV0cmljRm9ybWF0dGVyc10sXG4gICk7XG5cbiAgY29uc3QgbWV0cmljTmFtZXMgPSB1c2VNZW1vKFxuICAgICgpID0+XG4gICAgICBtZXRyaWNzLm1hcCgobWV0cmljOiBzdHJpbmcgfCBBZGhvY01ldHJpYykgPT5cbiAgICAgICAgdHlwZW9mIG1ldHJpYyA9PT0gJ3N0cmluZycgPyBtZXRyaWMgOiAobWV0cmljLmxhYmVsIGFzIHN0cmluZyksXG4gICAgICApLFxuICAgIFttZXRyaWNzXSxcbiAgKTtcblxuICBjb25zdCB1bnBpdm90ZWREYXRhID0gdXNlTWVtbyhcbiAgICAoKSA9PlxuICAgICAgZGF0YS5yZWR1Y2UoXG4gICAgICAgIChhY2M6IFJlY29yZDxzdHJpbmcsIGFueT5bXSwgcmVjb3JkOiBSZWNvcmQ8c3RyaW5nLCBhbnk+KSA9PiBbXG4gICAgICAgICAgLi4uYWNjLFxuICAgICAgICAgIC4uLm1ldHJpY05hbWVzXG4gICAgICAgICAgICAubWFwKChuYW1lOiBzdHJpbmcpID0+ICh7XG4gICAgICAgICAgICAgIC4uLnJlY29yZCxcbiAgICAgICAgICAgICAgW01FVFJJQ19LRVldOiBuYW1lLFxuICAgICAgICAgICAgICB2YWx1ZTogcmVjb3JkW25hbWVdLFxuICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAuZmlsdGVyKHJlY29yZCA9PiByZWNvcmQudmFsdWUgIT09IG51bGwpLFxuICAgICAgICBdLFxuICAgICAgICBbXSxcbiAgICAgICksXG4gICAgW2RhdGEsIG1ldHJpY05hbWVzXSxcbiAgKTtcbiAgY29uc3QgZ3JvdXBieVJvd3MgPSB1c2VNZW1vKFxuICAgICgpID0+IGdyb3VwYnlSb3dzUmF3Lm1hcChnZXRDb2x1bW5MYWJlbCksXG4gICAgW2dyb3VwYnlSb3dzUmF3XSxcbiAgKTtcbiAgY29uc3QgZ3JvdXBieUNvbHVtbnMgPSB1c2VNZW1vKFxuICAgICgpID0+IGdyb3VwYnlDb2x1bW5zUmF3Lm1hcChnZXRDb2x1bW5MYWJlbCksXG4gICAgW2dyb3VwYnlDb2x1bW5zUmF3XSxcbiAgKTtcblxuICBjb25zdCBzb3J0ZXJzID0gdXNlTWVtbyhcbiAgICAoKSA9PiAoe1xuICAgICAgW01FVFJJQ19LRVldOiBzb3J0QXMobWV0cmljTmFtZXMpLFxuICAgIH0pLFxuICAgIFttZXRyaWNOYW1lc10sXG4gICk7XG5cbiAgY29uc3QgW3Jvd3MsIGNvbHNdID0gdXNlTWVtbygoKSA9PiB7XG4gICAgbGV0IFtyb3dzXywgY29sc19dID0gdHJhbnNwb3NlUGl2b3RcbiAgICAgID8gW2dyb3VwYnlDb2x1bW5zLCBncm91cGJ5Um93c11cbiAgICAgIDogW2dyb3VwYnlSb3dzLCBncm91cGJ5Q29sdW1uc107XG5cbiAgICBpZiAobWV0cmljc0xheW91dCA9PT0gTWV0cmljc0xheW91dEVudW0uUk9XUykge1xuICAgICAgcm93c18gPSBjb21iaW5lTWV0cmljID8gWy4uLnJvd3NfLCBNRVRSSUNfS0VZXSA6IFtNRVRSSUNfS0VZLCAuLi5yb3dzX107XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbHNfID0gY29tYmluZU1ldHJpYyA/IFsuLi5jb2xzXywgTUVUUklDX0tFWV0gOiBbTUVUUklDX0tFWSwgLi4uY29sc19dO1xuICAgIH1cbiAgICByZXR1cm4gW3Jvd3NfLCBjb2xzX107XG4gIH0sIFtcbiAgICBjb21iaW5lTWV0cmljLFxuICAgIGdyb3VwYnlDb2x1bW5zLFxuICAgIGdyb3VwYnlSb3dzLFxuICAgIG1ldHJpY3NMYXlvdXQsXG4gICAgdHJhbnNwb3NlUGl2b3QsXG4gIF0pO1xuXG4gIGNvbnN0IGhhbmRsZUNoYW5nZSA9IHVzZUNhbGxiYWNrKFxuICAgIChmaWx0ZXJzOiBTZWxlY3RlZEZpbHRlcnNUeXBlKSA9PiB7XG4gICAgICBjb25zdCBmaWx0ZXJLZXlzID0gT2JqZWN0LmtleXMoZmlsdGVycyk7XG4gICAgICBjb25zdCBncm91cGJ5ID0gWy4uLmdyb3VwYnlSb3dzUmF3LCAuLi5ncm91cGJ5Q29sdW1uc1Jhd107XG4gICAgICBzZXREYXRhTWFzayh7XG4gICAgICAgIGV4dHJhRm9ybURhdGE6IHtcbiAgICAgICAgICBmaWx0ZXJzOlxuICAgICAgICAgICAgZmlsdGVyS2V5cy5sZW5ndGggPT09IDBcbiAgICAgICAgICAgICAgPyB1bmRlZmluZWRcbiAgICAgICAgICAgICAgOiBmaWx0ZXJLZXlzLm1hcChrZXkgPT4ge1xuICAgICAgICAgICAgICAgICAgY29uc3QgdmFsID0gZmlsdGVycz8uW2tleV07XG4gICAgICAgICAgICAgICAgICBjb25zdCBjb2wgPVxuICAgICAgICAgICAgICAgICAgICBncm91cGJ5LmZpbmQoaXRlbSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKGlzUGh5c2ljYWxDb2x1bW4oaXRlbSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtID09PSBrZXk7XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0FkaG9jQ29sdW1uKGl0ZW0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5sYWJlbCA9PT0ga2V5O1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pID8/ICcnO1xuICAgICAgICAgICAgICAgICAgaWYgKHZhbCA9PT0gbnVsbCB8fCB2YWwgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICBjb2wsXG4gICAgICAgICAgICAgICAgICAgICAgb3A6ICdJUyBOVUxMJyxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbCxcbiAgICAgICAgICAgICAgICAgICAgb3A6ICdJTicsXG4gICAgICAgICAgICAgICAgICAgIHZhbDogdmFsIGFzIChzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuKVtdLFxuICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgfSxcbiAgICAgICAgZmlsdGVyU3RhdGU6IHtcbiAgICAgICAgICB2YWx1ZTpcbiAgICAgICAgICAgIGZpbHRlcnMgJiYgT2JqZWN0LmtleXMoZmlsdGVycykubGVuZ3RoXG4gICAgICAgICAgICAgID8gT2JqZWN0LnZhbHVlcyhmaWx0ZXJzKVxuICAgICAgICAgICAgICA6IG51bGwsXG4gICAgICAgICAgc2VsZWN0ZWRGaWx0ZXJzOlxuICAgICAgICAgICAgZmlsdGVycyAmJiBPYmplY3Qua2V5cyhmaWx0ZXJzKS5sZW5ndGggPyBmaWx0ZXJzIDogbnVsbCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgW2dyb3VwYnlDb2x1bW5zUmF3LCBncm91cGJ5Um93c1Jhdywgc2V0RGF0YU1hc2tdLFxuICApO1xuXG4gIGNvbnN0IGdldENyb3NzRmlsdGVyRGF0YU1hc2sgPSB1c2VDYWxsYmFjayhcbiAgICAodmFsdWU6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0pID0+IHtcbiAgICAgIGNvbnN0IGlzQWN0aXZlRmlsdGVyVmFsdWUgPSAoa2V5OiBzdHJpbmcsIHZhbDogRGF0YVJlY29yZFZhbHVlKSA9PlxuICAgICAgICAhIXNlbGVjdGVkRmlsdGVycyAmJiBzZWxlY3RlZEZpbHRlcnNba2V5XT8uaW5jbHVkZXModmFsKTtcblxuICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBba2V5LCB2YWxdID0gT2JqZWN0LmVudHJpZXModmFsdWUpWzBdO1xuICAgICAgbGV0IHZhbHVlcyA9IHsgLi4uc2VsZWN0ZWRGaWx0ZXJzIH07XG4gICAgICBpZiAoaXNBY3RpdmVGaWx0ZXJWYWx1ZShrZXksIHZhbCkpIHtcbiAgICAgICAgdmFsdWVzID0ge307XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YWx1ZXMgPSB7IFtrZXldOiBbdmFsXSB9O1xuICAgICAgfVxuXG4gICAgICBjb25zdCBmaWx0ZXJLZXlzID0gT2JqZWN0LmtleXModmFsdWVzKTtcbiAgICAgIGNvbnN0IGdyb3VwYnkgPSBbLi4uZ3JvdXBieVJvd3NSYXcsIC4uLmdyb3VwYnlDb2x1bW5zUmF3XTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRhdGFNYXNrOiB7XG4gICAgICAgICAgZXh0cmFGb3JtRGF0YToge1xuICAgICAgICAgICAgZmlsdGVyczpcbiAgICAgICAgICAgICAgZmlsdGVyS2V5cy5sZW5ndGggPT09IDBcbiAgICAgICAgICAgICAgICA/IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgIDogZmlsdGVyS2V5cy5tYXAoa2V5ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsID0gdmFsdWVzPy5ba2V5XTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29sID1cbiAgICAgICAgICAgICAgICAgICAgICBncm91cGJ5LmZpbmQoaXRlbSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNQaHlzaWNhbENvbHVtbihpdGVtKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbSA9PT0ga2V5O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQWRob2NDb2x1bW4oaXRlbSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0ubGFiZWwgPT09IGtleTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICB9KSA/PyAnJztcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbCA9PT0gbnVsbCB8fCB2YWwgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3A6ICdJUyBOVUxMJyBhcyBjb25zdCxcbiAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgIGNvbCxcbiAgICAgICAgICAgICAgICAgICAgICBvcDogJ0lOJyBhcyBjb25zdCxcbiAgICAgICAgICAgICAgICAgICAgICB2YWw6IHZhbCBhcyAoc3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbilbXSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZmlsdGVyU3RhdGU6IHtcbiAgICAgICAgICAgIHZhbHVlOlxuICAgICAgICAgICAgICB2YWx1ZXMgJiYgT2JqZWN0LmtleXModmFsdWVzKS5sZW5ndGhcbiAgICAgICAgICAgICAgICA/IE9iamVjdC52YWx1ZXModmFsdWVzKVxuICAgICAgICAgICAgICAgIDogbnVsbCxcbiAgICAgICAgICAgIHNlbGVjdGVkRmlsdGVyczpcbiAgICAgICAgICAgICAgdmFsdWVzICYmIE9iamVjdC5rZXlzKHZhbHVlcykubGVuZ3RoID8gdmFsdWVzIDogbnVsbCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBpc0N1cnJlbnRWYWx1ZVNlbGVjdGVkOiBpc0FjdGl2ZUZpbHRlclZhbHVlKGtleSwgdmFsKSxcbiAgICAgIH07XG4gICAgfSxcbiAgICBbZ3JvdXBieUNvbHVtbnNSYXcsIGdyb3VwYnlSb3dzUmF3LCBzZWxlY3RlZEZpbHRlcnNdLFxuICApO1xuXG4gIGNvbnN0IHRvZ2dsZUZpbHRlciA9IHVzZUNhbGxiYWNrKFxuICAgIChcbiAgICAgIGU6IE1vdXNlRXZlbnQsXG4gICAgICB2YWx1ZTogc3RyaW5nLFxuICAgICAgZmlsdGVyczogRmlsdGVyVHlwZSxcbiAgICAgIHBpdm90RGF0YTogUmVjb3JkPHN0cmluZywgYW55PixcbiAgICAgIGlzU3VidG90YWw6IGJvb2xlYW4sXG4gICAgICBpc0dyYW5kVG90YWw6IGJvb2xlYW4sXG4gICAgKSA9PiB7XG4gICAgICBpZiAoaXNTdWJ0b3RhbCB8fCBpc0dyYW5kVG90YWwgfHwgIWVtaXRDcm9zc0ZpbHRlcnMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBhbGxvdyBzZWxlY3RpbmcgdGV4dCBpbiBhIGNlbGxcbiAgICAgIGlmIChnZXRTZWxlY3RlZFRleHQoKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGlzQWN0aXZlRmlsdGVyVmFsdWUgPSAoa2V5OiBzdHJpbmcsIHZhbDogRGF0YVJlY29yZFZhbHVlKSA9PlxuICAgICAgICAhIXNlbGVjdGVkRmlsdGVycyAmJiBzZWxlY3RlZEZpbHRlcnNba2V5XT8uaW5jbHVkZXModmFsKTtcblxuICAgICAgY29uc3QgZmlsdGVyc0NvcHkgPSB7IC4uLmZpbHRlcnMgfTtcbiAgICAgIGRlbGV0ZSBmaWx0ZXJzQ29weVtNRVRSSUNfS0VZXTtcblxuICAgICAgY29uc3QgZmlsdGVyc0VudHJpZXMgPSBPYmplY3QuZW50cmllcyhmaWx0ZXJzQ29weSk7XG4gICAgICBpZiAoZmlsdGVyc0VudHJpZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgW2tleSwgdmFsXSA9IGZpbHRlcnNFbnRyaWVzW2ZpbHRlcnNFbnRyaWVzLmxlbmd0aCAtIDFdO1xuXG4gICAgICBsZXQgdXBkYXRlZEZpbHRlcnMgPSB7IC4uLnNlbGVjdGVkRmlsdGVycyB9O1xuICAgICAgLy8gbXVsdGkgc2VsZWN0XG4gICAgICAvLyBpZiAoc2VsZWN0ZWRGaWx0ZXJzICYmIGlzQWN0aXZlRmlsdGVyVmFsdWUoa2V5LCB2YWwpKSB7XG4gICAgICAvLyAgIHVwZGF0ZWRGaWx0ZXJzW2tleV0gPSBzZWxlY3RlZEZpbHRlcnNba2V5XS5maWx0ZXIoKHg6IERhdGFSZWNvcmRWYWx1ZSkgPT4geCAhPT0gdmFsKTtcbiAgICAgIC8vIH0gZWxzZSB7XG4gICAgICAvLyAgIHVwZGF0ZWRGaWx0ZXJzW2tleV0gPSBbLi4uKHNlbGVjdGVkRmlsdGVycz8uW2tleV0gfHwgW10pLCB2YWxdO1xuICAgICAgLy8gfVxuICAgICAgLy8gc2luZ2xlIHNlbGVjdFxuICAgICAgaWYgKHNlbGVjdGVkRmlsdGVycyAmJiBpc0FjdGl2ZUZpbHRlclZhbHVlKGtleSwgdmFsKSkge1xuICAgICAgICB1cGRhdGVkRmlsdGVycyA9IHt9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdXBkYXRlZEZpbHRlcnMgPSB7XG4gICAgICAgICAgW2tleV06IFt2YWxdLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgaWYgKFxuICAgICAgICBBcnJheS5pc0FycmF5KHVwZGF0ZWRGaWx0ZXJzW2tleV0pICYmXG4gICAgICAgIHVwZGF0ZWRGaWx0ZXJzW2tleV0ubGVuZ3RoID09PSAwXG4gICAgICApIHtcbiAgICAgICAgZGVsZXRlIHVwZGF0ZWRGaWx0ZXJzW2tleV07XG4gICAgICB9XG4gICAgICBoYW5kbGVDaGFuZ2UodXBkYXRlZEZpbHRlcnMpO1xuICAgIH0sXG4gICAgW2VtaXRDcm9zc0ZpbHRlcnMsIHNlbGVjdGVkRmlsdGVycywgaGFuZGxlQ2hhbmdlXSxcbiAgKTtcblxuICBjb25zdCB0YWJsZU9wdGlvbnMgPSB1c2VNZW1vKFxuICAgICgpID0+ICh7XG4gICAgICBjbGlja1Jvd0hlYWRlckNhbGxiYWNrOiB0b2dnbGVGaWx0ZXIsXG4gICAgICBjbGlja0NvbHVtbkhlYWRlckNhbGxiYWNrOiB0b2dnbGVGaWx0ZXIsXG4gICAgICBjb2xUb3RhbHMsXG4gICAgICBjb2xTdWJUb3RhbHMsXG4gICAgICByb3dUb3RhbHMsXG4gICAgICByb3dTdWJUb3RhbHMsXG4gICAgICBoaWdobGlnaHRIZWFkZXJDZWxsc09uSG92ZXI6XG4gICAgICAgIGVtaXRDcm9zc0ZpbHRlcnMgfHxcbiAgICAgICAgaXNGZWF0dXJlRW5hYmxlZChGZWF0dXJlRmxhZy5EcmlsbEJ5KSB8fFxuICAgICAgICBpc0ZlYXR1cmVFbmFibGVkKEZlYXR1cmVGbGFnLkRyaWxsVG9EZXRhaWwpLFxuICAgICAgaGlnaGxpZ2h0ZWRIZWFkZXJDZWxsczogc2VsZWN0ZWRGaWx0ZXJzLFxuICAgICAgb21pdHRlZEhpZ2hsaWdodEhlYWRlckdyb3VwczogW01FVFJJQ19LRVldLFxuICAgICAgY2VsbENvbG9yRm9ybWF0dGVyczogeyBbTUVUUklDX0tFWV06IG1ldHJpY0NvbG9yRm9ybWF0dGVycyB9LFxuICAgICAgZGF0ZUZvcm1hdHRlcnMsXG4gICAgfSksXG4gICAgW1xuICAgICAgY29sVG90YWxzLFxuICAgICAgY29sU3ViVG90YWxzLFxuICAgICAgZGF0ZUZvcm1hdHRlcnMsXG4gICAgICBlbWl0Q3Jvc3NGaWx0ZXJzLFxuICAgICAgbWV0cmljQ29sb3JGb3JtYXR0ZXJzLFxuICAgICAgcm93VG90YWxzLFxuICAgICAgcm93U3ViVG90YWxzLFxuICAgICAgc2VsZWN0ZWRGaWx0ZXJzLFxuICAgICAgdG9nZ2xlRmlsdGVyLFxuICAgIF0sXG4gICk7XG5cbiAgY29uc3Qgc3VidG90YWxPcHRpb25zID0gdXNlTWVtbyhcbiAgICAoKSA9PiAoe1xuICAgICAgY29sU3VidG90YWxEaXNwbGF5OiB7IGRpc3BsYXlPblRvcDogY29sU3VidG90YWxQb3NpdGlvbiB9LFxuICAgICAgcm93U3VidG90YWxEaXNwbGF5OiB7IGRpc3BsYXlPblRvcDogcm93U3VidG90YWxQb3NpdGlvbiB9LFxuICAgICAgYXJyb3dDb2xsYXBzZWQ6IDxTdHlsZWRQbHVzU3F1YXJlT3V0bGluZWQgLz4sXG4gICAgICBhcnJvd0V4cGFuZGVkOiA8U3R5bGVkTWludXNTcXVhcmVPdXRsaW5lZCAvPixcbiAgICB9KSxcbiAgICBbY29sU3VidG90YWxQb3NpdGlvbiwgcm93U3VidG90YWxQb3NpdGlvbl0sXG4gICk7XG5cbiAgY29uc3QgaGFuZGxlQ29udGV4dE1lbnUgPSB1c2VDYWxsYmFjayhcbiAgICAoXG4gICAgICBlOiBNb3VzZUV2ZW50LFxuICAgICAgY29sS2V5OiAoc3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbilbXSB8IHVuZGVmaW5lZCxcbiAgICAgIHJvd0tleTogKHN0cmluZyB8IG51bWJlciB8IGJvb2xlYW4pW10gfCB1bmRlZmluZWQsXG4gICAgICBkYXRhUG9pbnQ6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0sXG4gICAgKSA9PiB7XG4gICAgICBpZiAob25Db250ZXh0TWVudSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGNvbnN0IGRyaWxsVG9EZXRhaWxGaWx0ZXJzOiBCaW5hcnlRdWVyeU9iamVjdEZpbHRlckNsYXVzZVtdID0gW107XG4gICAgICAgIGlmIChjb2xLZXkgJiYgY29sS2V5Lmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICBjb2xLZXkuZm9yRWFjaCgodmFsLCBpKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb2wgPSBjb2xzW2ldO1xuICAgICAgICAgICAgY29uc3QgZm9ybWF0dGVyID0gZGF0ZUZvcm1hdHRlcnNbY29sXTtcbiAgICAgICAgICAgIGNvbnN0IGZvcm1hdHRlZFZhbCA9IGZvcm1hdHRlcj8uKHZhbCBhcyBudW1iZXIpIHx8IFN0cmluZyh2YWwpO1xuICAgICAgICAgICAgaWYgKGkgPiAwKSB7XG4gICAgICAgICAgICAgIGRyaWxsVG9EZXRhaWxGaWx0ZXJzLnB1c2goe1xuICAgICAgICAgICAgICAgIGNvbCxcbiAgICAgICAgICAgICAgICBvcDogJz09JyxcbiAgICAgICAgICAgICAgICB2YWwsXG4gICAgICAgICAgICAgICAgZm9ybWF0dGVkVmFsLFxuICAgICAgICAgICAgICAgIGdyYWluOiBmb3JtYXR0ZXIgPyB0aW1lR3JhaW5TcWxhIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocm93S2V5KSB7XG4gICAgICAgICAgcm93S2V5LmZvckVhY2goKHZhbCwgaSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29sID0gcm93c1tpXTtcbiAgICAgICAgICAgIGNvbnN0IGZvcm1hdHRlciA9IGRhdGVGb3JtYXR0ZXJzW2NvbF07XG4gICAgICAgICAgICBjb25zdCBmb3JtYXR0ZWRWYWwgPSBmb3JtYXR0ZXI/Lih2YWwgYXMgbnVtYmVyKSB8fCBTdHJpbmcodmFsKTtcbiAgICAgICAgICAgIGRyaWxsVG9EZXRhaWxGaWx0ZXJzLnB1c2goe1xuICAgICAgICAgICAgICBjb2wsXG4gICAgICAgICAgICAgIG9wOiAnPT0nLFxuICAgICAgICAgICAgICB2YWwsXG4gICAgICAgICAgICAgIGZvcm1hdHRlZFZhbCxcbiAgICAgICAgICAgICAgZ3JhaW46IGZvcm1hdHRlciA/IHRpbWVHcmFpblNxbGEgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBvbkNvbnRleHRNZW51KGUuY2xpZW50WCwgZS5jbGllbnRZLCB7XG4gICAgICAgICAgZHJpbGxUb0RldGFpbDogZHJpbGxUb0RldGFpbEZpbHRlcnMsXG4gICAgICAgICAgY3Jvc3NGaWx0ZXI6IGdldENyb3NzRmlsdGVyRGF0YU1hc2soZGF0YVBvaW50KSxcbiAgICAgICAgICBkcmlsbEJ5OiBkYXRhUG9pbnQgJiYge1xuICAgICAgICAgICAgZmlsdGVyczogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgY29sOiBPYmplY3Qua2V5cyhkYXRhUG9pbnQpWzBdLFxuICAgICAgICAgICAgICAgIG9wOiAnPT0nLFxuICAgICAgICAgICAgICAgIHZhbDogT2JqZWN0LnZhbHVlcyhkYXRhUG9pbnQpWzBdLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIGdyb3VwYnlGaWVsZE5hbWU6IHJvd0tleSA/ICdncm91cGJ5Um93cycgOiAnZ3JvdXBieUNvbHVtbnMnLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgW1xuICAgICAgY29scyxcbiAgICAgIGRhdGVGb3JtYXR0ZXJzLFxuICAgICAgZ2V0Q3Jvc3NGaWx0ZXJEYXRhTWFzayxcbiAgICAgIG9uQ29udGV4dE1lbnUsXG4gICAgICByb3dzLFxuICAgICAgdGltZUdyYWluU3FsYSxcbiAgICBdLFxuICApO1xuXG4gIHJldHVybiAoXG4gICAgPFN0eWxlcyBoZWlnaHQ9e2hlaWdodH0gd2lkdGg9e3dpZHRofSBtYXJnaW49e3RoZW1lLnNpemVVbml0ICogNH0+XG4gICAgICA8UGl2b3RUYWJsZVdyYXBwZXI+XG4gICAgICAgIDxQaXZvdFRhYmxlXG4gICAgICAgICAgZGF0YT17dW5waXZvdGVkRGF0YX1cbiAgICAgICAgICByb3dzPXtyb3dzfVxuICAgICAgICAgIGNvbHM9e2NvbHN9XG4gICAgICAgICAgYWdncmVnYXRvcnNGYWN0b3J5PXthZ2dyZWdhdG9yc0ZhY3Rvcnl9XG4gICAgICAgICAgZGVmYXVsdEZvcm1hdHRlcj17ZGVmYXVsdEZvcm1hdHRlcn1cbiAgICAgICAgICBjdXN0b21Gb3JtYXR0ZXJzPXttZXRyaWNGb3JtYXR0ZXJzfVxuICAgICAgICAgIGFnZ3JlZ2F0b3JOYW1lPXthZ2dyZWdhdGVGdW5jdGlvbn1cbiAgICAgICAgICB2YWxzPXt2YWxzfVxuICAgICAgICAgIGNvbE9yZGVyPXtjb2xPcmRlcn1cbiAgICAgICAgICByb3dPcmRlcj17cm93T3JkZXJ9XG4gICAgICAgICAgc29ydGVycz17c29ydGVyc31cbiAgICAgICAgICB0YWJsZU9wdGlvbnM9e3RhYmxlT3B0aW9uc31cbiAgICAgICAgICBzdWJ0b3RhbE9wdGlvbnM9e3N1YnRvdGFsT3B0aW9uc31cbiAgICAgICAgICBuYW1lc01hcHBpbmc9e3ZlcmJvc2VNYXB9XG4gICAgICAgICAgb25Db250ZXh0TWVudT17aGFuZGxlQ29udGV4dE1lbnV9XG4gICAgICAgICAgYWxsb3dSZW5kZXJIdG1sPXthbGxvd1JlbmRlckh0bWx9XG4gICAgICAgIC8+XG4gICAgICA8L1Bpdm90VGFibGVXcmFwcGVyPlxuICAgIDwvU3R5bGVzPlxuICApO1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./plugins/plugin-chart-pivot-table/src/PivotTableChart.tsx\n\n}");

/***/ }),

/***/ "./plugins/plugin-chart-pivot-table/src/react-pivottable/PivotTable.jsx":
/*!******************************************************************************!*\
  !*** ./plugins/plugin-chart-pivot-table/src/react-pivottable/PivotTable.jsx ***!
  \******************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("{/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @emotion/react/jsx-dev-runtime */ \"./node_modules/@emotion/react/jsx-dev-runtime/dist/emotion-react-jsx-dev-runtime.browser.development.esm.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ \"webpack/sharing/consume/default/react/react\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _TableRenderers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./TableRenderers */ \"./plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\");\n/* provided dependency */ var __react_refresh_utils__ = __webpack_require__(/*! ./node_modules/@pmmmwh/react-refresh-webpack-plugin/lib/runtime/RefreshUtils.js */ \"./node_modules/@pmmmwh/react-refresh-webpack-plugin/lib/runtime/RefreshUtils.js\");\n/* provided dependency */ var __react_refresh_error_overlay__ = __webpack_require__(/*! ./node_modules/@pmmmwh/react-refresh-webpack-plugin/overlay/index.js */ \"./node_modules/@pmmmwh/react-refresh-webpack-plugin/overlay/index.js\");\n__webpack_require__.$Refresh$.runtime = __webpack_require__(/*! ./node_modules/react-refresh/runtime.js */ \"./node_modules/react-refresh/runtime.js\");\n\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */ function _extends() {\n    _extends = Object.assign || function(target) {\n        for(var i = 1; i < arguments.length; i++){\n            var source = arguments[i];\n            for(var key in source){\n                if (Object.prototype.hasOwnProperty.call(source, key)) {\n                    target[key] = source[key];\n                }\n            }\n        }\n        return target;\n    };\n    return _extends.apply(this, arguments);\n}\n\n\n\nclass PivotTable extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent {\n    render() {\n        return /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(_TableRenderers__WEBPACK_IMPORTED_MODULE_2__.TableRenderer, _extends({}, this.props), void 0, false, {\n            fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/PivotTable.jsx\",\n            lineNumber: 25,\n            columnNumber: 12\n        }, this);\n    }\n}\nPivotTable.propTypes = _TableRenderers__WEBPACK_IMPORTED_MODULE_2__.TableRenderer.propTypes;\nPivotTable.defaultProps = _TableRenderers__WEBPACK_IMPORTED_MODULE_2__.TableRenderer.defaultProps;\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PivotTable);\n\n\nconst $ReactRefreshModuleId$ = __webpack_require__.$Refresh$.moduleId;\nconst $ReactRefreshCurrentExports$ = __react_refresh_utils__.getModuleExports(\n\t$ReactRefreshModuleId$\n);\n\nfunction $ReactRefreshModuleRuntime$(exports) {\n\tif (true) {\n\t\tlet errorOverlay;\n\t\tif (typeof __react_refresh_error_overlay__ !== 'undefined') {\n\t\t\terrorOverlay = __react_refresh_error_overlay__;\n\t\t}\n\t\tlet testMode;\n\t\tif (typeof __react_refresh_test__ !== 'undefined') {\n\t\t\ttestMode = __react_refresh_test__;\n\t\t}\n\t\treturn __react_refresh_utils__.executeRuntime(\n\t\t\texports,\n\t\t\t$ReactRefreshModuleId$,\n\t\t\tmodule.hot,\n\t\t\terrorOverlay,\n\t\t\ttestMode\n\t\t);\n\t}\n}\n\nif (typeof Promise !== 'undefined' && $ReactRefreshCurrentExports$ instanceof Promise) {\n\t$ReactRefreshCurrentExports$.then($ReactRefreshModuleRuntime$);\n} else {\n\t$ReactRefreshModuleRuntime$($ReactRefreshCurrentExports$);\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wbHVnaW5zL3BsdWdpbi1jaGFydC1waXZvdC10YWJsZS9zcmMvcmVhY3QtcGl2b3R0YWJsZS9QaXZvdFRhYmxlLmpzeCIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOzs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQTs7Ozs7Ozs7Ozs7Ozs7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7Ozs7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3VwZXJzZXQvLi9wbHVnaW5zL3BsdWdpbi1jaGFydC1waXZvdC10YWJsZS9zcmMvcmVhY3QtcGl2b3R0YWJsZS9QaXZvdFRhYmxlLmpzeD85Zjg1Il0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgUHVyZUNvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IFRhYmxlUmVuZGVyZXIgfSBmcm9tICcuL1RhYmxlUmVuZGVyZXJzJztcblxuY2xhc3MgUGl2b3RUYWJsZSBleHRlbmRzIFB1cmVDb21wb25lbnQge1xuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIDxUYWJsZVJlbmRlcmVyIHsuLi50aGlzLnByb3BzfSAvPjtcbiAgfVxufVxuXG5QaXZvdFRhYmxlLnByb3BUeXBlcyA9IFRhYmxlUmVuZGVyZXIucHJvcFR5cGVzO1xuUGl2b3RUYWJsZS5kZWZhdWx0UHJvcHMgPSBUYWJsZVJlbmRlcmVyLmRlZmF1bHRQcm9wcztcblxuZXhwb3J0IGRlZmF1bHQgUGl2b3RUYWJsZTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./plugins/plugin-chart-pivot-table/src/react-pivottable/PivotTable.jsx\n\n}");

/***/ }),

/***/ "./plugins/plugin-chart-pivot-table/src/react-pivottable/Styles.js":
/*!*************************************************************************!*\
  !*** ./plugins/plugin-chart-pivot-table/src/react-pivottable/Styles.js ***!
  \*************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("{/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Styles: () => (/* binding */ Styles)\n/* harmony export */ });\n/* harmony import */ var _apache_superset_core_ui__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @apache-superset/core/ui */ \"./packages/superset-core/src/ui/theme/index.tsx\");\n/* harmony import */ var _apache_superset_core_ui__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @apache-superset/core/ui */ \"./node_modules/@emotion/react/dist/emotion-react.browser.development.esm.js\");\n/* provided dependency */ var __react_refresh_utils__ = __webpack_require__(/*! ./node_modules/@pmmmwh/react-refresh-webpack-plugin/lib/runtime/RefreshUtils.js */ \"./node_modules/@pmmmwh/react-refresh-webpack-plugin/lib/runtime/RefreshUtils.js\");\n/* provided dependency */ var __react_refresh_error_overlay__ = __webpack_require__(/*! ./node_modules/@pmmmwh/react-refresh-webpack-plugin/overlay/index.js */ \"./node_modules/@pmmmwh/react-refresh-webpack-plugin/overlay/index.js\");\n__webpack_require__.$Refresh$.runtime = __webpack_require__(/*! ./node_modules/react-refresh/runtime.js */ \"./node_modules/react-refresh/runtime.js\");\n\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */ \nconst Styles = _apache_superset_core_ui__WEBPACK_IMPORTED_MODULE_0__.styled.div`\n  ${({ theme, isDashboardEditMode })=>(0,_apache_superset_core_ui__WEBPACK_IMPORTED_MODULE_1__.css)`\n    table.pvtTable {\n      position: ${isDashboardEditMode ? 'inherit' : 'relative'};\n      width: calc(100% - ${theme.sizeUnit}px);\n      font-size: ${theme.fontSizeSM}px;\n      text-align: left;\n      margin: ${theme.sizeUnit}px;\n      border-collapse: separate;\n      font-family: ${theme.fontFamily};\n      line-height: 1.4;\n    }\n\n    table thead {\n      background-color: ${theme.colorBgBase};\n      position: ${isDashboardEditMode ? 'inherit' : 'sticky'};\n      top: 0;\n    }\n\n    table tbody tr {\n      font-feature-settings: 'tnum' 1;\n    }\n\n    table.pvtTable thead tr th,\n    table.pvtTable tbody tr th {\n      border-top: 1px solid ${theme.colorSplit};\n      border-left: 1px solid ${theme.colorSplit};\n      font-size: ${theme.fontSizeSM}px;\n      padding: ${theme.sizeUnit}px;\n      font-weight: ${theme.fontWeightNormal};\n    }\n\n    table.pvtTable tbody tr.pvtRowTotals {\n      position: ${isDashboardEditMode ? 'inherit' : 'sticky'};\n      bottom: 0;\n    }\n\n    table.pvtTable thead tr:last-of-type th,\n    table.pvtTable thead tr:first-of-type th.pvtTotalLabel,\n    table.pvtTable thead tr:nth-last-of-type(2) th.pvtColLabel,\n    table.pvtTable thead th.pvtSubtotalLabel,\n    table.pvtTable tbody tr:last-of-type th,\n    table.pvtTable tbody tr:last-of-type td {\n      border-bottom: 1px solid ${theme.colorSplit};\n    }\n\n    table.pvtTable\n      thead\n      tr:last-of-type:not(:only-child)\n      th.pvtAxisLabel\n      ~ th.pvtColLabel,\n    table.pvtTable tbody tr:first-of-type th,\n    table.pvtTable tbody tr:first-of-type td {\n      border-top: none;\n    }\n\n    table.pvtTable tbody tr td:last-of-type,\n    table.pvtTable thead tr th:last-of-type:not(.pvtSubtotalLabel) {\n      border-right: 1px solid ${theme.colorSplit};\n    }\n\n    table.pvtTable\n      thead\n      tr:last-of-type:not(:only-child)\n      th.pvtAxisLabel\n      + .pvtTotalLabel {\n      border-right: none;\n    }\n\n    table.pvtTable tr th.active {\n      background-color: ${theme.colorPrimaryBg};\n    }\n\n    table.pvtTable .pvtTotalLabel {\n      text-align: right;\n      font-weight: ${theme.fontWeightStrong};\n    }\n\n    table.pvtTable .pvtSubtotalLabel {\n      font-weight: ${theme.fontWeightStrong};\n    }\n\n    table.pvtTable tbody tr td {\n      color: ${theme.colorPrimaryText};\n      padding: ${theme.sizeUnit}px;\n      background-color: ${theme.colorBgBase};\n      border-top: 1px solid ${theme.colorSplit};\n      border-left: 1px solid ${theme.colorSplit};\n      vertical-align: top;\n      text-align: right;\n    }\n\n    table.pvtTable tbody tr th.pvtRowLabel {\n      vertical-align: baseline;\n    }\n\n    .pvtTotal,\n    .pvtGrandTotal {\n      font-weight: ${theme.fontWeightStrong};\n    }\n\n    table.pvtTable tbody tr td.pvtRowTotal {\n      vertical-align: middle;\n    }\n\n    .toggle-wrapper {\n      white-space: nowrap;\n    }\n\n    .toggle-wrapper > .toggle-val {\n      white-space: normal;\n    }\n\n    .toggle {\n      padding-right: ${theme.sizeUnit}px;\n      cursor: pointer;\n    }\n\n    .hoverable:hover {\n      background-color: ${theme.colorPrimaryBgHover};\n      cursor: pointer;\n    }\n  `}\n`;\n\n\nconst $ReactRefreshModuleId$ = __webpack_require__.$Refresh$.moduleId;\nconst $ReactRefreshCurrentExports$ = __react_refresh_utils__.getModuleExports(\n\t$ReactRefreshModuleId$\n);\n\nfunction $ReactRefreshModuleRuntime$(exports) {\n\tif (true) {\n\t\tlet errorOverlay;\n\t\tif (typeof __react_refresh_error_overlay__ !== 'undefined') {\n\t\t\terrorOverlay = __react_refresh_error_overlay__;\n\t\t}\n\t\tlet testMode;\n\t\tif (typeof __react_refresh_test__ !== 'undefined') {\n\t\t\ttestMode = __react_refresh_test__;\n\t\t}\n\t\treturn __react_refresh_utils__.executeRuntime(\n\t\t\texports,\n\t\t\t$ReactRefreshModuleId$,\n\t\t\tmodule.hot,\n\t\t\terrorOverlay,\n\t\t\ttestMode\n\t\t);\n\t}\n}\n\nif (typeof Promise !== 'undefined' && $ReactRefreshCurrentExports$ instanceof Promise) {\n\t$ReactRefreshCurrentExports$.then($ReactRefreshModuleRuntime$);\n} else {\n\t$ReactRefreshModuleRuntime$($ReactRefreshCurrentExports$);\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wbHVnaW5zL3BsdWdpbi1jaGFydC1waXZvdC10YWJsZS9zcmMvcmVhY3QtcGl2b3R0YWJsZS9TdHlsZXMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBaUJBO0FBSUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7Ozs7O0FBS0E7QUFDQTs7Ozs7Ozs7OztBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTs7Ozs7Ozs7OztBQVVBOzs7Ozs7Ozs7Ozs7Ozs7QUFlQTs7Ozs7Ozs7Ozs7O0FBWUE7Ozs7O0FBS0E7Ozs7QUFJQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FBV0E7Ozs7Ozs7Ozs7Ozs7Ozs7QUFnQkE7Ozs7O0FBS0E7OztBQUdBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zdXBlcnNldC8uL3BsdWdpbnMvcGx1Z2luLWNoYXJ0LXBpdm90LXRhYmxlL3NyYy9yZWFjdC1waXZvdHRhYmxlL1N0eWxlcy5qcz8wOGFjIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgY3NzLCBzdHlsZWQgfSBmcm9tICdAYXBhY2hlLXN1cGVyc2V0L2NvcmUvdWknO1xuXG5leHBvcnQgY29uc3QgU3R5bGVzID0gc3R5bGVkLmRpdmBcbiAgJHsoeyB0aGVtZSwgaXNEYXNoYm9hcmRFZGl0TW9kZSB9KSA9PiBjc3NgXG4gICAgdGFibGUucHZ0VGFibGUge1xuICAgICAgcG9zaXRpb246ICR7aXNEYXNoYm9hcmRFZGl0TW9kZSA/ICdpbmhlcml0JyA6ICdyZWxhdGl2ZSd9O1xuICAgICAgd2lkdGg6IGNhbGMoMTAwJSAtICR7dGhlbWUuc2l6ZVVuaXR9cHgpO1xuICAgICAgZm9udC1zaXplOiAke3RoZW1lLmZvbnRTaXplU019cHg7XG4gICAgICB0ZXh0LWFsaWduOiBsZWZ0O1xuICAgICAgbWFyZ2luOiAke3RoZW1lLnNpemVVbml0fXB4O1xuICAgICAgYm9yZGVyLWNvbGxhcHNlOiBzZXBhcmF0ZTtcbiAgICAgIGZvbnQtZmFtaWx5OiAke3RoZW1lLmZvbnRGYW1pbHl9O1xuICAgICAgbGluZS1oZWlnaHQ6IDEuNDtcbiAgICB9XG5cbiAgICB0YWJsZSB0aGVhZCB7XG4gICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAke3RoZW1lLmNvbG9yQmdCYXNlfTtcbiAgICAgIHBvc2l0aW9uOiAke2lzRGFzaGJvYXJkRWRpdE1vZGUgPyAnaW5oZXJpdCcgOiAnc3RpY2t5J307XG4gICAgICB0b3A6IDA7XG4gICAgfVxuXG4gICAgdGFibGUgdGJvZHkgdHIge1xuICAgICAgZm9udC1mZWF0dXJlLXNldHRpbmdzOiAndG51bScgMTtcbiAgICB9XG5cbiAgICB0YWJsZS5wdnRUYWJsZSB0aGVhZCB0ciB0aCxcbiAgICB0YWJsZS5wdnRUYWJsZSB0Ym9keSB0ciB0aCB7XG4gICAgICBib3JkZXItdG9wOiAxcHggc29saWQgJHt0aGVtZS5jb2xvclNwbGl0fTtcbiAgICAgIGJvcmRlci1sZWZ0OiAxcHggc29saWQgJHt0aGVtZS5jb2xvclNwbGl0fTtcbiAgICAgIGZvbnQtc2l6ZTogJHt0aGVtZS5mb250U2l6ZVNNfXB4O1xuICAgICAgcGFkZGluZzogJHt0aGVtZS5zaXplVW5pdH1weDtcbiAgICAgIGZvbnQtd2VpZ2h0OiAke3RoZW1lLmZvbnRXZWlnaHROb3JtYWx9O1xuICAgIH1cblxuICAgIHRhYmxlLnB2dFRhYmxlIHRib2R5IHRyLnB2dFJvd1RvdGFscyB7XG4gICAgICBwb3NpdGlvbjogJHtpc0Rhc2hib2FyZEVkaXRNb2RlID8gJ2luaGVyaXQnIDogJ3N0aWNreSd9O1xuICAgICAgYm90dG9tOiAwO1xuICAgIH1cblxuICAgIHRhYmxlLnB2dFRhYmxlIHRoZWFkIHRyOmxhc3Qtb2YtdHlwZSB0aCxcbiAgICB0YWJsZS5wdnRUYWJsZSB0aGVhZCB0cjpmaXJzdC1vZi10eXBlIHRoLnB2dFRvdGFsTGFiZWwsXG4gICAgdGFibGUucHZ0VGFibGUgdGhlYWQgdHI6bnRoLWxhc3Qtb2YtdHlwZSgyKSB0aC5wdnRDb2xMYWJlbCxcbiAgICB0YWJsZS5wdnRUYWJsZSB0aGVhZCB0aC5wdnRTdWJ0b3RhbExhYmVsLFxuICAgIHRhYmxlLnB2dFRhYmxlIHRib2R5IHRyOmxhc3Qtb2YtdHlwZSB0aCxcbiAgICB0YWJsZS5wdnRUYWJsZSB0Ym9keSB0cjpsYXN0LW9mLXR5cGUgdGQge1xuICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICR7dGhlbWUuY29sb3JTcGxpdH07XG4gICAgfVxuXG4gICAgdGFibGUucHZ0VGFibGVcbiAgICAgIHRoZWFkXG4gICAgICB0cjpsYXN0LW9mLXR5cGU6bm90KDpvbmx5LWNoaWxkKVxuICAgICAgdGgucHZ0QXhpc0xhYmVsXG4gICAgICB+IHRoLnB2dENvbExhYmVsLFxuICAgIHRhYmxlLnB2dFRhYmxlIHRib2R5IHRyOmZpcnN0LW9mLXR5cGUgdGgsXG4gICAgdGFibGUucHZ0VGFibGUgdGJvZHkgdHI6Zmlyc3Qtb2YtdHlwZSB0ZCB7XG4gICAgICBib3JkZXItdG9wOiBub25lO1xuICAgIH1cblxuICAgIHRhYmxlLnB2dFRhYmxlIHRib2R5IHRyIHRkOmxhc3Qtb2YtdHlwZSxcbiAgICB0YWJsZS5wdnRUYWJsZSB0aGVhZCB0ciB0aDpsYXN0LW9mLXR5cGU6bm90KC5wdnRTdWJ0b3RhbExhYmVsKSB7XG4gICAgICBib3JkZXItcmlnaHQ6IDFweCBzb2xpZCAke3RoZW1lLmNvbG9yU3BsaXR9O1xuICAgIH1cblxuICAgIHRhYmxlLnB2dFRhYmxlXG4gICAgICB0aGVhZFxuICAgICAgdHI6bGFzdC1vZi10eXBlOm5vdCg6b25seS1jaGlsZClcbiAgICAgIHRoLnB2dEF4aXNMYWJlbFxuICAgICAgKyAucHZ0VG90YWxMYWJlbCB7XG4gICAgICBib3JkZXItcmlnaHQ6IG5vbmU7XG4gICAgfVxuXG4gICAgdGFibGUucHZ0VGFibGUgdHIgdGguYWN0aXZlIHtcbiAgICAgIGJhY2tncm91bmQtY29sb3I6ICR7dGhlbWUuY29sb3JQcmltYXJ5Qmd9O1xuICAgIH1cblxuICAgIHRhYmxlLnB2dFRhYmxlIC5wdnRUb3RhbExhYmVsIHtcbiAgICAgIHRleHQtYWxpZ246IHJpZ2h0O1xuICAgICAgZm9udC13ZWlnaHQ6ICR7dGhlbWUuZm9udFdlaWdodFN0cm9uZ307XG4gICAgfVxuXG4gICAgdGFibGUucHZ0VGFibGUgLnB2dFN1YnRvdGFsTGFiZWwge1xuICAgICAgZm9udC13ZWlnaHQ6ICR7dGhlbWUuZm9udFdlaWdodFN0cm9uZ307XG4gICAgfVxuXG4gICAgdGFibGUucHZ0VGFibGUgdGJvZHkgdHIgdGQge1xuICAgICAgY29sb3I6ICR7dGhlbWUuY29sb3JQcmltYXJ5VGV4dH07XG4gICAgICBwYWRkaW5nOiAke3RoZW1lLnNpemVVbml0fXB4O1xuICAgICAgYmFja2dyb3VuZC1jb2xvcjogJHt0aGVtZS5jb2xvckJnQmFzZX07XG4gICAgICBib3JkZXItdG9wOiAxcHggc29saWQgJHt0aGVtZS5jb2xvclNwbGl0fTtcbiAgICAgIGJvcmRlci1sZWZ0OiAxcHggc29saWQgJHt0aGVtZS5jb2xvclNwbGl0fTtcbiAgICAgIHZlcnRpY2FsLWFsaWduOiB0b3A7XG4gICAgICB0ZXh0LWFsaWduOiByaWdodDtcbiAgICB9XG5cbiAgICB0YWJsZS5wdnRUYWJsZSB0Ym9keSB0ciB0aC5wdnRSb3dMYWJlbCB7XG4gICAgICB2ZXJ0aWNhbC1hbGlnbjogYmFzZWxpbmU7XG4gICAgfVxuXG4gICAgLnB2dFRvdGFsLFxuICAgIC5wdnRHcmFuZFRvdGFsIHtcbiAgICAgIGZvbnQtd2VpZ2h0OiAke3RoZW1lLmZvbnRXZWlnaHRTdHJvbmd9O1xuICAgIH1cblxuICAgIHRhYmxlLnB2dFRhYmxlIHRib2R5IHRyIHRkLnB2dFJvd1RvdGFsIHtcbiAgICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7XG4gICAgfVxuXG4gICAgLnRvZ2dsZS13cmFwcGVyIHtcbiAgICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7XG4gICAgfVxuXG4gICAgLnRvZ2dsZS13cmFwcGVyID4gLnRvZ2dsZS12YWwge1xuICAgICAgd2hpdGUtc3BhY2U6IG5vcm1hbDtcbiAgICB9XG5cbiAgICAudG9nZ2xlIHtcbiAgICAgIHBhZGRpbmctcmlnaHQ6ICR7dGhlbWUuc2l6ZVVuaXR9cHg7XG4gICAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgfVxuXG4gICAgLmhvdmVyYWJsZTpob3ZlciB7XG4gICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAke3RoZW1lLmNvbG9yUHJpbWFyeUJnSG92ZXJ9O1xuICAgICAgY3Vyc29yOiBwb2ludGVyO1xuICAgIH1cbiAgYH1cbmA7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./plugins/plugin-chart-pivot-table/src/react-pivottable/Styles.js\n\n}");

/***/ }),

/***/ "./plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx":
/*!**********************************************************************************!*\
  !*** ./plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx ***!
  \**********************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("{/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TableRenderer: () => (/* binding */ TableRenderer)\n/* harmony export */ });\n/* harmony import */ var _emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @emotion/react/jsx-dev-runtime */ \"./node_modules/@emotion/react/jsx-dev-runtime/dist/emotion-react-jsx-dev-runtime.browser.development.esm.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ \"webpack/sharing/consume/default/react/react\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _superset_ui_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @superset-ui/core */ \"./packages/superset-ui-core/src/translation/TranslatorSingleton.ts\");\n/* harmony import */ var _superset_ui_core__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @superset-ui/core */ \"./packages/superset-ui-core/src/utils/html.tsx\");\n/* harmony import */ var prop_types__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! prop-types */ \"./node_modules/prop-types/index.js\");\n/* harmony import */ var prop_types__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var _utilities__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./utilities */ \"./plugins/plugin-chart-pivot-table/src/react-pivottable/utilities.js\");\n/* harmony import */ var _Styles__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./Styles */ \"./plugins/plugin-chart-pivot-table/src/react-pivottable/Styles.js\");\n/* provided dependency */ var __react_refresh_utils__ = __webpack_require__(/*! ./node_modules/@pmmmwh/react-refresh-webpack-plugin/lib/runtime/RefreshUtils.js */ \"./node_modules/@pmmmwh/react-refresh-webpack-plugin/lib/runtime/RefreshUtils.js\");\n/* provided dependency */ var __react_refresh_error_overlay__ = __webpack_require__(/*! ./node_modules/@pmmmwh/react-refresh-webpack-plugin/overlay/index.js */ \"./node_modules/@pmmmwh/react-refresh-webpack-plugin/overlay/index.js\");\n__webpack_require__.$Refresh$.runtime = __webpack_require__(/*! ./node_modules/react-refresh/runtime.js */ \"./node_modules/react-refresh/runtime.js\");\n\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */ function _extends() {\n    _extends = Object.assign || function(target) {\n        for(var i = 1; i < arguments.length; i++){\n            var source = arguments[i];\n            for(var key in source){\n                if (Object.prototype.hasOwnProperty.call(source, key)) {\n                    target[key] = source[key];\n                }\n            }\n        }\n        return target;\n    };\n    return _extends.apply(this, arguments);\n}\n\n\n\n\n\n\nconst parseLabel = (value)=>{\n    if (typeof value === 'string') {\n        if (value === 'metric') return (0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_2__.t)('metric');\n        return value;\n    }\n    if (typeof value === 'number') {\n        return value;\n    }\n    return String(value);\n};\nfunction displayCell(value, allowRenderHtml) {\n    if (allowRenderHtml && typeof value === 'string') {\n        return (0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_3__.safeHtmlSpan)(value);\n    }\n    return parseLabel(value);\n}\nfunction displayHeaderCell(needToggle, ArrowIcon, onArrowClick, value, namesMapping, allowRenderHtml) {\n    const name = namesMapping[value] || value;\n    const parsedLabel = parseLabel(name);\n    const labelContent = allowRenderHtml && typeof parsedLabel === 'string' ? (0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_3__.safeHtmlSpan)(parsedLabel) : parsedLabel;\n    return needToggle ? /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"span\", {\n        className: \"toggle-wrapper\",\n        children: [\n            /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"span\", {\n                role: \"button\",\n                tabIndex: \"0\",\n                className: \"toggle\",\n                onClick: onArrowClick,\n                children: ArrowIcon\n            }, void 0, false, {\n                fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n                lineNumber: 59,\n                columnNumber: 7\n            }, this),\n            /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"span\", {\n                className: \"toggle-val\",\n                children: labelContent\n            }, void 0, false, {\n                fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n                lineNumber: 67,\n                columnNumber: 7\n            }, this)\n        ]\n    }, void 0, true, {\n        fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n        lineNumber: 58,\n        columnNumber: 5\n    }, this) : labelContent;\n}\nclass TableRenderer extends react__WEBPACK_IMPORTED_MODULE_1__.Component {\n    getBasePivotSettings() {\n        // One-time extraction of pivot settings that we'll use throughout the render.\n        const { props } = this;\n        const colAttrs = props.cols;\n        const rowAttrs = props.rows;\n        const tableOptions = _extends({\n            rowTotals: true,\n            colTotals: true\n        }, props.tableOptions);\n        const rowTotals = tableOptions.rowTotals || colAttrs.length === 0;\n        const colTotals = tableOptions.colTotals || rowAttrs.length === 0;\n        const namesMapping = props.namesMapping || {};\n        const subtotalOptions = _extends({\n            arrowCollapsed: '\\u25B2',\n            arrowExpanded: '\\u25BC'\n        }, props.subtotalOptions);\n        const colSubtotalDisplay = _extends({\n            displayOnTop: false,\n            enabled: tableOptions.colSubTotals,\n            hideOnExpand: false\n        }, subtotalOptions.colSubtotalDisplay);\n        const rowSubtotalDisplay = _extends({\n            displayOnTop: false,\n            enabled: tableOptions.rowSubTotals,\n            hideOnExpand: false\n        }, subtotalOptions.rowSubtotalDisplay);\n        const pivotData = new _utilities__WEBPACK_IMPORTED_MODULE_5__.PivotData(props, {\n            rowEnabled: rowSubtotalDisplay.enabled,\n            colEnabled: colSubtotalDisplay.enabled,\n            rowPartialOnTop: rowSubtotalDisplay.displayOnTop,\n            colPartialOnTop: colSubtotalDisplay.displayOnTop\n        });\n        const rowKeys = pivotData.getRowKeys();\n        const colKeys = pivotData.getColKeys();\n        // Also pre-calculate all the callbacks for cells, etc... This is nice to have to\n        // avoid re-calculations of the call-backs on cell expansions, etc...\n        const cellCallbacks = {};\n        const rowTotalCallbacks = {};\n        const colTotalCallbacks = {};\n        let grandTotalCallback = null;\n        if (tableOptions.clickCallback) {\n            rowKeys.forEach((rowKey)=>{\n                const flatRowKey = (0,_utilities__WEBPACK_IMPORTED_MODULE_5__.flatKey)(rowKey);\n                if (!(flatRowKey in cellCallbacks)) {\n                    cellCallbacks[flatRowKey] = {};\n                }\n                colKeys.forEach((colKey)=>{\n                    cellCallbacks[flatRowKey][(0,_utilities__WEBPACK_IMPORTED_MODULE_5__.flatKey)(colKey)] = this.clickHandler(pivotData, rowKey, colKey);\n                });\n            });\n            // Add in totals as well.\n            if (rowTotals) {\n                rowKeys.forEach((rowKey)=>{\n                    rowTotalCallbacks[(0,_utilities__WEBPACK_IMPORTED_MODULE_5__.flatKey)(rowKey)] = this.clickHandler(pivotData, rowKey, []);\n                });\n            }\n            if (colTotals) {\n                colKeys.forEach((colKey)=>{\n                    colTotalCallbacks[(0,_utilities__WEBPACK_IMPORTED_MODULE_5__.flatKey)(colKey)] = this.clickHandler(pivotData, [], colKey);\n                });\n            }\n            if (rowTotals && colTotals) {\n                grandTotalCallback = this.clickHandler(pivotData, [], []);\n            }\n        }\n        return {\n            pivotData,\n            colAttrs,\n            rowAttrs,\n            colKeys,\n            rowKeys,\n            rowTotals,\n            colTotals,\n            arrowCollapsed: subtotalOptions.arrowCollapsed,\n            arrowExpanded: subtotalOptions.arrowExpanded,\n            colSubtotalDisplay,\n            rowSubtotalDisplay,\n            cellCallbacks,\n            rowTotalCallbacks,\n            colTotalCallbacks,\n            grandTotalCallback,\n            namesMapping,\n            allowRenderHtml: props.allowRenderHtml\n        };\n    }\n    clickHandler(pivotData, rowValues, colValues) {\n        const colAttrs = this.props.cols;\n        const rowAttrs = this.props.rows;\n        const value = pivotData.getAggregator(rowValues, colValues).value();\n        const filters = {};\n        const colLimit = Math.min(colAttrs.length, colValues.length);\n        for(let i = 0; i < colLimit; i += 1){\n            const attr = colAttrs[i];\n            if (colValues[i] !== null) {\n                filters[attr] = colValues[i];\n            }\n        }\n        const rowLimit = Math.min(rowAttrs.length, rowValues.length);\n        for(let i = 0; i < rowLimit; i += 1){\n            const attr = rowAttrs[i];\n            if (rowValues[i] !== null) {\n                filters[attr] = rowValues[i];\n            }\n        }\n        return (e)=>this.props.tableOptions.clickCallback(e, value, filters, pivotData);\n    }\n    clickHeaderHandler(pivotData, values, attrs, attrIdx, callback, isSubtotal = false, isGrandTotal = false) {\n        const filters = {};\n        for(let i = 0; i <= attrIdx; i += 1){\n            const attr = attrs[i];\n            filters[attr] = values[i];\n        }\n        return (e)=>callback(e, values[attrIdx], filters, pivotData, isSubtotal, isGrandTotal);\n    }\n    collapseAttr(rowOrCol, attrIdx, allKeys) {\n        return (e)=>{\n            // Collapse an entire attribute.\n            e.stopPropagation();\n            const keyLen = attrIdx + 1;\n            const collapsed = allKeys.filter((k)=>k.length === keyLen).map(_utilities__WEBPACK_IMPORTED_MODULE_5__.flatKey);\n            const updates = {};\n            collapsed.forEach((k)=>{\n                updates[k] = true;\n            });\n            if (rowOrCol) {\n                this.setState((state)=>({\n                        collapsedRows: _extends({}, state.collapsedRows, updates)\n                    }));\n            } else {\n                this.setState((state)=>({\n                        collapsedCols: _extends({}, state.collapsedCols, updates)\n                    }));\n            }\n        };\n    }\n    expandAttr(rowOrCol, attrIdx, allKeys) {\n        return (e)=>{\n            // Expand an entire attribute. This implicitly implies expanding all of the\n            // parents as well. It's a bit inefficient but ah well...\n            e.stopPropagation();\n            const updates = {};\n            allKeys.forEach((k)=>{\n                for(let i = 0; i <= attrIdx; i += 1){\n                    updates[(0,_utilities__WEBPACK_IMPORTED_MODULE_5__.flatKey)(k.slice(0, i + 1))] = false;\n                }\n            });\n            if (rowOrCol) {\n                this.setState((state)=>({\n                        collapsedRows: _extends({}, state.collapsedRows, updates)\n                    }));\n            } else {\n                this.setState((state)=>({\n                        collapsedCols: _extends({}, state.collapsedCols, updates)\n                    }));\n            }\n        };\n    }\n    toggleRowKey(flatRowKey) {\n        return (e)=>{\n            e.stopPropagation();\n            this.setState((state)=>({\n                    collapsedRows: _extends({}, state.collapsedRows, {\n                        [flatRowKey]: !state.collapsedRows[flatRowKey]\n                    })\n                }));\n        };\n    }\n    toggleColKey(flatColKey) {\n        return (e)=>{\n            e.stopPropagation();\n            this.setState((state)=>({\n                    collapsedCols: _extends({}, state.collapsedCols, {\n                        [flatColKey]: !state.collapsedCols[flatColKey]\n                    })\n                }));\n        };\n    }\n    calcAttrSpans(attrArr, numAttrs) {\n        // Given an array of attribute values (i.e. each element is another array with\n        // the value at every level), compute the spans for every attribute value at\n        // every level. The return value is a nested array of the same shape. It has\n        // -1's for repeated values and the span number otherwise.\n        const spans = [];\n        // Index of the last new value\n        const li = Array(numAttrs).map(()=>0);\n        let lv = Array(numAttrs).map(()=>null);\n        for(let i = 0; i < attrArr.length; i += 1){\n            // Keep increasing span values as long as the last keys are the same. For\n            // the rest, record spans of 1. Update the indices too.\n            const cv = attrArr[i];\n            const ent = [];\n            let depth = 0;\n            const limit = Math.min(lv.length, cv.length);\n            while(depth < limit && lv[depth] === cv[depth]){\n                ent.push(-1);\n                spans[li[depth]][depth] += 1;\n                depth += 1;\n            }\n            while(depth < cv.length){\n                li[depth] = i;\n                ent.push(1);\n                depth += 1;\n            }\n            spans.push(ent);\n            lv = cv;\n        }\n        return spans;\n    }\n    renderColHeaderRow(attrName, attrIdx, pivotSettings) {\n        // Render a single row in the column header at the top of the pivot table.\n        const { rowAttrs, colAttrs, colKeys, visibleColKeys, colAttrSpans, rowTotals, arrowExpanded, arrowCollapsed, colSubtotalDisplay, maxColVisible, pivotData, namesMapping, allowRenderHtml } = pivotSettings;\n        const { highlightHeaderCellsOnHover, omittedHighlightHeaderGroups = [], highlightedHeaderCells, dateFormatters } = this.props.tableOptions;\n        const spaceCell = attrIdx === 0 && rowAttrs.length !== 0 ? /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"th\", {\n            colSpan: rowAttrs.length,\n            rowSpan: colAttrs.length,\n            \"aria-hidden\": \"true\"\n        }, \"padding\", false, {\n            fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n            lineNumber: 378,\n            columnNumber: 9\n        }, this) : null;\n        const needToggle = colSubtotalDisplay.enabled && attrIdx !== colAttrs.length - 1;\n        let arrowClickHandle = null;\n        let subArrow = null;\n        if (needToggle) {\n            arrowClickHandle = attrIdx + 1 < maxColVisible ? this.collapseAttr(false, attrIdx, colKeys) : this.expandAttr(false, attrIdx, colKeys);\n            subArrow = attrIdx + 1 < maxColVisible ? arrowExpanded : arrowCollapsed;\n        }\n        const attrNameCell = /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"th\", {\n            className: \"pvtAxisLabel\",\n            children: displayHeaderCell(needToggle, subArrow, arrowClickHandle, attrName, namesMapping, allowRenderHtml)\n        }, \"label\", false, {\n            fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n            lineNumber: 398,\n            columnNumber: 7\n        }, this);\n        const attrValueCells = [];\n        const rowIncrSpan = rowAttrs.length !== 0 ? 1 : 0;\n        // Iterate through columns. Jump over duplicate values.\n        let i = 0;\n        while(i < visibleColKeys.length){\n            let handleContextMenu;\n            const colKey = visibleColKeys[i];\n            const colSpan = attrIdx < colKey.length ? colAttrSpans[i][attrIdx] : 1;\n            let colLabelClass = 'pvtColLabel';\n            if (attrIdx < colKey.length) {\n                if (!omittedHighlightHeaderGroups.includes(colAttrs[attrIdx])) {\n                    if (highlightHeaderCellsOnHover) {\n                        colLabelClass += ' hoverable';\n                    }\n                    handleContextMenu = (e)=>this.props.onContextMenu(e, colKey, undefined, {\n                            [attrName]: colKey[attrIdx]\n                        });\n                }\n                if (highlightedHeaderCells && Array.isArray(highlightedHeaderCells[colAttrs[attrIdx]]) && highlightedHeaderCells[colAttrs[attrIdx]].includes(colKey[attrIdx])) {\n                    colLabelClass += ' active';\n                }\n                const rowSpan = 1 + (attrIdx === colAttrs.length - 1 ? rowIncrSpan : 0);\n                const flatColKey = (0,_utilities__WEBPACK_IMPORTED_MODULE_5__.flatKey)(colKey.slice(0, attrIdx + 1));\n                const onArrowClick = needToggle ? this.toggleColKey(flatColKey) : null;\n                const headerCellFormattedValue = dateFormatters && dateFormatters[attrName] && typeof dateFormatters[attrName] === 'function' ? dateFormatters[attrName](colKey[attrIdx]) : colKey[attrIdx];\n                attrValueCells.push(/*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"th\", {\n                    className: colLabelClass,\n                    colSpan: colSpan,\n                    rowSpan: rowSpan,\n                    role: \"columnheader button\",\n                    onClick: this.clickHeaderHandler(pivotData, colKey, this.props.cols, attrIdx, this.props.tableOptions.clickColumnHeaderCallback),\n                    onContextMenu: handleContextMenu,\n                    children: displayHeaderCell(needToggle, this.state.collapsedCols[flatColKey] ? arrowCollapsed : arrowExpanded, onArrowClick, headerCellFormattedValue, namesMapping, allowRenderHtml)\n                }, `colKey-${flatColKey}`, false, {\n                    fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n                    lineNumber: 448,\n                    columnNumber: 11\n                }, this));\n            } else if (attrIdx === colKey.length) {\n                const rowSpan = colAttrs.length - colKey.length + rowIncrSpan;\n                attrValueCells.push(/*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"th\", {\n                    className: `${colLabelClass} pvtSubtotalLabel`,\n                    colSpan: colSpan,\n                    rowSpan: rowSpan,\n                    role: \"columnheader button\",\n                    onClick: this.clickHeaderHandler(pivotData, colKey, this.props.cols, attrIdx, this.props.tableOptions.clickColumnHeaderCallback, true),\n                    children: (0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_2__.t)('Subtotal')\n                }, `colKeyBuffer-${(0,_utilities__WEBPACK_IMPORTED_MODULE_5__.flatKey)(colKey)}`, false, {\n                    fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n                    lineNumber: 478,\n                    columnNumber: 11\n                }, this));\n            }\n            // The next colSpan columns will have the same value anyway...\n            i += colSpan;\n        }\n        const totalCell = attrIdx === 0 && rowTotals ? /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"th\", {\n            className: \"pvtTotalLabel\",\n            rowSpan: colAttrs.length + Math.min(rowAttrs.length, 1),\n            role: \"columnheader button\",\n            onClick: this.clickHeaderHandler(pivotData, [], this.props.cols, attrIdx, this.props.tableOptions.clickColumnHeaderCallback, false, true),\n            children: (0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_2__.t)('Total (%(aggregatorName)s)', {\n                aggregatorName: (0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_2__.t)(this.props.aggregatorName)\n            })\n        }, \"total\", false, {\n            fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n            lineNumber: 503,\n            columnNumber: 9\n        }, this) : null;\n        const cells = [\n            spaceCell,\n            attrNameCell,\n            ...attrValueCells,\n            totalCell\n        ];\n        return /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"tr\", {\n            children: cells\n        }, `colAttr-${attrIdx}`, false, {\n            fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n            lineNumber: 525,\n            columnNumber: 12\n        }, this);\n    }\n    renderRowHeaderRow(pivotSettings) {\n        // Render just the attribute names of the rows (the actual attribute values\n        // will show up in the individual rows).\n        const { rowAttrs, colAttrs, rowKeys, arrowCollapsed, arrowExpanded, rowSubtotalDisplay, maxRowVisible, pivotData, namesMapping, allowRenderHtml } = pivotSettings;\n        return /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"tr\", {\n            children: [\n                rowAttrs.map((r, i)=>{\n                    const needLabelToggle = rowSubtotalDisplay.enabled && i !== rowAttrs.length - 1;\n                    let arrowClickHandle = null;\n                    let subArrow = null;\n                    if (needLabelToggle) {\n                        arrowClickHandle = i + 1 < maxRowVisible ? this.collapseAttr(true, i, rowKeys) : this.expandAttr(true, i, rowKeys);\n                        subArrow = i + 1 < maxRowVisible ? arrowExpanded : arrowCollapsed;\n                    }\n                    return /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"th\", {\n                        className: \"pvtAxisLabel\",\n                        children: displayHeaderCell(needLabelToggle, subArrow, arrowClickHandle, r, namesMapping, allowRenderHtml)\n                    }, `rowAttr-${i}`, false, {\n                        fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n                        lineNumber: 559,\n                        columnNumber: 13\n                    }, this);\n                }),\n                /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"th\", {\n                    className: \"pvtTotalLabel\",\n                    role: \"columnheader button\",\n                    onClick: this.clickHeaderHandler(pivotData, [], this.props.rows, 0, this.props.tableOptions.clickRowHeaderCallback, false, true),\n                    children: colAttrs.length === 0 ? (0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_2__.t)('Total (%(aggregatorName)s)', {\n                        aggregatorName: (0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_2__.t)(this.props.aggregatorName)\n                    }) : null\n                }, \"padding\", false, {\n                    fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n                    lineNumber: 571,\n                    columnNumber: 9\n                }, this)\n            ]\n        }, \"rowHdr\", true, {\n            fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n            lineNumber: 545,\n            columnNumber: 7\n        }, this);\n    }\n    renderTableRow(rowKey, rowIdx, pivotSettings) {\n        // Render a single row in the pivot table.\n        const { rowAttrs, colAttrs, rowAttrSpans, visibleColKeys, pivotData, rowTotals, rowSubtotalDisplay, arrowExpanded, arrowCollapsed, cellCallbacks, rowTotalCallbacks, namesMapping, allowRenderHtml } = pivotSettings;\n        const { highlightHeaderCellsOnHover, omittedHighlightHeaderGroups = [], highlightedHeaderCells, cellColorFormatters, dateFormatters } = this.props.tableOptions;\n        const flatRowKey = (0,_utilities__WEBPACK_IMPORTED_MODULE_5__.flatKey)(rowKey);\n        const colIncrSpan = colAttrs.length !== 0 ? 1 : 0;\n        const attrValueCells = rowKey.map((r, i)=>{\n            let handleContextMenu;\n            let valueCellClassName = 'pvtRowLabel';\n            if (!omittedHighlightHeaderGroups.includes(rowAttrs[i])) {\n                if (highlightHeaderCellsOnHover) {\n                    valueCellClassName += ' hoverable';\n                }\n                handleContextMenu = (e)=>this.props.onContextMenu(e, undefined, rowKey, {\n                        [rowAttrs[i]]: r\n                    });\n            }\n            if (highlightedHeaderCells && Array.isArray(highlightedHeaderCells[rowAttrs[i]]) && highlightedHeaderCells[rowAttrs[i]].includes(r)) {\n                valueCellClassName += ' active';\n            }\n            const rowSpan = rowAttrSpans[rowIdx][i];\n            if (rowSpan > 0) {\n                const flatRowKey = (0,_utilities__WEBPACK_IMPORTED_MODULE_5__.flatKey)(rowKey.slice(0, i + 1));\n                const colSpan = 1 + (i === rowAttrs.length - 1 ? colIncrSpan : 0);\n                const needRowToggle = rowSubtotalDisplay.enabled && i !== rowAttrs.length - 1;\n                const onArrowClick = needRowToggle ? this.toggleRowKey(flatRowKey) : null;\n                const headerCellFormattedValue = dateFormatters && dateFormatters[rowAttrs[i]] ? dateFormatters[rowAttrs[i]](r) : r;\n                return /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"th\", {\n                    className: valueCellClassName,\n                    rowSpan: rowSpan,\n                    colSpan: colSpan,\n                    role: \"columnheader button\",\n                    onClick: this.clickHeaderHandler(pivotData, rowKey, this.props.rows, i, this.props.tableOptions.clickRowHeaderCallback),\n                    onContextMenu: handleContextMenu,\n                    children: displayHeaderCell(needRowToggle, this.state.collapsedRows[flatRowKey] ? arrowCollapsed : arrowExpanded, onArrowClick, headerCellFormattedValue, namesMapping, allowRenderHtml)\n                }, `rowKeyLabel-${i}`, false, {\n                    fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n                    lineNumber: 658,\n                    columnNumber: 11\n                }, this);\n            }\n            return null;\n        });\n        const attrValuePaddingCell = rowKey.length < rowAttrs.length ? /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"th\", {\n            className: \"pvtRowLabel pvtSubtotalLabel\",\n            colSpan: rowAttrs.length - rowKey.length + colIncrSpan,\n            rowSpan: 1,\n            role: \"columnheader button\",\n            onClick: this.clickHeaderHandler(pivotData, rowKey, this.props.rows, rowKey.length, this.props.tableOptions.clickRowHeaderCallback, true),\n            children: (0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_2__.t)('Subtotal')\n        }, \"rowKeyBuffer\", false, {\n            fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n            lineNumber: 691,\n            columnNumber: 9\n        }, this) : null;\n        const rowClickHandlers = cellCallbacks[flatRowKey] || {};\n        const valueCells = visibleColKeys.map((colKey)=>{\n            const flatColKey = (0,_utilities__WEBPACK_IMPORTED_MODULE_5__.flatKey)(colKey);\n            const agg = pivotData.getAggregator(rowKey, colKey);\n            const aggValue = agg.value();\n            const keys = [\n                ...rowKey,\n                ...colKey\n            ];\n            let backgroundColor;\n            if (cellColorFormatters) {\n                Object.values(cellColorFormatters).forEach((cellColorFormatter)=>{\n                    if (Array.isArray(cellColorFormatter)) {\n                        keys.forEach((key)=>{\n                            if (backgroundColor) {\n                                return;\n                            }\n                            cellColorFormatter.filter((formatter)=>formatter.column === key).forEach((formatter)=>{\n                                const formatterResult = formatter.getColorFromValue(aggValue);\n                                if (formatterResult) {\n                                    backgroundColor = formatterResult;\n                                }\n                            });\n                        });\n                    }\n                });\n            }\n            const style = agg.isSubtotal ? {\n                fontWeight: 'bold'\n            } : {\n                backgroundColor\n            };\n            return /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"td\", {\n                role: \"gridcell\",\n                className: \"pvtVal\",\n                onClick: rowClickHandlers[flatColKey],\n                onContextMenu: (e)=>this.props.onContextMenu(e, colKey, rowKey),\n                style: style,\n                children: displayCell(agg.format(aggValue), allowRenderHtml)\n            }, `pvtVal-${flatColKey}`, false, {\n                fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n                lineNumber: 743,\n                columnNumber: 9\n            }, this);\n        });\n        let totalCell = null;\n        if (rowTotals) {\n            const agg = pivotData.getAggregator(rowKey, []);\n            const aggValue = agg.value();\n            totalCell = /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"td\", {\n                role: \"gridcell\",\n                className: \"pvtTotal\",\n                onClick: rowTotalCallbacks[flatRowKey],\n                onContextMenu: (e)=>this.props.onContextMenu(e, undefined, rowKey),\n                children: displayCell(agg.format(aggValue), allowRenderHtml)\n            }, \"total\", false, {\n                fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n                lineNumber: 761,\n                columnNumber: 9\n            }, this);\n        }\n        const rowCells = [\n            ...attrValueCells,\n            attrValuePaddingCell,\n            ...valueCells,\n            totalCell\n        ];\n        return /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"tr\", {\n            children: rowCells\n        }, `keyRow-${flatRowKey}`, false, {\n            fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n            lineNumber: 780,\n            columnNumber: 12\n        }, this);\n    }\n    renderTotalsRow(pivotSettings) {\n        // Render the final totals rows that has the totals for all the columns.\n        const { rowAttrs, colAttrs, visibleColKeys, rowTotals, pivotData, colTotalCallbacks, grandTotalCallback } = pivotSettings;\n        const totalLabelCell = /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"th\", {\n            className: \"pvtTotalLabel pvtRowTotalLabel\",\n            colSpan: rowAttrs.length + Math.min(colAttrs.length, 1),\n            role: \"columnheader button\",\n            onClick: this.clickHeaderHandler(pivotData, [], this.props.rows, 0, this.props.tableOptions.clickRowHeaderCallback, false, true),\n            children: (0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_2__.t)('Total (%(aggregatorName)s)', {\n                aggregatorName: (0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_2__.t)(this.props.aggregatorName)\n            })\n        }, \"label\", false, {\n            fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n            lineNumber: 797,\n            columnNumber: 7\n        }, this);\n        const totalValueCells = visibleColKeys.map((colKey)=>{\n            const flatColKey = (0,_utilities__WEBPACK_IMPORTED_MODULE_5__.flatKey)(colKey);\n            const agg = pivotData.getAggregator([], colKey);\n            const aggValue = agg.value();\n            return /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"td\", {\n                role: \"gridcell\",\n                className: \"pvtTotal pvtRowTotal\",\n                onClick: colTotalCallbacks[flatColKey],\n                onContextMenu: (e)=>this.props.onContextMenu(e, colKey, undefined),\n                style: {\n                    padding: '5px'\n                },\n                children: displayCell(agg.format(aggValue), this.props.allowRenderHtml)\n            }, `total-${flatColKey}`, false, {\n                fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n                lineNumber: 824,\n                columnNumber: 9\n            }, this);\n        });\n        let grandTotalCell = null;\n        if (rowTotals) {\n            const agg = pivotData.getAggregator([], []);\n            const aggValue = agg.value();\n            grandTotalCell = /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"td\", {\n                role: \"gridcell\",\n                className: \"pvtGrandTotal pvtRowTotal\",\n                onClick: grandTotalCallback,\n                onContextMenu: (e)=>this.props.onContextMenu(e, undefined, undefined),\n                children: displayCell(agg.format(aggValue), this.props.allowRenderHtml)\n            }, \"total\", false, {\n                fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n                lineNumber: 842,\n                columnNumber: 9\n            }, this);\n        }\n        const totalCells = [\n            totalLabelCell,\n            ...totalValueCells,\n            grandTotalCell\n        ];\n        return /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"tr\", {\n            className: \"pvtRowTotals\",\n            children: totalCells\n        }, \"total\", false, {\n            fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n            lineNumber: 857,\n            columnNumber: 7\n        }, this);\n    }\n    visibleKeys(keys, collapsed, numAttrs, subtotalDisplay) {\n        return keys.filter((key)=>// Is the key hidden by one of its parents?\n            !key.some((k, j)=>collapsed[(0,_utilities__WEBPACK_IMPORTED_MODULE_5__.flatKey)(key.slice(0, j))]) && // Leaf key.\n            (key.length === numAttrs || // Children hidden. Must show total.\n            (0,_utilities__WEBPACK_IMPORTED_MODULE_5__.flatKey)(key) in collapsed || // Don't hide totals.\n            !subtotalDisplay.hideOnExpand));\n    }\n    isDashboardEditMode() {\n        return document.contains(document.querySelector('.dashboard--editing'));\n    }\n    render() {\n        if (this.cachedProps !== this.props) {\n            this.cachedProps = this.props;\n            this.cachedBasePivotSettings = this.getBasePivotSettings();\n        }\n        const { colAttrs, rowAttrs, rowKeys, colKeys, colTotals, rowSubtotalDisplay, colSubtotalDisplay, allowRenderHtml } = this.cachedBasePivotSettings;\n        // Need to account for exclusions to compute the effective row\n        // and column keys.\n        const visibleRowKeys = this.visibleKeys(rowKeys, this.state.collapsedRows, rowAttrs.length, rowSubtotalDisplay);\n        const visibleColKeys = this.visibleKeys(colKeys, this.state.collapsedCols, colAttrs.length, colSubtotalDisplay);\n        const pivotSettings = _extends({\n            visibleRowKeys,\n            maxRowVisible: Math.max(...visibleRowKeys.map((k)=>k.length)),\n            visibleColKeys,\n            maxColVisible: Math.max(...visibleColKeys.map((k)=>k.length)),\n            rowAttrSpans: this.calcAttrSpans(visibleRowKeys, rowAttrs.length),\n            colAttrSpans: this.calcAttrSpans(visibleColKeys, colAttrs.length),\n            allowRenderHtml\n        }, this.cachedBasePivotSettings);\n        return /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(_Styles__WEBPACK_IMPORTED_MODULE_6__.Styles, {\n            isDashboardEditMode: this.isDashboardEditMode(),\n            children: /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"table\", {\n                className: \"pvtTable\",\n                role: \"grid\",\n                children: [\n                    /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"thead\", {\n                        children: [\n                            colAttrs.map((c, j)=>this.renderColHeaderRow(c, j, pivotSettings)),\n                            rowAttrs.length !== 0 && this.renderRowHeaderRow(pivotSettings)\n                        ]\n                    }, void 0, true, {\n                        fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n                        lineNumber: 926,\n                        columnNumber: 11\n                    }, this),\n                    /*#__PURE__*/ (0,_emotion_react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(\"tbody\", {\n                        children: [\n                            visibleRowKeys.map((r, i)=>this.renderTableRow(r, i, pivotSettings)),\n                            colTotals && this.renderTotalsRow(pivotSettings)\n                        ]\n                    }, void 0, true, {\n                        fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n                        lineNumber: 932,\n                        columnNumber: 11\n                    }, this)\n                ]\n            }, void 0, true, {\n                fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n                lineNumber: 925,\n                columnNumber: 9\n            }, this)\n        }, void 0, false, {\n            fileName: \"/app/superset-frontend/plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\",\n            lineNumber: 924,\n            columnNumber: 7\n        }, this);\n    }\n    constructor(props){\n        super(props);\n        // We need state to record which entries are collapsed and which aren't.\n        // This is an object with flat-keys indicating if the corresponding rows\n        // should be collapsed.\n        this.state = {\n            collapsedRows: {},\n            collapsedCols: {}\n        };\n        this.clickHeaderHandler = this.clickHeaderHandler.bind(this);\n        this.clickHandler = this.clickHandler.bind(this);\n    }\n}\nTableRenderer.propTypes = _extends({}, _utilities__WEBPACK_IMPORTED_MODULE_5__.PivotData.propTypes, {\n    tableOptions: (prop_types__WEBPACK_IMPORTED_MODULE_4___default().object),\n    onContextMenu: (prop_types__WEBPACK_IMPORTED_MODULE_4___default().func)\n});\nTableRenderer.defaultProps = _extends({}, _utilities__WEBPACK_IMPORTED_MODULE_5__.PivotData.defaultProps, {\n    tableOptions: {}\n});\n\n\nconst $ReactRefreshModuleId$ = __webpack_require__.$Refresh$.moduleId;\nconst $ReactRefreshCurrentExports$ = __react_refresh_utils__.getModuleExports(\n\t$ReactRefreshModuleId$\n);\n\nfunction $ReactRefreshModuleRuntime$(exports) {\n\tif (true) {\n\t\tlet errorOverlay;\n\t\tif (typeof __react_refresh_error_overlay__ !== 'undefined') {\n\t\t\terrorOverlay = __react_refresh_error_overlay__;\n\t\t}\n\t\tlet testMode;\n\t\tif (typeof __react_refresh_test__ !== 'undefined') {\n\t\t\ttestMode = __react_refresh_test__;\n\t\t}\n\t\treturn __react_refresh_utils__.executeRuntime(\n\t\t\texports,\n\t\t\t$ReactRefreshModuleId$,\n\t\t\tmodule.hot,\n\t\t\terrorOverlay,\n\t\t\ttestMode\n\t\t);\n\t}\n}\n\nif (typeof Promise !== 'undefined' && $ReactRefreshCurrentExports$ instanceof Promise) {\n\t$ReactRefreshCurrentExports$.then($ReactRefreshModuleRuntime$);\n} else {\n\t$ReactRefreshModuleRuntime$($ReactRefreshCurrentExports$);\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wbHVnaW5zL3BsdWdpbi1jaGFydC1waXZvdC10YWJsZS9zcmMvcmVhY3QtcGl2b3R0YWJsZS9UYWJsZVJlbmRlcmVycy5qc3giLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOzs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQTs7Ozs7Ozs7Ozs7Ozs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFRQTtBQUNBO0FBQ0E7QUFJQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7Ozs7O0FBRUE7QUFBQTtBQUFBOzs7Ozs7Ozs7OztBQUdBO0FBRUE7QUFFQTtBQWFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFTQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQWVBO0FBT0E7QUFJQTtBQUNBO0FBQ0E7QUFIQTs7OztBQUtBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTs7Ozs7QUFZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQU1BO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQU9BO0FBRUE7QUFiQTs7Ozs7QUF5QkE7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQVNBO0FBYkE7Ozs7O0FBZ0JBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQVVBO0FBQ0E7QUFDQTtBQWhCQTs7OztBQWtCQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTs7Ozs7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBWUE7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBOzs7OztBQVdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFVQTtBQUVBO0FBQ0E7QUFmQTs7Ozs7O0FBNUJBOzs7OztBQWdEQTtBQUVBO0FBQ0E7QUFFQTtBQWdCQTtBQU9BO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBSUE7QUFJQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFPQTtBQUVBO0FBZEE7Ozs7O0FBMEJBO0FBQ0E7QUFDQTtBQUVBO0FBR0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQVNBO0FBYkE7Ozs7QUFlQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFFQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUxBOzs7OztBQVFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFMQTs7Ozs7QUFRQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFBQTs7Ozs7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQVVBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFVQTtBQUNBO0FBQ0E7QUFoQkE7Ozs7O0FBb0JBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBTEE7Ozs7O0FBUUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUxBOzs7OztBQVFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQURBOzs7OztBQUlBO0FBRUE7QUFDQTtBQUdBO0FBRUE7QUFFQTtBQUVBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFXQTtBQUNBO0FBQ0E7QUFNQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7O0FBQ0E7O0FBQ0E7QUFHQTs7Ozs7OztBQUVBOztBQUNBO0FBR0E7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUtBO0FBbDJCQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUF5MUJBO0FBRUE7QUFFQTtBQUNBOztBQUVBO0FBQUEiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zdXBlcnNldC8uL3BsdWdpbnMvcGx1Z2luLWNoYXJ0LXBpdm90LXRhYmxlL3NyYy9yZWFjdC1waXZvdHRhYmxlL1RhYmxlUmVuZGVyZXJzLmpzeD80NzZjIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgdCwgc2FmZUh0bWxTcGFuIH0gZnJvbSAnQHN1cGVyc2V0LXVpL2NvcmUnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7IFBpdm90RGF0YSwgZmxhdEtleSB9IGZyb20gJy4vdXRpbGl0aWVzJztcbmltcG9ydCB7IFN0eWxlcyB9IGZyb20gJy4vU3R5bGVzJztcblxuY29uc3QgcGFyc2VMYWJlbCA9IHZhbHVlID0+IHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICBpZiAodmFsdWUgPT09ICdtZXRyaWMnKSByZXR1cm4gdCgnbWV0cmljJyk7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG4gIGlmICh0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInKSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG4gIHJldHVybiBTdHJpbmcodmFsdWUpO1xufTtcblxuZnVuY3Rpb24gZGlzcGxheUNlbGwodmFsdWUsIGFsbG93UmVuZGVySHRtbCkge1xuICBpZiAoYWxsb3dSZW5kZXJIdG1sICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gc2FmZUh0bWxTcGFuKHZhbHVlKTtcbiAgfVxuICByZXR1cm4gcGFyc2VMYWJlbCh2YWx1ZSk7XG59XG5mdW5jdGlvbiBkaXNwbGF5SGVhZGVyQ2VsbChcbiAgbmVlZFRvZ2dsZSxcbiAgQXJyb3dJY29uLFxuICBvbkFycm93Q2xpY2ssXG4gIHZhbHVlLFxuICBuYW1lc01hcHBpbmcsXG4gIGFsbG93UmVuZGVySHRtbCxcbikge1xuICBjb25zdCBuYW1lID0gbmFtZXNNYXBwaW5nW3ZhbHVlXSB8fCB2YWx1ZTtcbiAgY29uc3QgcGFyc2VkTGFiZWwgPSBwYXJzZUxhYmVsKG5hbWUpO1xuICBjb25zdCBsYWJlbENvbnRlbnQgPVxuICAgIGFsbG93UmVuZGVySHRtbCAmJiB0eXBlb2YgcGFyc2VkTGFiZWwgPT09ICdzdHJpbmcnXG4gICAgICA/IHNhZmVIdG1sU3BhbihwYXJzZWRMYWJlbClcbiAgICAgIDogcGFyc2VkTGFiZWw7XG4gIHJldHVybiBuZWVkVG9nZ2xlID8gKFxuICAgIDxzcGFuIGNsYXNzTmFtZT1cInRvZ2dsZS13cmFwcGVyXCI+XG4gICAgICA8c3BhblxuICAgICAgICByb2xlPVwiYnV0dG9uXCJcbiAgICAgICAgdGFiSW5kZXg9XCIwXCJcbiAgICAgICAgY2xhc3NOYW1lPVwidG9nZ2xlXCJcbiAgICAgICAgb25DbGljaz17b25BcnJvd0NsaWNrfVxuICAgICAgPlxuICAgICAgICB7QXJyb3dJY29ufVxuICAgICAgPC9zcGFuPlxuICAgICAgPHNwYW4gY2xhc3NOYW1lPVwidG9nZ2xlLXZhbFwiPntsYWJlbENvbnRlbnR9PC9zcGFuPlxuICAgIDwvc3Bhbj5cbiAgKSA6IChcbiAgICBsYWJlbENvbnRlbnRcbiAgKTtcbn1cblxuZXhwb3J0IGNsYXNzIFRhYmxlUmVuZGVyZXIgZXh0ZW5kcyBDb21wb25lbnQge1xuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcblxuICAgIC8vIFdlIG5lZWQgc3RhdGUgdG8gcmVjb3JkIHdoaWNoIGVudHJpZXMgYXJlIGNvbGxhcHNlZCBhbmQgd2hpY2ggYXJlbid0LlxuICAgIC8vIFRoaXMgaXMgYW4gb2JqZWN0IHdpdGggZmxhdC1rZXlzIGluZGljYXRpbmcgaWYgdGhlIGNvcnJlc3BvbmRpbmcgcm93c1xuICAgIC8vIHNob3VsZCBiZSBjb2xsYXBzZWQuXG4gICAgdGhpcy5zdGF0ZSA9IHsgY29sbGFwc2VkUm93czoge30sIGNvbGxhcHNlZENvbHM6IHt9IH07XG5cbiAgICB0aGlzLmNsaWNrSGVhZGVySGFuZGxlciA9IHRoaXMuY2xpY2tIZWFkZXJIYW5kbGVyLmJpbmQodGhpcyk7XG4gICAgdGhpcy5jbGlja0hhbmRsZXIgPSB0aGlzLmNsaWNrSGFuZGxlci5iaW5kKHRoaXMpO1xuICB9XG5cbiAgZ2V0QmFzZVBpdm90U2V0dGluZ3MoKSB7XG4gICAgLy8gT25lLXRpbWUgZXh0cmFjdGlvbiBvZiBwaXZvdCBzZXR0aW5ncyB0aGF0IHdlJ2xsIHVzZSB0aHJvdWdob3V0IHRoZSByZW5kZXIuXG5cbiAgICBjb25zdCB7IHByb3BzIH0gPSB0aGlzO1xuICAgIGNvbnN0IGNvbEF0dHJzID0gcHJvcHMuY29scztcbiAgICBjb25zdCByb3dBdHRycyA9IHByb3BzLnJvd3M7XG5cbiAgICBjb25zdCB0YWJsZU9wdGlvbnMgPSB7XG4gICAgICByb3dUb3RhbHM6IHRydWUsXG4gICAgICBjb2xUb3RhbHM6IHRydWUsXG4gICAgICAuLi5wcm9wcy50YWJsZU9wdGlvbnMsXG4gICAgfTtcbiAgICBjb25zdCByb3dUb3RhbHMgPSB0YWJsZU9wdGlvbnMucm93VG90YWxzIHx8IGNvbEF0dHJzLmxlbmd0aCA9PT0gMDtcbiAgICBjb25zdCBjb2xUb3RhbHMgPSB0YWJsZU9wdGlvbnMuY29sVG90YWxzIHx8IHJvd0F0dHJzLmxlbmd0aCA9PT0gMDtcblxuICAgIGNvbnN0IG5hbWVzTWFwcGluZyA9IHByb3BzLm5hbWVzTWFwcGluZyB8fCB7fTtcbiAgICBjb25zdCBzdWJ0b3RhbE9wdGlvbnMgPSB7XG4gICAgICBhcnJvd0NvbGxhcHNlZDogJ1xcdTI1QjInLFxuICAgICAgYXJyb3dFeHBhbmRlZDogJ1xcdTI1QkMnLFxuICAgICAgLi4ucHJvcHMuc3VidG90YWxPcHRpb25zLFxuICAgIH07XG5cbiAgICBjb25zdCBjb2xTdWJ0b3RhbERpc3BsYXkgPSB7XG4gICAgICBkaXNwbGF5T25Ub3A6IGZhbHNlLFxuICAgICAgZW5hYmxlZDogdGFibGVPcHRpb25zLmNvbFN1YlRvdGFscyxcbiAgICAgIGhpZGVPbkV4cGFuZDogZmFsc2UsXG4gICAgICAuLi5zdWJ0b3RhbE9wdGlvbnMuY29sU3VidG90YWxEaXNwbGF5LFxuICAgIH07XG5cbiAgICBjb25zdCByb3dTdWJ0b3RhbERpc3BsYXkgPSB7XG4gICAgICBkaXNwbGF5T25Ub3A6IGZhbHNlLFxuICAgICAgZW5hYmxlZDogdGFibGVPcHRpb25zLnJvd1N1YlRvdGFscyxcbiAgICAgIGhpZGVPbkV4cGFuZDogZmFsc2UsXG4gICAgICAuLi5zdWJ0b3RhbE9wdGlvbnMucm93U3VidG90YWxEaXNwbGF5LFxuICAgIH07XG5cbiAgICBjb25zdCBwaXZvdERhdGEgPSBuZXcgUGl2b3REYXRhKHByb3BzLCB7XG4gICAgICByb3dFbmFibGVkOiByb3dTdWJ0b3RhbERpc3BsYXkuZW5hYmxlZCxcbiAgICAgIGNvbEVuYWJsZWQ6IGNvbFN1YnRvdGFsRGlzcGxheS5lbmFibGVkLFxuICAgICAgcm93UGFydGlhbE9uVG9wOiByb3dTdWJ0b3RhbERpc3BsYXkuZGlzcGxheU9uVG9wLFxuICAgICAgY29sUGFydGlhbE9uVG9wOiBjb2xTdWJ0b3RhbERpc3BsYXkuZGlzcGxheU9uVG9wLFxuICAgIH0pO1xuICAgIGNvbnN0IHJvd0tleXMgPSBwaXZvdERhdGEuZ2V0Um93S2V5cygpO1xuICAgIGNvbnN0IGNvbEtleXMgPSBwaXZvdERhdGEuZ2V0Q29sS2V5cygpO1xuXG4gICAgLy8gQWxzbyBwcmUtY2FsY3VsYXRlIGFsbCB0aGUgY2FsbGJhY2tzIGZvciBjZWxscywgZXRjLi4uIFRoaXMgaXMgbmljZSB0byBoYXZlIHRvXG4gICAgLy8gYXZvaWQgcmUtY2FsY3VsYXRpb25zIG9mIHRoZSBjYWxsLWJhY2tzIG9uIGNlbGwgZXhwYW5zaW9ucywgZXRjLi4uXG4gICAgY29uc3QgY2VsbENhbGxiYWNrcyA9IHt9O1xuICAgIGNvbnN0IHJvd1RvdGFsQ2FsbGJhY2tzID0ge307XG4gICAgY29uc3QgY29sVG90YWxDYWxsYmFja3MgPSB7fTtcbiAgICBsZXQgZ3JhbmRUb3RhbENhbGxiYWNrID0gbnVsbDtcbiAgICBpZiAodGFibGVPcHRpb25zLmNsaWNrQ2FsbGJhY2spIHtcbiAgICAgIHJvd0tleXMuZm9yRWFjaChyb3dLZXkgPT4ge1xuICAgICAgICBjb25zdCBmbGF0Um93S2V5ID0gZmxhdEtleShyb3dLZXkpO1xuICAgICAgICBpZiAoIShmbGF0Um93S2V5IGluIGNlbGxDYWxsYmFja3MpKSB7XG4gICAgICAgICAgY2VsbENhbGxiYWNrc1tmbGF0Um93S2V5XSA9IHt9O1xuICAgICAgICB9XG4gICAgICAgIGNvbEtleXMuZm9yRWFjaChjb2xLZXkgPT4ge1xuICAgICAgICAgIGNlbGxDYWxsYmFja3NbZmxhdFJvd0tleV1bZmxhdEtleShjb2xLZXkpXSA9IHRoaXMuY2xpY2tIYW5kbGVyKFxuICAgICAgICAgICAgcGl2b3REYXRhLFxuICAgICAgICAgICAgcm93S2V5LFxuICAgICAgICAgICAgY29sS2V5LFxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIEFkZCBpbiB0b3RhbHMgYXMgd2VsbC5cbiAgICAgIGlmIChyb3dUb3RhbHMpIHtcbiAgICAgICAgcm93S2V5cy5mb3JFYWNoKHJvd0tleSA9PiB7XG4gICAgICAgICAgcm93VG90YWxDYWxsYmFja3NbZmxhdEtleShyb3dLZXkpXSA9IHRoaXMuY2xpY2tIYW5kbGVyKFxuICAgICAgICAgICAgcGl2b3REYXRhLFxuICAgICAgICAgICAgcm93S2V5LFxuICAgICAgICAgICAgW10sXG4gICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAoY29sVG90YWxzKSB7XG4gICAgICAgIGNvbEtleXMuZm9yRWFjaChjb2xLZXkgPT4ge1xuICAgICAgICAgIGNvbFRvdGFsQ2FsbGJhY2tzW2ZsYXRLZXkoY29sS2V5KV0gPSB0aGlzLmNsaWNrSGFuZGxlcihcbiAgICAgICAgICAgIHBpdm90RGF0YSxcbiAgICAgICAgICAgIFtdLFxuICAgICAgICAgICAgY29sS2V5LFxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKHJvd1RvdGFscyAmJiBjb2xUb3RhbHMpIHtcbiAgICAgICAgZ3JhbmRUb3RhbENhbGxiYWNrID0gdGhpcy5jbGlja0hhbmRsZXIocGl2b3REYXRhLCBbXSwgW10pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBwaXZvdERhdGEsXG4gICAgICBjb2xBdHRycyxcbiAgICAgIHJvd0F0dHJzLFxuICAgICAgY29sS2V5cyxcbiAgICAgIHJvd0tleXMsXG4gICAgICByb3dUb3RhbHMsXG4gICAgICBjb2xUb3RhbHMsXG4gICAgICBhcnJvd0NvbGxhcHNlZDogc3VidG90YWxPcHRpb25zLmFycm93Q29sbGFwc2VkLFxuICAgICAgYXJyb3dFeHBhbmRlZDogc3VidG90YWxPcHRpb25zLmFycm93RXhwYW5kZWQsXG4gICAgICBjb2xTdWJ0b3RhbERpc3BsYXksXG4gICAgICByb3dTdWJ0b3RhbERpc3BsYXksXG4gICAgICBjZWxsQ2FsbGJhY2tzLFxuICAgICAgcm93VG90YWxDYWxsYmFja3MsXG4gICAgICBjb2xUb3RhbENhbGxiYWNrcyxcbiAgICAgIGdyYW5kVG90YWxDYWxsYmFjayxcbiAgICAgIG5hbWVzTWFwcGluZyxcbiAgICAgIGFsbG93UmVuZGVySHRtbDogcHJvcHMuYWxsb3dSZW5kZXJIdG1sLFxuICAgIH07XG4gIH1cblxuICBjbGlja0hhbmRsZXIocGl2b3REYXRhLCByb3dWYWx1ZXMsIGNvbFZhbHVlcykge1xuICAgIGNvbnN0IGNvbEF0dHJzID0gdGhpcy5wcm9wcy5jb2xzO1xuICAgIGNvbnN0IHJvd0F0dHJzID0gdGhpcy5wcm9wcy5yb3dzO1xuICAgIGNvbnN0IHZhbHVlID0gcGl2b3REYXRhLmdldEFnZ3JlZ2F0b3Iocm93VmFsdWVzLCBjb2xWYWx1ZXMpLnZhbHVlKCk7XG4gICAgY29uc3QgZmlsdGVycyA9IHt9O1xuICAgIGNvbnN0IGNvbExpbWl0ID0gTWF0aC5taW4oY29sQXR0cnMubGVuZ3RoLCBjb2xWYWx1ZXMubGVuZ3RoKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbExpbWl0OyBpICs9IDEpIHtcbiAgICAgIGNvbnN0IGF0dHIgPSBjb2xBdHRyc1tpXTtcbiAgICAgIGlmIChjb2xWYWx1ZXNbaV0gIT09IG51bGwpIHtcbiAgICAgICAgZmlsdGVyc1thdHRyXSA9IGNvbFZhbHVlc1tpXTtcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc3Qgcm93TGltaXQgPSBNYXRoLm1pbihyb3dBdHRycy5sZW5ndGgsIHJvd1ZhbHVlcy5sZW5ndGgpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm93TGltaXQ7IGkgKz0gMSkge1xuICAgICAgY29uc3QgYXR0ciA9IHJvd0F0dHJzW2ldO1xuICAgICAgaWYgKHJvd1ZhbHVlc1tpXSAhPT0gbnVsbCkge1xuICAgICAgICBmaWx0ZXJzW2F0dHJdID0gcm93VmFsdWVzW2ldO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZSA9PlxuICAgICAgdGhpcy5wcm9wcy50YWJsZU9wdGlvbnMuY2xpY2tDYWxsYmFjayhlLCB2YWx1ZSwgZmlsdGVycywgcGl2b3REYXRhKTtcbiAgfVxuXG4gIGNsaWNrSGVhZGVySGFuZGxlcihcbiAgICBwaXZvdERhdGEsXG4gICAgdmFsdWVzLFxuICAgIGF0dHJzLFxuICAgIGF0dHJJZHgsXG4gICAgY2FsbGJhY2ssXG4gICAgaXNTdWJ0b3RhbCA9IGZhbHNlLFxuICAgIGlzR3JhbmRUb3RhbCA9IGZhbHNlLFxuICApIHtcbiAgICBjb25zdCBmaWx0ZXJzID0ge307XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gYXR0cklkeDsgaSArPSAxKSB7XG4gICAgICBjb25zdCBhdHRyID0gYXR0cnNbaV07XG4gICAgICBmaWx0ZXJzW2F0dHJdID0gdmFsdWVzW2ldO1xuICAgIH1cbiAgICByZXR1cm4gZSA9PlxuICAgICAgY2FsbGJhY2soXG4gICAgICAgIGUsXG4gICAgICAgIHZhbHVlc1thdHRySWR4XSxcbiAgICAgICAgZmlsdGVycyxcbiAgICAgICAgcGl2b3REYXRhLFxuICAgICAgICBpc1N1YnRvdGFsLFxuICAgICAgICBpc0dyYW5kVG90YWwsXG4gICAgICApO1xuICB9XG5cbiAgY29sbGFwc2VBdHRyKHJvd09yQ29sLCBhdHRySWR4LCBhbGxLZXlzKSB7XG4gICAgcmV0dXJuIGUgPT4ge1xuICAgICAgLy8gQ29sbGFwc2UgYW4gZW50aXJlIGF0dHJpYnV0ZS5cbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBjb25zdCBrZXlMZW4gPSBhdHRySWR4ICsgMTtcbiAgICAgIGNvbnN0IGNvbGxhcHNlZCA9IGFsbEtleXMuZmlsdGVyKGsgPT4gay5sZW5ndGggPT09IGtleUxlbikubWFwKGZsYXRLZXkpO1xuXG4gICAgICBjb25zdCB1cGRhdGVzID0ge307XG4gICAgICBjb2xsYXBzZWQuZm9yRWFjaChrID0+IHtcbiAgICAgICAgdXBkYXRlc1trXSA9IHRydWU7XG4gICAgICB9KTtcblxuICAgICAgaWYgKHJvd09yQ29sKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoc3RhdGUgPT4gKHtcbiAgICAgICAgICBjb2xsYXBzZWRSb3dzOiB7IC4uLnN0YXRlLmNvbGxhcHNlZFJvd3MsIC4uLnVwZGF0ZXMgfSxcbiAgICAgICAgfSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZShzdGF0ZSA9PiAoe1xuICAgICAgICAgIGNvbGxhcHNlZENvbHM6IHsgLi4uc3RhdGUuY29sbGFwc2VkQ29scywgLi4udXBkYXRlcyB9LFxuICAgICAgICB9KSk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIGV4cGFuZEF0dHIocm93T3JDb2wsIGF0dHJJZHgsIGFsbEtleXMpIHtcbiAgICByZXR1cm4gZSA9PiB7XG4gICAgICAvLyBFeHBhbmQgYW4gZW50aXJlIGF0dHJpYnV0ZS4gVGhpcyBpbXBsaWNpdGx5IGltcGxpZXMgZXhwYW5kaW5nIGFsbCBvZiB0aGVcbiAgICAgIC8vIHBhcmVudHMgYXMgd2VsbC4gSXQncyBhIGJpdCBpbmVmZmljaWVudCBidXQgYWggd2VsbC4uLlxuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIGNvbnN0IHVwZGF0ZXMgPSB7fTtcbiAgICAgIGFsbEtleXMuZm9yRWFjaChrID0+IHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gYXR0cklkeDsgaSArPSAxKSB7XG4gICAgICAgICAgdXBkYXRlc1tmbGF0S2V5KGsuc2xpY2UoMCwgaSArIDEpKV0gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGlmIChyb3dPckNvbCkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHN0YXRlID0+ICh7XG4gICAgICAgICAgY29sbGFwc2VkUm93czogeyAuLi5zdGF0ZS5jb2xsYXBzZWRSb3dzLCAuLi51cGRhdGVzIH0sXG4gICAgICAgIH0pKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoc3RhdGUgPT4gKHtcbiAgICAgICAgICBjb2xsYXBzZWRDb2xzOiB7IC4uLnN0YXRlLmNvbGxhcHNlZENvbHMsIC4uLnVwZGF0ZXMgfSxcbiAgICAgICAgfSkpO1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICB0b2dnbGVSb3dLZXkoZmxhdFJvd0tleSkge1xuICAgIHJldHVybiBlID0+IHtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICB0aGlzLnNldFN0YXRlKHN0YXRlID0+ICh7XG4gICAgICAgIGNvbGxhcHNlZFJvd3M6IHtcbiAgICAgICAgICAuLi5zdGF0ZS5jb2xsYXBzZWRSb3dzLFxuICAgICAgICAgIFtmbGF0Um93S2V5XTogIXN0YXRlLmNvbGxhcHNlZFJvd3NbZmxhdFJvd0tleV0sXG4gICAgICAgIH0sXG4gICAgICB9KSk7XG4gICAgfTtcbiAgfVxuXG4gIHRvZ2dsZUNvbEtleShmbGF0Q29sS2V5KSB7XG4gICAgcmV0dXJuIGUgPT4ge1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIHRoaXMuc2V0U3RhdGUoc3RhdGUgPT4gKHtcbiAgICAgICAgY29sbGFwc2VkQ29sczoge1xuICAgICAgICAgIC4uLnN0YXRlLmNvbGxhcHNlZENvbHMsXG4gICAgICAgICAgW2ZsYXRDb2xLZXldOiAhc3RhdGUuY29sbGFwc2VkQ29sc1tmbGF0Q29sS2V5XSxcbiAgICAgICAgfSxcbiAgICAgIH0pKTtcbiAgICB9O1xuICB9XG5cbiAgY2FsY0F0dHJTcGFucyhhdHRyQXJyLCBudW1BdHRycykge1xuICAgIC8vIEdpdmVuIGFuIGFycmF5IG9mIGF0dHJpYnV0ZSB2YWx1ZXMgKGkuZS4gZWFjaCBlbGVtZW50IGlzIGFub3RoZXIgYXJyYXkgd2l0aFxuICAgIC8vIHRoZSB2YWx1ZSBhdCBldmVyeSBsZXZlbCksIGNvbXB1dGUgdGhlIHNwYW5zIGZvciBldmVyeSBhdHRyaWJ1dGUgdmFsdWUgYXRcbiAgICAvLyBldmVyeSBsZXZlbC4gVGhlIHJldHVybiB2YWx1ZSBpcyBhIG5lc3RlZCBhcnJheSBvZiB0aGUgc2FtZSBzaGFwZS4gSXQgaGFzXG4gICAgLy8gLTEncyBmb3IgcmVwZWF0ZWQgdmFsdWVzIGFuZCB0aGUgc3BhbiBudW1iZXIgb3RoZXJ3aXNlLlxuXG4gICAgY29uc3Qgc3BhbnMgPSBbXTtcbiAgICAvLyBJbmRleCBvZiB0aGUgbGFzdCBuZXcgdmFsdWVcbiAgICBjb25zdCBsaSA9IEFycmF5KG51bUF0dHJzKS5tYXAoKCkgPT4gMCk7XG4gICAgbGV0IGx2ID0gQXJyYXkobnVtQXR0cnMpLm1hcCgoKSA9PiBudWxsKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGF0dHJBcnIubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgIC8vIEtlZXAgaW5jcmVhc2luZyBzcGFuIHZhbHVlcyBhcyBsb25nIGFzIHRoZSBsYXN0IGtleXMgYXJlIHRoZSBzYW1lLiBGb3JcbiAgICAgIC8vIHRoZSByZXN0LCByZWNvcmQgc3BhbnMgb2YgMS4gVXBkYXRlIHRoZSBpbmRpY2VzIHRvby5cbiAgICAgIGNvbnN0IGN2ID0gYXR0ckFycltpXTtcbiAgICAgIGNvbnN0IGVudCA9IFtdO1xuICAgICAgbGV0IGRlcHRoID0gMDtcbiAgICAgIGNvbnN0IGxpbWl0ID0gTWF0aC5taW4obHYubGVuZ3RoLCBjdi5sZW5ndGgpO1xuICAgICAgd2hpbGUgKGRlcHRoIDwgbGltaXQgJiYgbHZbZGVwdGhdID09PSBjdltkZXB0aF0pIHtcbiAgICAgICAgZW50LnB1c2goLTEpO1xuICAgICAgICBzcGFuc1tsaVtkZXB0aF1dW2RlcHRoXSArPSAxO1xuICAgICAgICBkZXB0aCArPSAxO1xuICAgICAgfVxuICAgICAgd2hpbGUgKGRlcHRoIDwgY3YubGVuZ3RoKSB7XG4gICAgICAgIGxpW2RlcHRoXSA9IGk7XG4gICAgICAgIGVudC5wdXNoKDEpO1xuICAgICAgICBkZXB0aCArPSAxO1xuICAgICAgfVxuICAgICAgc3BhbnMucHVzaChlbnQpO1xuICAgICAgbHYgPSBjdjtcbiAgICB9XG4gICAgcmV0dXJuIHNwYW5zO1xuICB9XG5cbiAgcmVuZGVyQ29sSGVhZGVyUm93KGF0dHJOYW1lLCBhdHRySWR4LCBwaXZvdFNldHRpbmdzKSB7XG4gICAgLy8gUmVuZGVyIGEgc2luZ2xlIHJvdyBpbiB0aGUgY29sdW1uIGhlYWRlciBhdCB0aGUgdG9wIG9mIHRoZSBwaXZvdCB0YWJsZS5cblxuICAgIGNvbnN0IHtcbiAgICAgIHJvd0F0dHJzLFxuICAgICAgY29sQXR0cnMsXG4gICAgICBjb2xLZXlzLFxuICAgICAgdmlzaWJsZUNvbEtleXMsXG4gICAgICBjb2xBdHRyU3BhbnMsXG4gICAgICByb3dUb3RhbHMsXG4gICAgICBhcnJvd0V4cGFuZGVkLFxuICAgICAgYXJyb3dDb2xsYXBzZWQsXG4gICAgICBjb2xTdWJ0b3RhbERpc3BsYXksXG4gICAgICBtYXhDb2xWaXNpYmxlLFxuICAgICAgcGl2b3REYXRhLFxuICAgICAgbmFtZXNNYXBwaW5nLFxuICAgICAgYWxsb3dSZW5kZXJIdG1sLFxuICAgIH0gPSBwaXZvdFNldHRpbmdzO1xuICAgIGNvbnN0IHtcbiAgICAgIGhpZ2hsaWdodEhlYWRlckNlbGxzT25Ib3ZlcixcbiAgICAgIG9taXR0ZWRIaWdobGlnaHRIZWFkZXJHcm91cHMgPSBbXSxcbiAgICAgIGhpZ2hsaWdodGVkSGVhZGVyQ2VsbHMsXG4gICAgICBkYXRlRm9ybWF0dGVycyxcbiAgICB9ID0gdGhpcy5wcm9wcy50YWJsZU9wdGlvbnM7XG5cbiAgICBjb25zdCBzcGFjZUNlbGwgPVxuICAgICAgYXR0cklkeCA9PT0gMCAmJiByb3dBdHRycy5sZW5ndGggIT09IDAgPyAoXG4gICAgICAgIDx0aFxuICAgICAgICAgIGtleT1cInBhZGRpbmdcIlxuICAgICAgICAgIGNvbFNwYW49e3Jvd0F0dHJzLmxlbmd0aH1cbiAgICAgICAgICByb3dTcGFuPXtjb2xBdHRycy5sZW5ndGh9XG4gICAgICAgICAgYXJpYS1oaWRkZW49XCJ0cnVlXCJcbiAgICAgICAgLz5cbiAgICAgICkgOiBudWxsO1xuXG4gICAgY29uc3QgbmVlZFRvZ2dsZSA9XG4gICAgICBjb2xTdWJ0b3RhbERpc3BsYXkuZW5hYmxlZCAmJiBhdHRySWR4ICE9PSBjb2xBdHRycy5sZW5ndGggLSAxO1xuICAgIGxldCBhcnJvd0NsaWNrSGFuZGxlID0gbnVsbDtcbiAgICBsZXQgc3ViQXJyb3cgPSBudWxsO1xuICAgIGlmIChuZWVkVG9nZ2xlKSB7XG4gICAgICBhcnJvd0NsaWNrSGFuZGxlID1cbiAgICAgICAgYXR0cklkeCArIDEgPCBtYXhDb2xWaXNpYmxlXG4gICAgICAgICAgPyB0aGlzLmNvbGxhcHNlQXR0cihmYWxzZSwgYXR0cklkeCwgY29sS2V5cylcbiAgICAgICAgICA6IHRoaXMuZXhwYW5kQXR0cihmYWxzZSwgYXR0cklkeCwgY29sS2V5cyk7XG4gICAgICBzdWJBcnJvdyA9IGF0dHJJZHggKyAxIDwgbWF4Q29sVmlzaWJsZSA/IGFycm93RXhwYW5kZWQgOiBhcnJvd0NvbGxhcHNlZDtcbiAgICB9XG4gICAgY29uc3QgYXR0ck5hbWVDZWxsID0gKFxuICAgICAgPHRoIGtleT1cImxhYmVsXCIgY2xhc3NOYW1lPVwicHZ0QXhpc0xhYmVsXCI+XG4gICAgICAgIHtkaXNwbGF5SGVhZGVyQ2VsbChcbiAgICAgICAgICBuZWVkVG9nZ2xlLFxuICAgICAgICAgIHN1YkFycm93LFxuICAgICAgICAgIGFycm93Q2xpY2tIYW5kbGUsXG4gICAgICAgICAgYXR0ck5hbWUsXG4gICAgICAgICAgbmFtZXNNYXBwaW5nLFxuICAgICAgICAgIGFsbG93UmVuZGVySHRtbCxcbiAgICAgICAgKX1cbiAgICAgIDwvdGg+XG4gICAgKTtcblxuICAgIGNvbnN0IGF0dHJWYWx1ZUNlbGxzID0gW107XG4gICAgY29uc3Qgcm93SW5jclNwYW4gPSByb3dBdHRycy5sZW5ndGggIT09IDAgPyAxIDogMDtcbiAgICAvLyBJdGVyYXRlIHRocm91Z2ggY29sdW1ucy4gSnVtcCBvdmVyIGR1cGxpY2F0ZSB2YWx1ZXMuXG4gICAgbGV0IGkgPSAwO1xuICAgIHdoaWxlIChpIDwgdmlzaWJsZUNvbEtleXMubGVuZ3RoKSB7XG4gICAgICBsZXQgaGFuZGxlQ29udGV4dE1lbnU7XG4gICAgICBjb25zdCBjb2xLZXkgPSB2aXNpYmxlQ29sS2V5c1tpXTtcbiAgICAgIGNvbnN0IGNvbFNwYW4gPSBhdHRySWR4IDwgY29sS2V5Lmxlbmd0aCA/IGNvbEF0dHJTcGFuc1tpXVthdHRySWR4XSA6IDE7XG4gICAgICBsZXQgY29sTGFiZWxDbGFzcyA9ICdwdnRDb2xMYWJlbCc7XG4gICAgICBpZiAoYXR0cklkeCA8IGNvbEtleS5sZW5ndGgpIHtcbiAgICAgICAgaWYgKCFvbWl0dGVkSGlnaGxpZ2h0SGVhZGVyR3JvdXBzLmluY2x1ZGVzKGNvbEF0dHJzW2F0dHJJZHhdKSkge1xuICAgICAgICAgIGlmIChoaWdobGlnaHRIZWFkZXJDZWxsc09uSG92ZXIpIHtcbiAgICAgICAgICAgIGNvbExhYmVsQ2xhc3MgKz0gJyBob3ZlcmFibGUnO1xuICAgICAgICAgIH1cbiAgICAgICAgICBoYW5kbGVDb250ZXh0TWVudSA9IGUgPT5cbiAgICAgICAgICAgIHRoaXMucHJvcHMub25Db250ZXh0TWVudShlLCBjb2xLZXksIHVuZGVmaW5lZCwge1xuICAgICAgICAgICAgICBbYXR0ck5hbWVdOiBjb2xLZXlbYXR0cklkeF0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoXG4gICAgICAgICAgaGlnaGxpZ2h0ZWRIZWFkZXJDZWxscyAmJlxuICAgICAgICAgIEFycmF5LmlzQXJyYXkoaGlnaGxpZ2h0ZWRIZWFkZXJDZWxsc1tjb2xBdHRyc1thdHRySWR4XV0pICYmXG4gICAgICAgICAgaGlnaGxpZ2h0ZWRIZWFkZXJDZWxsc1tjb2xBdHRyc1thdHRySWR4XV0uaW5jbHVkZXMoY29sS2V5W2F0dHJJZHhdKVxuICAgICAgICApIHtcbiAgICAgICAgICBjb2xMYWJlbENsYXNzICs9ICcgYWN0aXZlJztcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHJvd1NwYW4gPSAxICsgKGF0dHJJZHggPT09IGNvbEF0dHJzLmxlbmd0aCAtIDEgPyByb3dJbmNyU3BhbiA6IDApO1xuICAgICAgICBjb25zdCBmbGF0Q29sS2V5ID0gZmxhdEtleShjb2xLZXkuc2xpY2UoMCwgYXR0cklkeCArIDEpKTtcbiAgICAgICAgY29uc3Qgb25BcnJvd0NsaWNrID0gbmVlZFRvZ2dsZSA/IHRoaXMudG9nZ2xlQ29sS2V5KGZsYXRDb2xLZXkpIDogbnVsbDtcblxuICAgICAgICBjb25zdCBoZWFkZXJDZWxsRm9ybWF0dGVkVmFsdWUgPVxuICAgICAgICAgIGRhdGVGb3JtYXR0ZXJzICYmXG4gICAgICAgICAgZGF0ZUZvcm1hdHRlcnNbYXR0ck5hbWVdICYmXG4gICAgICAgICAgdHlwZW9mIGRhdGVGb3JtYXR0ZXJzW2F0dHJOYW1lXSA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICAgICAgPyBkYXRlRm9ybWF0dGVyc1thdHRyTmFtZV0oY29sS2V5W2F0dHJJZHhdKVxuICAgICAgICAgICAgOiBjb2xLZXlbYXR0cklkeF07XG4gICAgICAgIGF0dHJWYWx1ZUNlbGxzLnB1c2goXG4gICAgICAgICAgPHRoXG4gICAgICAgICAgICBjbGFzc05hbWU9e2NvbExhYmVsQ2xhc3N9XG4gICAgICAgICAgICBrZXk9e2Bjb2xLZXktJHtmbGF0Q29sS2V5fWB9XG4gICAgICAgICAgICBjb2xTcGFuPXtjb2xTcGFufVxuICAgICAgICAgICAgcm93U3Bhbj17cm93U3Bhbn1cbiAgICAgICAgICAgIHJvbGU9XCJjb2x1bW5oZWFkZXIgYnV0dG9uXCJcbiAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMuY2xpY2tIZWFkZXJIYW5kbGVyKFxuICAgICAgICAgICAgICBwaXZvdERhdGEsXG4gICAgICAgICAgICAgIGNvbEtleSxcbiAgICAgICAgICAgICAgdGhpcy5wcm9wcy5jb2xzLFxuICAgICAgICAgICAgICBhdHRySWR4LFxuICAgICAgICAgICAgICB0aGlzLnByb3BzLnRhYmxlT3B0aW9ucy5jbGlja0NvbHVtbkhlYWRlckNhbGxiYWNrLFxuICAgICAgICAgICAgKX1cbiAgICAgICAgICAgIG9uQ29udGV4dE1lbnU9e2hhbmRsZUNvbnRleHRNZW51fVxuICAgICAgICAgID5cbiAgICAgICAgICAgIHtkaXNwbGF5SGVhZGVyQ2VsbChcbiAgICAgICAgICAgICAgbmVlZFRvZ2dsZSxcbiAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5jb2xsYXBzZWRDb2xzW2ZsYXRDb2xLZXldXG4gICAgICAgICAgICAgICAgPyBhcnJvd0NvbGxhcHNlZFxuICAgICAgICAgICAgICAgIDogYXJyb3dFeHBhbmRlZCxcbiAgICAgICAgICAgICAgb25BcnJvd0NsaWNrLFxuICAgICAgICAgICAgICBoZWFkZXJDZWxsRm9ybWF0dGVkVmFsdWUsXG4gICAgICAgICAgICAgIG5hbWVzTWFwcGluZyxcbiAgICAgICAgICAgICAgYWxsb3dSZW5kZXJIdG1sLFxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8L3RoPixcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSBpZiAoYXR0cklkeCA9PT0gY29sS2V5Lmxlbmd0aCkge1xuICAgICAgICBjb25zdCByb3dTcGFuID0gY29sQXR0cnMubGVuZ3RoIC0gY29sS2V5Lmxlbmd0aCArIHJvd0luY3JTcGFuO1xuICAgICAgICBhdHRyVmFsdWVDZWxscy5wdXNoKFxuICAgICAgICAgIDx0aFxuICAgICAgICAgICAgY2xhc3NOYW1lPXtgJHtjb2xMYWJlbENsYXNzfSBwdnRTdWJ0b3RhbExhYmVsYH1cbiAgICAgICAgICAgIGtleT17YGNvbEtleUJ1ZmZlci0ke2ZsYXRLZXkoY29sS2V5KX1gfVxuICAgICAgICAgICAgY29sU3Bhbj17Y29sU3Bhbn1cbiAgICAgICAgICAgIHJvd1NwYW49e3Jvd1NwYW59XG4gICAgICAgICAgICByb2xlPVwiY29sdW1uaGVhZGVyIGJ1dHRvblwiXG4gICAgICAgICAgICBvbkNsaWNrPXt0aGlzLmNsaWNrSGVhZGVySGFuZGxlcihcbiAgICAgICAgICAgICAgcGl2b3REYXRhLFxuICAgICAgICAgICAgICBjb2xLZXksXG4gICAgICAgICAgICAgIHRoaXMucHJvcHMuY29scyxcbiAgICAgICAgICAgICAgYXR0cklkeCxcbiAgICAgICAgICAgICAgdGhpcy5wcm9wcy50YWJsZU9wdGlvbnMuY2xpY2tDb2x1bW5IZWFkZXJDYWxsYmFjayxcbiAgICAgICAgICAgICAgdHJ1ZSxcbiAgICAgICAgICAgICl9XG4gICAgICAgICAgPlxuICAgICAgICAgICAge3QoJ1N1YnRvdGFsJyl9XG4gICAgICAgICAgPC90aD4sXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICAvLyBUaGUgbmV4dCBjb2xTcGFuIGNvbHVtbnMgd2lsbCBoYXZlIHRoZSBzYW1lIHZhbHVlIGFueXdheS4uLlxuICAgICAgaSArPSBjb2xTcGFuO1xuICAgIH1cblxuICAgIGNvbnN0IHRvdGFsQ2VsbCA9XG4gICAgICBhdHRySWR4ID09PSAwICYmIHJvd1RvdGFscyA/IChcbiAgICAgICAgPHRoXG4gICAgICAgICAga2V5PVwidG90YWxcIlxuICAgICAgICAgIGNsYXNzTmFtZT1cInB2dFRvdGFsTGFiZWxcIlxuICAgICAgICAgIHJvd1NwYW49e2NvbEF0dHJzLmxlbmd0aCArIE1hdGgubWluKHJvd0F0dHJzLmxlbmd0aCwgMSl9XG4gICAgICAgICAgcm9sZT1cImNvbHVtbmhlYWRlciBidXR0b25cIlxuICAgICAgICAgIG9uQ2xpY2s9e3RoaXMuY2xpY2tIZWFkZXJIYW5kbGVyKFxuICAgICAgICAgICAgcGl2b3REYXRhLFxuICAgICAgICAgICAgW10sXG4gICAgICAgICAgICB0aGlzLnByb3BzLmNvbHMsXG4gICAgICAgICAgICBhdHRySWR4LFxuICAgICAgICAgICAgdGhpcy5wcm9wcy50YWJsZU9wdGlvbnMuY2xpY2tDb2x1bW5IZWFkZXJDYWxsYmFjayxcbiAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgdHJ1ZSxcbiAgICAgICAgICApfVxuICAgICAgICA+XG4gICAgICAgICAge3QoJ1RvdGFsICglKGFnZ3JlZ2F0b3JOYW1lKXMpJywge1xuICAgICAgICAgICAgYWdncmVnYXRvck5hbWU6IHQodGhpcy5wcm9wcy5hZ2dyZWdhdG9yTmFtZSksXG4gICAgICAgICAgfSl9XG4gICAgICAgIDwvdGg+XG4gICAgICApIDogbnVsbDtcblxuICAgIGNvbnN0IGNlbGxzID0gW3NwYWNlQ2VsbCwgYXR0ck5hbWVDZWxsLCAuLi5hdHRyVmFsdWVDZWxscywgdG90YWxDZWxsXTtcbiAgICByZXR1cm4gPHRyIGtleT17YGNvbEF0dHItJHthdHRySWR4fWB9PntjZWxsc308L3RyPjtcbiAgfVxuXG4gIHJlbmRlclJvd0hlYWRlclJvdyhwaXZvdFNldHRpbmdzKSB7XG4gICAgLy8gUmVuZGVyIGp1c3QgdGhlIGF0dHJpYnV0ZSBuYW1lcyBvZiB0aGUgcm93cyAodGhlIGFjdHVhbCBhdHRyaWJ1dGUgdmFsdWVzXG4gICAgLy8gd2lsbCBzaG93IHVwIGluIHRoZSBpbmRpdmlkdWFsIHJvd3MpLlxuXG4gICAgY29uc3Qge1xuICAgICAgcm93QXR0cnMsXG4gICAgICBjb2xBdHRycyxcbiAgICAgIHJvd0tleXMsXG4gICAgICBhcnJvd0NvbGxhcHNlZCxcbiAgICAgIGFycm93RXhwYW5kZWQsXG4gICAgICByb3dTdWJ0b3RhbERpc3BsYXksXG4gICAgICBtYXhSb3dWaXNpYmxlLFxuICAgICAgcGl2b3REYXRhLFxuICAgICAgbmFtZXNNYXBwaW5nLFxuICAgICAgYWxsb3dSZW5kZXJIdG1sLFxuICAgIH0gPSBwaXZvdFNldHRpbmdzO1xuICAgIHJldHVybiAoXG4gICAgICA8dHIga2V5PVwicm93SGRyXCI+XG4gICAgICAgIHtyb3dBdHRycy5tYXAoKHIsIGkpID0+IHtcbiAgICAgICAgICBjb25zdCBuZWVkTGFiZWxUb2dnbGUgPVxuICAgICAgICAgICAgcm93U3VidG90YWxEaXNwbGF5LmVuYWJsZWQgJiYgaSAhPT0gcm93QXR0cnMubGVuZ3RoIC0gMTtcbiAgICAgICAgICBsZXQgYXJyb3dDbGlja0hhbmRsZSA9IG51bGw7XG4gICAgICAgICAgbGV0IHN1YkFycm93ID0gbnVsbDtcbiAgICAgICAgICBpZiAobmVlZExhYmVsVG9nZ2xlKSB7XG4gICAgICAgICAgICBhcnJvd0NsaWNrSGFuZGxlID1cbiAgICAgICAgICAgICAgaSArIDEgPCBtYXhSb3dWaXNpYmxlXG4gICAgICAgICAgICAgICAgPyB0aGlzLmNvbGxhcHNlQXR0cih0cnVlLCBpLCByb3dLZXlzKVxuICAgICAgICAgICAgICAgIDogdGhpcy5leHBhbmRBdHRyKHRydWUsIGksIHJvd0tleXMpO1xuICAgICAgICAgICAgc3ViQXJyb3cgPSBpICsgMSA8IG1heFJvd1Zpc2libGUgPyBhcnJvd0V4cGFuZGVkIDogYXJyb3dDb2xsYXBzZWQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8dGggY2xhc3NOYW1lPVwicHZ0QXhpc0xhYmVsXCIga2V5PXtgcm93QXR0ci0ke2l9YH0+XG4gICAgICAgICAgICAgIHtkaXNwbGF5SGVhZGVyQ2VsbChcbiAgICAgICAgICAgICAgICBuZWVkTGFiZWxUb2dnbGUsXG4gICAgICAgICAgICAgICAgc3ViQXJyb3csXG4gICAgICAgICAgICAgICAgYXJyb3dDbGlja0hhbmRsZSxcbiAgICAgICAgICAgICAgICByLFxuICAgICAgICAgICAgICAgIG5hbWVzTWFwcGluZyxcbiAgICAgICAgICAgICAgICBhbGxvd1JlbmRlckh0bWwsXG4gICAgICAgICAgICAgICl9XG4gICAgICAgICAgICA8L3RoPlxuICAgICAgICAgICk7XG4gICAgICAgIH0pfVxuICAgICAgICA8dGhcbiAgICAgICAgICBjbGFzc05hbWU9XCJwdnRUb3RhbExhYmVsXCJcbiAgICAgICAgICBrZXk9XCJwYWRkaW5nXCJcbiAgICAgICAgICByb2xlPVwiY29sdW1uaGVhZGVyIGJ1dHRvblwiXG4gICAgICAgICAgb25DbGljaz17dGhpcy5jbGlja0hlYWRlckhhbmRsZXIoXG4gICAgICAgICAgICBwaXZvdERhdGEsXG4gICAgICAgICAgICBbXSxcbiAgICAgICAgICAgIHRoaXMucHJvcHMucm93cyxcbiAgICAgICAgICAgIDAsXG4gICAgICAgICAgICB0aGlzLnByb3BzLnRhYmxlT3B0aW9ucy5jbGlja1Jvd0hlYWRlckNhbGxiYWNrLFxuICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICl9XG4gICAgICAgID5cbiAgICAgICAgICB7Y29sQXR0cnMubGVuZ3RoID09PSAwXG4gICAgICAgICAgICA/IHQoJ1RvdGFsICglKGFnZ3JlZ2F0b3JOYW1lKXMpJywge1xuICAgICAgICAgICAgICAgIGFnZ3JlZ2F0b3JOYW1lOiB0KHRoaXMucHJvcHMuYWdncmVnYXRvck5hbWUpLFxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgOiBudWxsfVxuICAgICAgICA8L3RoPlxuICAgICAgPC90cj5cbiAgICApO1xuICB9XG5cbiAgcmVuZGVyVGFibGVSb3cocm93S2V5LCByb3dJZHgsIHBpdm90U2V0dGluZ3MpIHtcbiAgICAvLyBSZW5kZXIgYSBzaW5nbGUgcm93IGluIHRoZSBwaXZvdCB0YWJsZS5cblxuICAgIGNvbnN0IHtcbiAgICAgIHJvd0F0dHJzLFxuICAgICAgY29sQXR0cnMsXG4gICAgICByb3dBdHRyU3BhbnMsXG4gICAgICB2aXNpYmxlQ29sS2V5cyxcbiAgICAgIHBpdm90RGF0YSxcbiAgICAgIHJvd1RvdGFscyxcbiAgICAgIHJvd1N1YnRvdGFsRGlzcGxheSxcbiAgICAgIGFycm93RXhwYW5kZWQsXG4gICAgICBhcnJvd0NvbGxhcHNlZCxcbiAgICAgIGNlbGxDYWxsYmFja3MsXG4gICAgICByb3dUb3RhbENhbGxiYWNrcyxcbiAgICAgIG5hbWVzTWFwcGluZyxcbiAgICAgIGFsbG93UmVuZGVySHRtbCxcbiAgICB9ID0gcGl2b3RTZXR0aW5ncztcblxuICAgIGNvbnN0IHtcbiAgICAgIGhpZ2hsaWdodEhlYWRlckNlbGxzT25Ib3ZlcixcbiAgICAgIG9taXR0ZWRIaWdobGlnaHRIZWFkZXJHcm91cHMgPSBbXSxcbiAgICAgIGhpZ2hsaWdodGVkSGVhZGVyQ2VsbHMsXG4gICAgICBjZWxsQ29sb3JGb3JtYXR0ZXJzLFxuICAgICAgZGF0ZUZvcm1hdHRlcnMsXG4gICAgfSA9IHRoaXMucHJvcHMudGFibGVPcHRpb25zO1xuICAgIGNvbnN0IGZsYXRSb3dLZXkgPSBmbGF0S2V5KHJvd0tleSk7XG5cbiAgICBjb25zdCBjb2xJbmNyU3BhbiA9IGNvbEF0dHJzLmxlbmd0aCAhPT0gMCA/IDEgOiAwO1xuICAgIGNvbnN0IGF0dHJWYWx1ZUNlbGxzID0gcm93S2V5Lm1hcCgociwgaSkgPT4ge1xuICAgICAgbGV0IGhhbmRsZUNvbnRleHRNZW51O1xuICAgICAgbGV0IHZhbHVlQ2VsbENsYXNzTmFtZSA9ICdwdnRSb3dMYWJlbCc7XG4gICAgICBpZiAoIW9taXR0ZWRIaWdobGlnaHRIZWFkZXJHcm91cHMuaW5jbHVkZXMocm93QXR0cnNbaV0pKSB7XG4gICAgICAgIGlmIChoaWdobGlnaHRIZWFkZXJDZWxsc09uSG92ZXIpIHtcbiAgICAgICAgICB2YWx1ZUNlbGxDbGFzc05hbWUgKz0gJyBob3ZlcmFibGUnO1xuICAgICAgICB9XG4gICAgICAgIGhhbmRsZUNvbnRleHRNZW51ID0gZSA9PlxuICAgICAgICAgIHRoaXMucHJvcHMub25Db250ZXh0TWVudShlLCB1bmRlZmluZWQsIHJvd0tleSwge1xuICAgICAgICAgICAgW3Jvd0F0dHJzW2ldXTogcixcbiAgICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmIChcbiAgICAgICAgaGlnaGxpZ2h0ZWRIZWFkZXJDZWxscyAmJlxuICAgICAgICBBcnJheS5pc0FycmF5KGhpZ2hsaWdodGVkSGVhZGVyQ2VsbHNbcm93QXR0cnNbaV1dKSAmJlxuICAgICAgICBoaWdobGlnaHRlZEhlYWRlckNlbGxzW3Jvd0F0dHJzW2ldXS5pbmNsdWRlcyhyKVxuICAgICAgKSB7XG4gICAgICAgIHZhbHVlQ2VsbENsYXNzTmFtZSArPSAnIGFjdGl2ZSc7XG4gICAgICB9XG4gICAgICBjb25zdCByb3dTcGFuID0gcm93QXR0clNwYW5zW3Jvd0lkeF1baV07XG4gICAgICBpZiAocm93U3BhbiA+IDApIHtcbiAgICAgICAgY29uc3QgZmxhdFJvd0tleSA9IGZsYXRLZXkocm93S2V5LnNsaWNlKDAsIGkgKyAxKSk7XG4gICAgICAgIGNvbnN0IGNvbFNwYW4gPSAxICsgKGkgPT09IHJvd0F0dHJzLmxlbmd0aCAtIDEgPyBjb2xJbmNyU3BhbiA6IDApO1xuICAgICAgICBjb25zdCBuZWVkUm93VG9nZ2xlID1cbiAgICAgICAgICByb3dTdWJ0b3RhbERpc3BsYXkuZW5hYmxlZCAmJiBpICE9PSByb3dBdHRycy5sZW5ndGggLSAxO1xuICAgICAgICBjb25zdCBvbkFycm93Q2xpY2sgPSBuZWVkUm93VG9nZ2xlXG4gICAgICAgICAgPyB0aGlzLnRvZ2dsZVJvd0tleShmbGF0Um93S2V5KVxuICAgICAgICAgIDogbnVsbDtcblxuICAgICAgICBjb25zdCBoZWFkZXJDZWxsRm9ybWF0dGVkVmFsdWUgPVxuICAgICAgICAgIGRhdGVGb3JtYXR0ZXJzICYmIGRhdGVGb3JtYXR0ZXJzW3Jvd0F0dHJzW2ldXVxuICAgICAgICAgICAgPyBkYXRlRm9ybWF0dGVyc1tyb3dBdHRyc1tpXV0ocilcbiAgICAgICAgICAgIDogcjtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICA8dGhcbiAgICAgICAgICAgIGtleT17YHJvd0tleUxhYmVsLSR7aX1gfVxuICAgICAgICAgICAgY2xhc3NOYW1lPXt2YWx1ZUNlbGxDbGFzc05hbWV9XG4gICAgICAgICAgICByb3dTcGFuPXtyb3dTcGFufVxuICAgICAgICAgICAgY29sU3Bhbj17Y29sU3Bhbn1cbiAgICAgICAgICAgIHJvbGU9XCJjb2x1bW5oZWFkZXIgYnV0dG9uXCJcbiAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMuY2xpY2tIZWFkZXJIYW5kbGVyKFxuICAgICAgICAgICAgICBwaXZvdERhdGEsXG4gICAgICAgICAgICAgIHJvd0tleSxcbiAgICAgICAgICAgICAgdGhpcy5wcm9wcy5yb3dzLFxuICAgICAgICAgICAgICBpLFxuICAgICAgICAgICAgICB0aGlzLnByb3BzLnRhYmxlT3B0aW9ucy5jbGlja1Jvd0hlYWRlckNhbGxiYWNrLFxuICAgICAgICAgICAgKX1cbiAgICAgICAgICAgIG9uQ29udGV4dE1lbnU9e2hhbmRsZUNvbnRleHRNZW51fVxuICAgICAgICAgID5cbiAgICAgICAgICAgIHtkaXNwbGF5SGVhZGVyQ2VsbChcbiAgICAgICAgICAgICAgbmVlZFJvd1RvZ2dsZSxcbiAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5jb2xsYXBzZWRSb3dzW2ZsYXRSb3dLZXldXG4gICAgICAgICAgICAgICAgPyBhcnJvd0NvbGxhcHNlZFxuICAgICAgICAgICAgICAgIDogYXJyb3dFeHBhbmRlZCxcbiAgICAgICAgICAgICAgb25BcnJvd0NsaWNrLFxuICAgICAgICAgICAgICBoZWFkZXJDZWxsRm9ybWF0dGVkVmFsdWUsXG4gICAgICAgICAgICAgIG5hbWVzTWFwcGluZyxcbiAgICAgICAgICAgICAgYWxsb3dSZW5kZXJIdG1sLFxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8L3RoPlxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSk7XG5cbiAgICBjb25zdCBhdHRyVmFsdWVQYWRkaW5nQ2VsbCA9XG4gICAgICByb3dLZXkubGVuZ3RoIDwgcm93QXR0cnMubGVuZ3RoID8gKFxuICAgICAgICA8dGhcbiAgICAgICAgICBjbGFzc05hbWU9XCJwdnRSb3dMYWJlbCBwdnRTdWJ0b3RhbExhYmVsXCJcbiAgICAgICAgICBrZXk9XCJyb3dLZXlCdWZmZXJcIlxuICAgICAgICAgIGNvbFNwYW49e3Jvd0F0dHJzLmxlbmd0aCAtIHJvd0tleS5sZW5ndGggKyBjb2xJbmNyU3Bhbn1cbiAgICAgICAgICByb3dTcGFuPXsxfVxuICAgICAgICAgIHJvbGU9XCJjb2x1bW5oZWFkZXIgYnV0dG9uXCJcbiAgICAgICAgICBvbkNsaWNrPXt0aGlzLmNsaWNrSGVhZGVySGFuZGxlcihcbiAgICAgICAgICAgIHBpdm90RGF0YSxcbiAgICAgICAgICAgIHJvd0tleSxcbiAgICAgICAgICAgIHRoaXMucHJvcHMucm93cyxcbiAgICAgICAgICAgIHJvd0tleS5sZW5ndGgsXG4gICAgICAgICAgICB0aGlzLnByb3BzLnRhYmxlT3B0aW9ucy5jbGlja1Jvd0hlYWRlckNhbGxiYWNrLFxuICAgICAgICAgICAgdHJ1ZSxcbiAgICAgICAgICApfVxuICAgICAgICA+XG4gICAgICAgICAge3QoJ1N1YnRvdGFsJyl9XG4gICAgICAgIDwvdGg+XG4gICAgICApIDogbnVsbDtcblxuICAgIGNvbnN0IHJvd0NsaWNrSGFuZGxlcnMgPSBjZWxsQ2FsbGJhY2tzW2ZsYXRSb3dLZXldIHx8IHt9O1xuICAgIGNvbnN0IHZhbHVlQ2VsbHMgPSB2aXNpYmxlQ29sS2V5cy5tYXAoY29sS2V5ID0+IHtcbiAgICAgIGNvbnN0IGZsYXRDb2xLZXkgPSBmbGF0S2V5KGNvbEtleSk7XG4gICAgICBjb25zdCBhZ2cgPSBwaXZvdERhdGEuZ2V0QWdncmVnYXRvcihyb3dLZXksIGNvbEtleSk7XG4gICAgICBjb25zdCBhZ2dWYWx1ZSA9IGFnZy52YWx1ZSgpO1xuXG4gICAgICBjb25zdCBrZXlzID0gWy4uLnJvd0tleSwgLi4uY29sS2V5XTtcbiAgICAgIGxldCBiYWNrZ3JvdW5kQ29sb3I7XG4gICAgICBpZiAoY2VsbENvbG9yRm9ybWF0dGVycykge1xuICAgICAgICBPYmplY3QudmFsdWVzKGNlbGxDb2xvckZvcm1hdHRlcnMpLmZvckVhY2goY2VsbENvbG9yRm9ybWF0dGVyID0+IHtcbiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjZWxsQ29sb3JGb3JtYXR0ZXIpKSB7XG4gICAgICAgICAgICBrZXlzLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgICAgICAgaWYgKGJhY2tncm91bmRDb2xvcikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjZWxsQ29sb3JGb3JtYXR0ZXJcbiAgICAgICAgICAgICAgICAuZmlsdGVyKGZvcm1hdHRlciA9PiBmb3JtYXR0ZXIuY29sdW1uID09PSBrZXkpXG4gICAgICAgICAgICAgICAgLmZvckVhY2goZm9ybWF0dGVyID0+IHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IGZvcm1hdHRlclJlc3VsdCA9IGZvcm1hdHRlci5nZXRDb2xvckZyb21WYWx1ZShhZ2dWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICBpZiAoZm9ybWF0dGVyUmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvciA9IGZvcm1hdHRlclJlc3VsdDtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHN0eWxlID0gYWdnLmlzU3VidG90YWxcbiAgICAgICAgPyB7IGZvbnRXZWlnaHQ6ICdib2xkJyB9XG4gICAgICAgIDogeyBiYWNrZ3JvdW5kQ29sb3IgfTtcblxuICAgICAgcmV0dXJuIChcbiAgICAgICAgPHRkXG4gICAgICAgICAgcm9sZT1cImdyaWRjZWxsXCJcbiAgICAgICAgICBjbGFzc05hbWU9XCJwdnRWYWxcIlxuICAgICAgICAgIGtleT17YHB2dFZhbC0ke2ZsYXRDb2xLZXl9YH1cbiAgICAgICAgICBvbkNsaWNrPXtyb3dDbGlja0hhbmRsZXJzW2ZsYXRDb2xLZXldfVxuICAgICAgICAgIG9uQ29udGV4dE1lbnU9e2UgPT4gdGhpcy5wcm9wcy5vbkNvbnRleHRNZW51KGUsIGNvbEtleSwgcm93S2V5KX1cbiAgICAgICAgICBzdHlsZT17c3R5bGV9XG4gICAgICAgID5cbiAgICAgICAgICB7ZGlzcGxheUNlbGwoYWdnLmZvcm1hdChhZ2dWYWx1ZSksIGFsbG93UmVuZGVySHRtbCl9XG4gICAgICAgIDwvdGQ+XG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgbGV0IHRvdGFsQ2VsbCA9IG51bGw7XG4gICAgaWYgKHJvd1RvdGFscykge1xuICAgICAgY29uc3QgYWdnID0gcGl2b3REYXRhLmdldEFnZ3JlZ2F0b3Iocm93S2V5LCBbXSk7XG4gICAgICBjb25zdCBhZ2dWYWx1ZSA9IGFnZy52YWx1ZSgpO1xuICAgICAgdG90YWxDZWxsID0gKFxuICAgICAgICA8dGRcbiAgICAgICAgICByb2xlPVwiZ3JpZGNlbGxcIlxuICAgICAgICAgIGtleT1cInRvdGFsXCJcbiAgICAgICAgICBjbGFzc05hbWU9XCJwdnRUb3RhbFwiXG4gICAgICAgICAgb25DbGljaz17cm93VG90YWxDYWxsYmFja3NbZmxhdFJvd0tleV19XG4gICAgICAgICAgb25Db250ZXh0TWVudT17ZSA9PiB0aGlzLnByb3BzLm9uQ29udGV4dE1lbnUoZSwgdW5kZWZpbmVkLCByb3dLZXkpfVxuICAgICAgICA+XG4gICAgICAgICAge2Rpc3BsYXlDZWxsKGFnZy5mb3JtYXQoYWdnVmFsdWUpLCBhbGxvd1JlbmRlckh0bWwpfVxuICAgICAgICA8L3RkPlxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCByb3dDZWxscyA9IFtcbiAgICAgIC4uLmF0dHJWYWx1ZUNlbGxzLFxuICAgICAgYXR0clZhbHVlUGFkZGluZ0NlbGwsXG4gICAgICAuLi52YWx1ZUNlbGxzLFxuICAgICAgdG90YWxDZWxsLFxuICAgIF07XG5cbiAgICByZXR1cm4gPHRyIGtleT17YGtleVJvdy0ke2ZsYXRSb3dLZXl9YH0+e3Jvd0NlbGxzfTwvdHI+O1xuICB9XG5cbiAgcmVuZGVyVG90YWxzUm93KHBpdm90U2V0dGluZ3MpIHtcbiAgICAvLyBSZW5kZXIgdGhlIGZpbmFsIHRvdGFscyByb3dzIHRoYXQgaGFzIHRoZSB0b3RhbHMgZm9yIGFsbCB0aGUgY29sdW1ucy5cblxuICAgIGNvbnN0IHtcbiAgICAgIHJvd0F0dHJzLFxuICAgICAgY29sQXR0cnMsXG4gICAgICB2aXNpYmxlQ29sS2V5cyxcbiAgICAgIHJvd1RvdGFscyxcbiAgICAgIHBpdm90RGF0YSxcbiAgICAgIGNvbFRvdGFsQ2FsbGJhY2tzLFxuICAgICAgZ3JhbmRUb3RhbENhbGxiYWNrLFxuICAgIH0gPSBwaXZvdFNldHRpbmdzO1xuXG4gICAgY29uc3QgdG90YWxMYWJlbENlbGwgPSAoXG4gICAgICA8dGhcbiAgICAgICAga2V5PVwibGFiZWxcIlxuICAgICAgICBjbGFzc05hbWU9XCJwdnRUb3RhbExhYmVsIHB2dFJvd1RvdGFsTGFiZWxcIlxuICAgICAgICBjb2xTcGFuPXtyb3dBdHRycy5sZW5ndGggKyBNYXRoLm1pbihjb2xBdHRycy5sZW5ndGgsIDEpfVxuICAgICAgICByb2xlPVwiY29sdW1uaGVhZGVyIGJ1dHRvblwiXG4gICAgICAgIG9uQ2xpY2s9e3RoaXMuY2xpY2tIZWFkZXJIYW5kbGVyKFxuICAgICAgICAgIHBpdm90RGF0YSxcbiAgICAgICAgICBbXSxcbiAgICAgICAgICB0aGlzLnByb3BzLnJvd3MsXG4gICAgICAgICAgMCxcbiAgICAgICAgICB0aGlzLnByb3BzLnRhYmxlT3B0aW9ucy5jbGlja1Jvd0hlYWRlckNhbGxiYWNrLFxuICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgIHRydWUsXG4gICAgICAgICl9XG4gICAgICA+XG4gICAgICAgIHt0KCdUb3RhbCAoJShhZ2dyZWdhdG9yTmFtZSlzKScsIHtcbiAgICAgICAgICBhZ2dyZWdhdG9yTmFtZTogdCh0aGlzLnByb3BzLmFnZ3JlZ2F0b3JOYW1lKSxcbiAgICAgICAgfSl9XG4gICAgICA8L3RoPlxuICAgICk7XG5cbiAgICBjb25zdCB0b3RhbFZhbHVlQ2VsbHMgPSB2aXNpYmxlQ29sS2V5cy5tYXAoY29sS2V5ID0+IHtcbiAgICAgIGNvbnN0IGZsYXRDb2xLZXkgPSBmbGF0S2V5KGNvbEtleSk7XG4gICAgICBjb25zdCBhZ2cgPSBwaXZvdERhdGEuZ2V0QWdncmVnYXRvcihbXSwgY29sS2V5KTtcbiAgICAgIGNvbnN0IGFnZ1ZhbHVlID0gYWdnLnZhbHVlKCk7XG5cbiAgICAgIHJldHVybiAoXG4gICAgICAgIDx0ZFxuICAgICAgICAgIHJvbGU9XCJncmlkY2VsbFwiXG4gICAgICAgICAgY2xhc3NOYW1lPVwicHZ0VG90YWwgcHZ0Um93VG90YWxcIlxuICAgICAgICAgIGtleT17YHRvdGFsLSR7ZmxhdENvbEtleX1gfVxuICAgICAgICAgIG9uQ2xpY2s9e2NvbFRvdGFsQ2FsbGJhY2tzW2ZsYXRDb2xLZXldfVxuICAgICAgICAgIG9uQ29udGV4dE1lbnU9e2UgPT4gdGhpcy5wcm9wcy5vbkNvbnRleHRNZW51KGUsIGNvbEtleSwgdW5kZWZpbmVkKX1cbiAgICAgICAgICBzdHlsZT17eyBwYWRkaW5nOiAnNXB4JyB9fVxuICAgICAgICA+XG4gICAgICAgICAge2Rpc3BsYXlDZWxsKGFnZy5mb3JtYXQoYWdnVmFsdWUpLCB0aGlzLnByb3BzLmFsbG93UmVuZGVySHRtbCl9XG4gICAgICAgIDwvdGQ+XG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgbGV0IGdyYW5kVG90YWxDZWxsID0gbnVsbDtcbiAgICBpZiAocm93VG90YWxzKSB7XG4gICAgICBjb25zdCBhZ2cgPSBwaXZvdERhdGEuZ2V0QWdncmVnYXRvcihbXSwgW10pO1xuICAgICAgY29uc3QgYWdnVmFsdWUgPSBhZ2cudmFsdWUoKTtcbiAgICAgIGdyYW5kVG90YWxDZWxsID0gKFxuICAgICAgICA8dGRcbiAgICAgICAgICByb2xlPVwiZ3JpZGNlbGxcIlxuICAgICAgICAgIGtleT1cInRvdGFsXCJcbiAgICAgICAgICBjbGFzc05hbWU9XCJwdnRHcmFuZFRvdGFsIHB2dFJvd1RvdGFsXCJcbiAgICAgICAgICBvbkNsaWNrPXtncmFuZFRvdGFsQ2FsbGJhY2t9XG4gICAgICAgICAgb25Db250ZXh0TWVudT17ZSA9PiB0aGlzLnByb3BzLm9uQ29udGV4dE1lbnUoZSwgdW5kZWZpbmVkLCB1bmRlZmluZWQpfVxuICAgICAgICA+XG4gICAgICAgICAge2Rpc3BsYXlDZWxsKGFnZy5mb3JtYXQoYWdnVmFsdWUpLCB0aGlzLnByb3BzLmFsbG93UmVuZGVySHRtbCl9XG4gICAgICAgIDwvdGQ+XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHRvdGFsQ2VsbHMgPSBbdG90YWxMYWJlbENlbGwsIC4uLnRvdGFsVmFsdWVDZWxscywgZ3JhbmRUb3RhbENlbGxdO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDx0ciBrZXk9XCJ0b3RhbFwiIGNsYXNzTmFtZT1cInB2dFJvd1RvdGFsc1wiPlxuICAgICAgICB7dG90YWxDZWxsc31cbiAgICAgIDwvdHI+XG4gICAgKTtcbiAgfVxuXG4gIHZpc2libGVLZXlzKGtleXMsIGNvbGxhcHNlZCwgbnVtQXR0cnMsIHN1YnRvdGFsRGlzcGxheSkge1xuICAgIHJldHVybiBrZXlzLmZpbHRlcihcbiAgICAgIGtleSA9PlxuICAgICAgICAvLyBJcyB0aGUga2V5IGhpZGRlbiBieSBvbmUgb2YgaXRzIHBhcmVudHM/XG4gICAgICAgICFrZXkuc29tZSgoaywgaikgPT4gY29sbGFwc2VkW2ZsYXRLZXkoa2V5LnNsaWNlKDAsIGopKV0pICYmXG4gICAgICAgIC8vIExlYWYga2V5LlxuICAgICAgICAoa2V5Lmxlbmd0aCA9PT0gbnVtQXR0cnMgfHxcbiAgICAgICAgICAvLyBDaGlsZHJlbiBoaWRkZW4uIE11c3Qgc2hvdyB0b3RhbC5cbiAgICAgICAgICBmbGF0S2V5KGtleSkgaW4gY29sbGFwc2VkIHx8XG4gICAgICAgICAgLy8gRG9uJ3QgaGlkZSB0b3RhbHMuXG4gICAgICAgICAgIXN1YnRvdGFsRGlzcGxheS5oaWRlT25FeHBhbmQpLFxuICAgICk7XG4gIH1cblxuICBpc0Rhc2hib2FyZEVkaXRNb2RlKCkge1xuICAgIHJldHVybiBkb2N1bWVudC5jb250YWlucyhkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZGFzaGJvYXJkLS1lZGl0aW5nJykpO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGlmICh0aGlzLmNhY2hlZFByb3BzICE9PSB0aGlzLnByb3BzKSB7XG4gICAgICB0aGlzLmNhY2hlZFByb3BzID0gdGhpcy5wcm9wcztcbiAgICAgIHRoaXMuY2FjaGVkQmFzZVBpdm90U2V0dGluZ3MgPSB0aGlzLmdldEJhc2VQaXZvdFNldHRpbmdzKCk7XG4gICAgfVxuICAgIGNvbnN0IHtcbiAgICAgIGNvbEF0dHJzLFxuICAgICAgcm93QXR0cnMsXG4gICAgICByb3dLZXlzLFxuICAgICAgY29sS2V5cyxcbiAgICAgIGNvbFRvdGFscyxcbiAgICAgIHJvd1N1YnRvdGFsRGlzcGxheSxcbiAgICAgIGNvbFN1YnRvdGFsRGlzcGxheSxcbiAgICAgIGFsbG93UmVuZGVySHRtbCxcbiAgICB9ID0gdGhpcy5jYWNoZWRCYXNlUGl2b3RTZXR0aW5ncztcblxuICAgIC8vIE5lZWQgdG8gYWNjb3VudCBmb3IgZXhjbHVzaW9ucyB0byBjb21wdXRlIHRoZSBlZmZlY3RpdmUgcm93XG4gICAgLy8gYW5kIGNvbHVtbiBrZXlzLlxuICAgIGNvbnN0IHZpc2libGVSb3dLZXlzID0gdGhpcy52aXNpYmxlS2V5cyhcbiAgICAgIHJvd0tleXMsXG4gICAgICB0aGlzLnN0YXRlLmNvbGxhcHNlZFJvd3MsXG4gICAgICByb3dBdHRycy5sZW5ndGgsXG4gICAgICByb3dTdWJ0b3RhbERpc3BsYXksXG4gICAgKTtcbiAgICBjb25zdCB2aXNpYmxlQ29sS2V5cyA9IHRoaXMudmlzaWJsZUtleXMoXG4gICAgICBjb2xLZXlzLFxuICAgICAgdGhpcy5zdGF0ZS5jb2xsYXBzZWRDb2xzLFxuICAgICAgY29sQXR0cnMubGVuZ3RoLFxuICAgICAgY29sU3VidG90YWxEaXNwbGF5LFxuICAgICk7XG5cbiAgICBjb25zdCBwaXZvdFNldHRpbmdzID0ge1xuICAgICAgdmlzaWJsZVJvd0tleXMsXG4gICAgICBtYXhSb3dWaXNpYmxlOiBNYXRoLm1heCguLi52aXNpYmxlUm93S2V5cy5tYXAoayA9PiBrLmxlbmd0aCkpLFxuICAgICAgdmlzaWJsZUNvbEtleXMsXG4gICAgICBtYXhDb2xWaXNpYmxlOiBNYXRoLm1heCguLi52aXNpYmxlQ29sS2V5cy5tYXAoayA9PiBrLmxlbmd0aCkpLFxuICAgICAgcm93QXR0clNwYW5zOiB0aGlzLmNhbGNBdHRyU3BhbnModmlzaWJsZVJvd0tleXMsIHJvd0F0dHJzLmxlbmd0aCksXG4gICAgICBjb2xBdHRyU3BhbnM6IHRoaXMuY2FsY0F0dHJTcGFucyh2aXNpYmxlQ29sS2V5cywgY29sQXR0cnMubGVuZ3RoKSxcbiAgICAgIGFsbG93UmVuZGVySHRtbCxcbiAgICAgIC4uLnRoaXMuY2FjaGVkQmFzZVBpdm90U2V0dGluZ3MsXG4gICAgfTtcblxuICAgIHJldHVybiAoXG4gICAgICA8U3R5bGVzIGlzRGFzaGJvYXJkRWRpdE1vZGU9e3RoaXMuaXNEYXNoYm9hcmRFZGl0TW9kZSgpfT5cbiAgICAgICAgPHRhYmxlIGNsYXNzTmFtZT1cInB2dFRhYmxlXCIgcm9sZT1cImdyaWRcIj5cbiAgICAgICAgICA8dGhlYWQ+XG4gICAgICAgICAgICB7Y29sQXR0cnMubWFwKChjLCBqKSA9PlxuICAgICAgICAgICAgICB0aGlzLnJlbmRlckNvbEhlYWRlclJvdyhjLCBqLCBwaXZvdFNldHRpbmdzKSxcbiAgICAgICAgICAgICl9XG4gICAgICAgICAgICB7cm93QXR0cnMubGVuZ3RoICE9PSAwICYmIHRoaXMucmVuZGVyUm93SGVhZGVyUm93KHBpdm90U2V0dGluZ3MpfVxuICAgICAgICAgIDwvdGhlYWQ+XG4gICAgICAgICAgPHRib2R5PlxuICAgICAgICAgICAge3Zpc2libGVSb3dLZXlzLm1hcCgociwgaSkgPT5cbiAgICAgICAgICAgICAgdGhpcy5yZW5kZXJUYWJsZVJvdyhyLCBpLCBwaXZvdFNldHRpbmdzKSxcbiAgICAgICAgICAgICl9XG4gICAgICAgICAgICB7Y29sVG90YWxzICYmIHRoaXMucmVuZGVyVG90YWxzUm93KHBpdm90U2V0dGluZ3MpfVxuICAgICAgICAgIDwvdGJvZHk+XG4gICAgICAgIDwvdGFibGU+XG4gICAgICA8L1N0eWxlcz5cbiAgICApO1xuICB9XG59XG5cblRhYmxlUmVuZGVyZXIucHJvcFR5cGVzID0ge1xuICAuLi5QaXZvdERhdGEucHJvcFR5cGVzLFxuICB0YWJsZU9wdGlvbnM6IFByb3BUeXBlcy5vYmplY3QsXG4gIG9uQ29udGV4dE1lbnU6IFByb3BUeXBlcy5mdW5jLFxufTtcblRhYmxlUmVuZGVyZXIuZGVmYXVsdFByb3BzID0geyAuLi5QaXZvdERhdGEuZGVmYXVsdFByb3BzLCB0YWJsZU9wdGlvbnM6IHt9IH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx\n\n}");

/***/ }),

/***/ "./plugins/plugin-chart-pivot-table/src/react-pivottable/utilities.js":
/*!****************************************************************************!*\
  !*** ./plugins/plugin-chart-pivot-table/src/react-pivottable/utilities.js ***!
  \****************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("{/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PivotData: () => (/* binding */ PivotData),\n/* harmony export */   aggregatorTemplates: () => (/* binding */ aggregatorTemplates),\n/* harmony export */   flatKey: () => (/* binding */ flatKey),\n/* harmony export */   sortAs: () => (/* binding */ sortAs)\n/* harmony export */ });\n/* unused harmony exports aggregators, derivers, locales, naturalSort, numberFormat, getSort */\n/* harmony import */ var prop_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! prop-types */ \"./node_modules/prop-types/index.js\");\n/* harmony import */ var prop_types__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _superset_ui_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @superset-ui/core */ \"./packages/superset-ui-core/src/translation/TranslatorSingleton.ts\");\n/* provided dependency */ var __react_refresh_utils__ = __webpack_require__(/*! ./node_modules/@pmmmwh/react-refresh-webpack-plugin/lib/runtime/RefreshUtils.js */ \"./node_modules/@pmmmwh/react-refresh-webpack-plugin/lib/runtime/RefreshUtils.js\");\n/* provided dependency */ var __react_refresh_error_overlay__ = __webpack_require__(/*! ./node_modules/@pmmmwh/react-refresh-webpack-plugin/overlay/index.js */ \"./node_modules/@pmmmwh/react-refresh-webpack-plugin/overlay/index.js\");\n__webpack_require__.$Refresh$.runtime = __webpack_require__(/*! ./node_modules/react-refresh/runtime.js */ \"./node_modules/react-refresh/runtime.js\");\n\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */ function _extends() {\n    _extends = Object.assign || function(target) {\n        for(var i = 1; i < arguments.length; i++){\n            var source = arguments[i];\n            for(var key in source){\n                if (Object.prototype.hasOwnProperty.call(source, key)) {\n                    target[key] = source[key];\n                }\n            }\n        }\n        return target;\n    };\n    return _extends.apply(this, arguments);\n}\n\n\nconst addSeparators = function(nStr, thousandsSep, decimalSep) {\n    const x = String(nStr).split('.');\n    let x1 = x[0];\n    const x2 = x.length > 1 ? decimalSep + x[1] : '';\n    const rgx = /(\\d+)(\\d{3})/;\n    while(rgx.test(x1)){\n        x1 = x1.replace(rgx, `$1${thousandsSep}$2`);\n    }\n    return x1 + x2;\n};\nconst numberFormat = function(optsIn) {\n    const defaults = {\n        digitsAfterDecimal: 2,\n        scaler: 1,\n        thousandsSep: ',',\n        decimalSep: '.',\n        prefix: '',\n        suffix: ''\n    };\n    const opts = _extends({}, defaults, optsIn);\n    return function(x) {\n        if (Number.isNaN(x) || !Number.isFinite(x)) {\n            return '';\n        }\n        const result = addSeparators((opts.scaler * x).toFixed(opts.digitsAfterDecimal), opts.thousandsSep, opts.decimalSep);\n        return `${opts.prefix}${result}${opts.suffix}`;\n    };\n};\nconst rx = /(\\d+)|(\\D+)/g;\nconst rd = /\\d/;\nconst rz = /^0/;\nconst naturalSort = (as, bs)=>{\n    // nulls first\n    if (bs !== null && as === null) {\n        return -1;\n    }\n    if (as !== null && bs === null) {\n        return 1;\n    }\n    // then raw NaNs\n    if (typeof as === 'number' && Number.isNaN(as)) {\n        return -1;\n    }\n    if (typeof bs === 'number' && Number.isNaN(bs)) {\n        return 1;\n    }\n    // numbers and numbery strings group together\n    const nas = Number(as);\n    const nbs = Number(bs);\n    if (nas < nbs) {\n        return -1;\n    }\n    if (nas > nbs) {\n        return 1;\n    }\n    // within that, true numbers before numbery strings\n    if (typeof as === 'number' && typeof bs !== 'number') {\n        return -1;\n    }\n    if (typeof bs === 'number' && typeof as !== 'number') {\n        return 1;\n    }\n    if (typeof as === 'number' && typeof bs === 'number') {\n        return 0;\n    }\n    // 'Infinity' is a textual number, so less than 'A'\n    if (Number.isNaN(nbs) && !Number.isNaN(nas)) {\n        return -1;\n    }\n    if (Number.isNaN(nas) && !Number.isNaN(nbs)) {\n        return 1;\n    }\n    // finally, \"smart\" string sorting per http://stackoverflow.com/a/4373421/112871\n    let a = String(as);\n    let b = String(bs);\n    if (a === b) {\n        return 0;\n    }\n    if (!rd.test(a) || !rd.test(b)) {\n        return a > b ? 1 : -1;\n    }\n    // special treatment for strings containing digits\n    a = a.match(rx);\n    b = b.match(rx);\n    while(a.length && b.length){\n        const a1 = a.shift();\n        const b1 = b.shift();\n        if (a1 !== b1) {\n            if (rd.test(a1) && rd.test(b1)) {\n                return a1.replace(rz, '.0') - b1.replace(rz, '.0');\n            }\n            return a1 > b1 ? 1 : -1;\n        }\n    }\n    return a.length - b.length;\n};\nconst sortAs = function(order) {\n    const mapping = {};\n    // sort lowercased keys similarly\n    const lMapping = {};\n    order.forEach((element, i)=>{\n        mapping[element] = i;\n        if (typeof element === 'string') {\n            lMapping[element.toLowerCase()] = i;\n        }\n    });\n    return function(a, b) {\n        if (a in mapping && b in mapping) {\n            return mapping[a] - mapping[b];\n        }\n        if (a in mapping) {\n            return -1;\n        }\n        if (b in mapping) {\n            return 1;\n        }\n        if (a in lMapping && b in lMapping) {\n            return lMapping[a] - lMapping[b];\n        }\n        if (a in lMapping) {\n            return -1;\n        }\n        if (b in lMapping) {\n            return 1;\n        }\n        return naturalSort(a, b);\n    };\n};\nconst getSort = function(sorters, attr) {\n    if (sorters) {\n        if (typeof sorters === 'function') {\n            const sort = sorters(attr);\n            if (typeof sort === 'function') {\n                return sort;\n            }\n        } else if (attr in sorters) {\n            return sorters[attr];\n        }\n    }\n    return naturalSort;\n};\n// aggregator templates default to US number formatting but this is overridable\nconst usFmt = numberFormat();\nconst usFmtInt = numberFormat({\n    digitsAfterDecimal: 0\n});\nconst usFmtPct = numberFormat({\n    digitsAfterDecimal: 1,\n    scaler: 100,\n    suffix: '%'\n});\nconst fmtNonString = (formatter)=>(x)=>typeof x === 'string' ? x : formatter(x);\nconst baseAggregatorTemplates = {\n    count (formatter = usFmtInt) {\n        return ()=>function() {\n                return {\n                    count: 0,\n                    push () {\n                        this.count += 1;\n                    },\n                    value () {\n                        return this.count;\n                    },\n                    format: formatter\n                };\n            };\n    },\n    uniques (fn, formatter = usFmtInt) {\n        return function([attr]) {\n            return function() {\n                return {\n                    uniq: [],\n                    push (record) {\n                        if (!Array.from(this.uniq).includes(record[attr])) {\n                            this.uniq.push(record[attr]);\n                        }\n                    },\n                    value () {\n                        return fn(this.uniq);\n                    },\n                    format: fmtNonString(formatter),\n                    numInputs: typeof attr !== 'undefined' ? 0 : 1\n                };\n            };\n        };\n    },\n    sum (formatter = usFmt) {\n        return function([attr]) {\n            return function() {\n                return {\n                    sum: 0,\n                    push (record) {\n                        if (Number.isNaN(Number(record[attr]))) {\n                            this.sum = record[attr];\n                        } else {\n                            this.sum += parseFloat(record[attr]);\n                        }\n                    },\n                    value () {\n                        return this.sum;\n                    },\n                    format: fmtNonString(formatter),\n                    numInputs: typeof attr !== 'undefined' ? 0 : 1\n                };\n            };\n        };\n    },\n    extremes (mode, formatter = usFmt) {\n        return function([attr]) {\n            return function(data) {\n                return {\n                    val: null,\n                    sorter: getSort(typeof data !== 'undefined' ? data.sorters : null, attr),\n                    push (record) {\n                        const x = record[attr];\n                        if ([\n                            'min',\n                            'max'\n                        ].includes(mode)) {\n                            const coercedValue = Number(x);\n                            if (Number.isNaN(coercedValue)) {\n                                this.val = !this.val || mode === 'min' && x < this.val || mode === 'max' && x > this.val ? x : this.val;\n                            } else {\n                                this.val = Math[mode](coercedValue, this.val !== null ? this.val : coercedValue);\n                            }\n                        } else if (mode === 'first' && this.sorter(x, this.val !== null ? this.val : x) <= 0) {\n                            this.val = x;\n                        } else if (mode === 'last' && this.sorter(x, this.val !== null ? this.val : x) >= 0) {\n                            this.val = x;\n                        }\n                    },\n                    value () {\n                        return this.val;\n                    },\n                    format (x) {\n                        if (typeof x === 'number') {\n                            return formatter(x);\n                        }\n                        return x;\n                    },\n                    numInputs: typeof attr !== 'undefined' ? 0 : 1\n                };\n            };\n        };\n    },\n    quantile (q, formatter = usFmt) {\n        return function([attr]) {\n            return function() {\n                return {\n                    vals: [],\n                    strMap: {},\n                    push (record) {\n                        const val = record[attr];\n                        const x = Number(val);\n                        if (Number.isNaN(x)) {\n                            this.strMap[val] = (this.strMap[val] || 0) + 1;\n                        } else {\n                            this.vals.push(x);\n                        }\n                    },\n                    value () {\n                        if (this.vals.length === 0 && Object.keys(this.strMap).length === 0) {\n                            return null;\n                        }\n                        if (Object.keys(this.strMap).length) {\n                            const values = Object.values(this.strMap).sort((a, b)=>a - b);\n                            const middle = Math.floor(values.length / 2);\n                            const keys = Object.keys(this.strMap);\n                            return keys.length % 2 !== 0 ? keys[middle] : (keys[middle - 1] + keys[middle]) / 2;\n                        }\n                        this.vals.sort((a, b)=>a - b);\n                        const i = (this.vals.length - 1) * q;\n                        return (this.vals[Math.floor(i)] + this.vals[Math.ceil(i)]) / 2.0;\n                    },\n                    format: fmtNonString(formatter),\n                    numInputs: typeof attr !== 'undefined' ? 0 : 1\n                };\n            };\n        };\n    },\n    runningStat (mode = 'mean', ddof = 1, formatter = usFmt) {\n        return function([attr]) {\n            return function() {\n                return {\n                    n: 0.0,\n                    m: 0.0,\n                    s: 0.0,\n                    strValue: null,\n                    push (record) {\n                        const x = Number(record[attr]);\n                        if (Number.isNaN(x)) {\n                            this.strValue = typeof record[attr] === 'string' ? record[attr] : this.strValue;\n                            return;\n                        }\n                        this.n += 1.0;\n                        if (this.n === 1.0) {\n                            this.m = x;\n                        }\n                        const mNew = this.m + (x - this.m) / this.n;\n                        this.s += (x - this.m) * (x - mNew);\n                        this.m = mNew;\n                    },\n                    value () {\n                        if (this.strValue) {\n                            return this.strValue;\n                        }\n                        if (mode === 'mean') {\n                            if (this.n === 0) {\n                                return 0 / 0;\n                            }\n                            return this.m;\n                        }\n                        if (this.n <= ddof) {\n                            return 0;\n                        }\n                        switch(mode){\n                            case 'var':\n                                return this.s / (this.n - ddof);\n                            case 'stdev':\n                                return Math.sqrt(this.s / (this.n - ddof));\n                            default:\n                                throw new Error('unknown mode for runningStat');\n                        }\n                    },\n                    format: fmtNonString(formatter),\n                    numInputs: typeof attr !== 'undefined' ? 0 : 1\n                };\n            };\n        };\n    },\n    sumOverSum (formatter = usFmt) {\n        return function([num, denom]) {\n            return function() {\n                return {\n                    sumNum: 0,\n                    sumDenom: 0,\n                    push (record) {\n                        if (!Number.isNaN(Number(record[num]))) {\n                            this.sumNum += parseFloat(record[num]);\n                        }\n                        if (!Number.isNaN(Number(record[denom]))) {\n                            this.sumDenom += parseFloat(record[denom]);\n                        }\n                    },\n                    value () {\n                        return this.sumNum / this.sumDenom;\n                    },\n                    format: formatter,\n                    numInputs: typeof num !== 'undefined' && typeof denom !== 'undefined' ? 0 : 2\n                };\n            };\n        };\n    },\n    fractionOf (wrapped, type = 'total', formatter = usFmtPct) {\n        return (...x)=>function(data, rowKey, colKey) {\n                return {\n                    selector: ({\n                        total: [\n                            [],\n                            []\n                        ],\n                        row: [\n                            rowKey,\n                            []\n                        ],\n                        col: [\n                            [],\n                            colKey\n                        ]\n                    })[type],\n                    inner: wrapped(...Array.from(x || []))(data, rowKey, colKey),\n                    push (record) {\n                        this.inner.push(record);\n                    },\n                    format: fmtNonString(formatter),\n                    value () {\n                        const acc = data.getAggregator(...Array.from(this.selector || [])).inner.value();\n                        if (typeof acc === 'string') {\n                            return acc;\n                        }\n                        return this.inner.value() / acc;\n                    },\n                    numInputs: wrapped(...Array.from(x || []))().numInputs\n                };\n            };\n    }\n};\nconst extendedAggregatorTemplates = {\n    countUnique (f) {\n        return baseAggregatorTemplates.uniques((x)=>x.length, f);\n    },\n    listUnique (s, f) {\n        return baseAggregatorTemplates.uniques((x)=>x.join(s), f || ((x)=>x));\n    },\n    max (f) {\n        return baseAggregatorTemplates.extremes('max', f);\n    },\n    min (f) {\n        return baseAggregatorTemplates.extremes('min', f);\n    },\n    first (f) {\n        return baseAggregatorTemplates.extremes('first', f);\n    },\n    last (f) {\n        return baseAggregatorTemplates.extremes('last', f);\n    },\n    median (f) {\n        return baseAggregatorTemplates.quantile(0.5, f);\n    },\n    average (f) {\n        return baseAggregatorTemplates.runningStat('mean', 1, f);\n    },\n    var (ddof, f) {\n        return baseAggregatorTemplates.runningStat('var', ddof, f);\n    },\n    stdev (ddof, f) {\n        return baseAggregatorTemplates.runningStat('stdev', ddof, f);\n    }\n};\nconst aggregatorTemplates = _extends({}, baseAggregatorTemplates, extendedAggregatorTemplates);\n// default aggregators & renderers use US naming and number formatting\nconst aggregators = ((tpl)=>({\n        Count: tpl.count(usFmtInt),\n        'Count Unique Values': tpl.countUnique(usFmtInt),\n        'List Unique Values': tpl.listUnique(', '),\n        Sum: tpl.sum(usFmt),\n        'Integer Sum': tpl.sum(usFmtInt),\n        Average: tpl.average(usFmt),\n        Median: tpl.median(usFmt),\n        'Sample Variance': tpl.var(1, usFmt),\n        'Sample Standard Deviation': tpl.stdev(1, usFmt),\n        Minimum: tpl.min(usFmt),\n        Maximum: tpl.max(usFmt),\n        First: tpl.first(usFmt),\n        Last: tpl.last(usFmt),\n        'Sum over Sum': tpl.sumOverSum(usFmt),\n        'Sum as Fraction of Total': tpl.fractionOf(tpl.sum(), 'total', usFmtPct),\n        'Sum as Fraction of Rows': tpl.fractionOf(tpl.sum(), 'row', usFmtPct),\n        'Sum as Fraction of Columns': tpl.fractionOf(tpl.sum(), 'col', usFmtPct),\n        'Count as Fraction of Total': tpl.fractionOf(tpl.count(), 'total', usFmtPct),\n        'Count as Fraction of Rows': tpl.fractionOf(tpl.count(), 'row', usFmtPct),\n        'Count as Fraction of Columns': tpl.fractionOf(tpl.count(), 'col', usFmtPct)\n    }))(aggregatorTemplates);\nconst locales = {\n    en: {\n        aggregators,\n        localeStrings: {\n            renderError: 'An error occurred rendering the PivotTable results.',\n            computeError: 'An error occurred computing the PivotTable results.',\n            uiRenderError: 'An error occurred rendering the PivotTable UI.',\n            selectAll: 'Select All',\n            selectNone: 'Select None',\n            tooMany: '(too many to list)',\n            filterResults: 'Filter values',\n            apply: 'Apply',\n            cancel: 'Cancel',\n            totals: 'Totals',\n            vs: 'vs',\n            by: 'by'\n        }\n    }\n};\n// dateFormat deriver l10n requires month and day names to be passed in directly\nconst mthNamesEn = [\n    'Jan',\n    'Feb',\n    'Mar',\n    'Apr',\n    'May',\n    'Jun',\n    'Jul',\n    'Aug',\n    'Sep',\n    'Oct',\n    'Nov',\n    'Dec'\n];\nconst dayNamesEn = [\n    'Sun',\n    'Mon',\n    'Tue',\n    'Wed',\n    'Thu',\n    'Fri',\n    'Sat'\n];\nconst zeroPad = (number)=>`0${number}`.substr(-2, 2); // eslint-disable-line no-magic-numbers\nconst derivers = {\n    bin (col, binWidth) {\n        return (record)=>record[col] - record[col] % binWidth;\n    },\n    dateFormat (col, formatString, utcOutput = false, mthNames = mthNamesEn, dayNames = dayNamesEn) {\n        const utc = utcOutput ? 'UTC' : '';\n        return function(record) {\n            const date = new Date(Date.parse(record[col]));\n            if (Number.isNaN(date)) {\n                return '';\n            }\n            return formatString.replace(/%(.)/g, function(m, p) {\n                switch(p){\n                    case 'y':\n                        return date[`get${utc}FullYear`]();\n                    case 'm':\n                        return zeroPad(date[`get${utc}Month`]() + 1);\n                    case 'n':\n                        return mthNames[date[`get${utc}Month`]()];\n                    case 'd':\n                        return zeroPad(date[`get${utc}Date`]());\n                    case 'w':\n                        return dayNames[date[`get${utc}Day`]()];\n                    case 'x':\n                        return date[`get${utc}Day`]();\n                    case 'H':\n                        return zeroPad(date[`get${utc}Hours`]());\n                    case 'M':\n                        return zeroPad(date[`get${utc}Minutes`]());\n                    case 'S':\n                        return zeroPad(date[`get${utc}Seconds`]());\n                    default:\n                        return `%${p}`;\n                }\n            });\n        };\n    }\n};\n// Given an array of attribute values, convert to a key that\n// can be used in objects.\nconst flatKey = (attrVals)=>attrVals.join(String.fromCharCode(0));\n/*\nData Model class\n*/ class PivotData {\n    getFormattedAggregator(record, totalsKeys) {\n        if (!this.formattedAggregators) {\n            return this.aggregator;\n        }\n        const [groupName, groupValue] = Object.entries(record).find(([name, value])=>this.formattedAggregators[name] && this.formattedAggregators[name][value]) || [];\n        if (!groupName || !groupValue || totalsKeys && !totalsKeys.includes(groupValue)) {\n            return this.aggregator;\n        }\n        return this.formattedAggregators[groupName][groupValue] || this.aggregator;\n    }\n    arrSort(attrs, partialOnTop, reverse = false) {\n        const sortersArr = attrs.map((a)=>getSort(this.props.sorters, a));\n        return function(a, b) {\n            const limit = Math.min(a.length, b.length);\n            for(let i = 0; i < limit; i += 1){\n                const sorter = sortersArr[i];\n                const comparison = reverse ? sorter(b[i], a[i]) : sorter(a[i], b[i]);\n                if (comparison !== 0) {\n                    return comparison;\n                }\n            }\n            return partialOnTop ? a.length - b.length : b.length - a.length;\n        };\n    }\n    sortKeys() {\n        if (!this.sorted) {\n            this.sorted = true;\n            const v = (r, c)=>this.getAggregator(r, c).value();\n            switch(this.props.rowOrder){\n                case 'key_z_to_a':\n                    this.rowKeys.sort(this.arrSort(this.props.rows, this.subtotals.rowPartialOnTop, true));\n                    break;\n                case 'value_a_to_z':\n                    this.rowKeys.sort((a, b)=>naturalSort(v(a, []), v(b, [])));\n                    break;\n                case 'value_z_to_a':\n                    this.rowKeys.sort((a, b)=>-naturalSort(v(a, []), v(b, [])));\n                    break;\n                default:\n                    this.rowKeys.sort(this.arrSort(this.props.rows, this.subtotals.rowPartialOnTop));\n            }\n            switch(this.props.colOrder){\n                case 'key_z_to_a':\n                    this.colKeys.sort(this.arrSort(this.props.cols, this.subtotals.colPartialOnTop, true));\n                    break;\n                case 'value_a_to_z':\n                    this.colKeys.sort((a, b)=>naturalSort(v([], a), v([], b)));\n                    break;\n                case 'value_z_to_a':\n                    this.colKeys.sort((a, b)=>-naturalSort(v([], a), v([], b)));\n                    break;\n                default:\n                    this.colKeys.sort(this.arrSort(this.props.cols, this.subtotals.colPartialOnTop));\n            }\n        }\n    }\n    getColKeys() {\n        this.sortKeys();\n        return this.colKeys;\n    }\n    getRowKeys() {\n        this.sortKeys();\n        return this.rowKeys;\n    }\n    processRecord(record) {\n        // this code is called in a tight loop\n        const colKey = [];\n        const rowKey = [];\n        this.props.cols.forEach((col)=>{\n            colKey.push(col in record ? record[col] : 'null');\n        });\n        this.props.rows.forEach((row)=>{\n            rowKey.push(row in record ? record[row] : 'null');\n        });\n        this.allTotal.push(record);\n        const rowStart = this.subtotals.rowEnabled ? 1 : Math.max(1, rowKey.length);\n        const colStart = this.subtotals.colEnabled ? 1 : Math.max(1, colKey.length);\n        let isRowSubtotal;\n        let isColSubtotal;\n        for(let ri = rowStart; ri <= rowKey.length; ri += 1){\n            isRowSubtotal = ri < rowKey.length;\n            const fRowKey = rowKey.slice(0, ri);\n            const flatRowKey = flatKey(fRowKey);\n            if (!this.rowTotals[flatRowKey]) {\n                this.rowKeys.push(fRowKey);\n                this.rowTotals[flatRowKey] = this.getFormattedAggregator(record, rowKey)(this, fRowKey, []);\n            }\n            this.rowTotals[flatRowKey].push(record);\n            this.rowTotals[flatRowKey].isSubtotal = isRowSubtotal;\n        }\n        for(let ci = colStart; ci <= colKey.length; ci += 1){\n            isColSubtotal = ci < colKey.length;\n            const fColKey = colKey.slice(0, ci);\n            const flatColKey = flatKey(fColKey);\n            if (!this.colTotals[flatColKey]) {\n                this.colKeys.push(fColKey);\n                this.colTotals[flatColKey] = this.getFormattedAggregator(record, colKey)(this, [], fColKey);\n            }\n            this.colTotals[flatColKey].push(record);\n            this.colTotals[flatColKey].isSubtotal = isColSubtotal;\n        }\n        // And now fill in for all the sub-cells.\n        for(let ri = rowStart; ri <= rowKey.length; ri += 1){\n            isRowSubtotal = ri < rowKey.length;\n            const fRowKey = rowKey.slice(0, ri);\n            const flatRowKey = flatKey(fRowKey);\n            if (!this.tree[flatRowKey]) {\n                this.tree[flatRowKey] = {};\n            }\n            for(let ci = colStart; ci <= colKey.length; ci += 1){\n                isColSubtotal = ci < colKey.length;\n                const fColKey = colKey.slice(0, ci);\n                const flatColKey = flatKey(fColKey);\n                if (!this.tree[flatRowKey][flatColKey]) {\n                    this.tree[flatRowKey][flatColKey] = this.getFormattedAggregator(record)(this, fRowKey, fColKey);\n                }\n                this.tree[flatRowKey][flatColKey].push(record);\n                this.tree[flatRowKey][flatColKey].isRowSubtotal = isRowSubtotal;\n                this.tree[flatRowKey][flatColKey].isColSubtotal = isColSubtotal;\n                this.tree[flatRowKey][flatColKey].isSubtotal = isRowSubtotal || isColSubtotal;\n            }\n        }\n    }\n    getAggregator(rowKey, colKey) {\n        let agg;\n        const flatRowKey = flatKey(rowKey);\n        const flatColKey = flatKey(colKey);\n        if (rowKey.length === 0 && colKey.length === 0) {\n            agg = this.allTotal;\n        } else if (rowKey.length === 0) {\n            agg = this.colTotals[flatColKey];\n        } else if (colKey.length === 0) {\n            agg = this.rowTotals[flatRowKey];\n        } else {\n            agg = this.tree[flatRowKey][flatColKey];\n        }\n        return agg || {\n            value () {\n                return null;\n            },\n            format () {\n                return '';\n            }\n        };\n    }\n    constructor(inputProps = {}, subtotals = {}){\n        this.props = _extends({}, PivotData.defaultProps, inputProps);\n        this.processRecord = this.processRecord.bind(this);\n        prop_types__WEBPACK_IMPORTED_MODULE_0___default().checkPropTypes(PivotData.propTypes, this.props, 'prop', 'PivotData');\n        this.aggregator = this.props.aggregatorsFactory(this.props.defaultFormatter)[this.props.aggregatorName](this.props.vals);\n        this.formattedAggregators = this.props.customFormatters && Object.entries(this.props.customFormatters).reduce((acc, [key, columnFormatter])=>{\n            acc[key] = {};\n            Object.entries(columnFormatter).forEach(([column, formatter])=>{\n                acc[key][column] = this.props.aggregatorsFactory(formatter)[this.props.aggregatorName](this.props.vals);\n            });\n            return acc;\n        }, {});\n        this.tree = {};\n        this.rowKeys = [];\n        this.colKeys = [];\n        this.rowTotals = {};\n        this.colTotals = {};\n        this.allTotal = this.aggregator(this, [], []);\n        this.subtotals = subtotals;\n        this.sorted = false;\n        // iterate through input, accumulating data for cells\n        PivotData.forEachRecord(this.props.data, this.processRecord);\n    }\n}\n// can handle arrays or jQuery selections of tables\nPivotData.forEachRecord = function(input, processRecord) {\n    if (Array.isArray(input)) {\n        // array of objects\n        return input.map((record)=>processRecord(record));\n    }\n    throw new Error((0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_1__.t)('Unknown input format'));\n};\nPivotData.defaultProps = {\n    aggregators,\n    cols: [],\n    rows: [],\n    vals: [],\n    aggregatorName: 'Count',\n    sorters: {},\n    rowOrder: 'key_a_to_z',\n    colOrder: 'key_a_to_z'\n};\nPivotData.propTypes = {\n    data: prop_types__WEBPACK_IMPORTED_MODULE_0___default().oneOfType([\n        (prop_types__WEBPACK_IMPORTED_MODULE_0___default().array),\n        (prop_types__WEBPACK_IMPORTED_MODULE_0___default().object),\n        (prop_types__WEBPACK_IMPORTED_MODULE_0___default().func)\n    ]).isRequired,\n    aggregatorName: (prop_types__WEBPACK_IMPORTED_MODULE_0___default().string),\n    cols: prop_types__WEBPACK_IMPORTED_MODULE_0___default().arrayOf((prop_types__WEBPACK_IMPORTED_MODULE_0___default().string)),\n    rows: prop_types__WEBPACK_IMPORTED_MODULE_0___default().arrayOf((prop_types__WEBPACK_IMPORTED_MODULE_0___default().string)),\n    vals: prop_types__WEBPACK_IMPORTED_MODULE_0___default().arrayOf((prop_types__WEBPACK_IMPORTED_MODULE_0___default().string)),\n    valueFilter: prop_types__WEBPACK_IMPORTED_MODULE_0___default().objectOf(prop_types__WEBPACK_IMPORTED_MODULE_0___default().objectOf((prop_types__WEBPACK_IMPORTED_MODULE_0___default().bool))),\n    sorters: prop_types__WEBPACK_IMPORTED_MODULE_0___default().oneOfType([\n        (prop_types__WEBPACK_IMPORTED_MODULE_0___default().func),\n        prop_types__WEBPACK_IMPORTED_MODULE_0___default().objectOf((prop_types__WEBPACK_IMPORTED_MODULE_0___default().func))\n    ]),\n    derivedAttributes: prop_types__WEBPACK_IMPORTED_MODULE_0___default().objectOf((prop_types__WEBPACK_IMPORTED_MODULE_0___default().func)),\n    rowOrder: prop_types__WEBPACK_IMPORTED_MODULE_0___default().oneOf([\n        'key_a_to_z',\n        'key_z_to_a',\n        'value_a_to_z',\n        'value_z_to_a'\n    ]),\n    colOrder: prop_types__WEBPACK_IMPORTED_MODULE_0___default().oneOf([\n        'key_a_to_z',\n        'key_z_to_a',\n        'value_a_to_z',\n        'value_z_to_a'\n    ])\n};\n\n\n\nconst $ReactRefreshModuleId$ = __webpack_require__.$Refresh$.moduleId;\nconst $ReactRefreshCurrentExports$ = __react_refresh_utils__.getModuleExports(\n\t$ReactRefreshModuleId$\n);\n\nfunction $ReactRefreshModuleRuntime$(exports) {\n\tif (true) {\n\t\tlet errorOverlay;\n\t\tif (typeof __react_refresh_error_overlay__ !== 'undefined') {\n\t\t\terrorOverlay = __react_refresh_error_overlay__;\n\t\t}\n\t\tlet testMode;\n\t\tif (typeof __react_refresh_test__ !== 'undefined') {\n\t\t\ttestMode = __react_refresh_test__;\n\t\t}\n\t\treturn __react_refresh_utils__.executeRuntime(\n\t\t\texports,\n\t\t\t$ReactRefreshModuleId$,\n\t\t\tmodule.hot,\n\t\t\terrorOverlay,\n\t\t\ttestMode\n\t\t);\n\t}\n}\n\nif (typeof Promise !== 'undefined' && $ReactRefreshCurrentExports$ instanceof Promise) {\n\t$ReactRefreshCurrentExports$.then($ReactRefreshModuleRuntime$);\n} else {\n\t$ReactRefreshModuleRuntime$($ReactRefreshCurrentExports$);\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wbHVnaW5zL3BsdWdpbi1jaGFydC1waXZvdC10YWJsZS9zcmMvcmVhY3QtcGl2b3R0YWJsZS91dGlsaXRpZXMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQkE7Ozs7Ozs7Ozs7Ozs7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQU1BO0FBQ0E7QUFJQTtBQUNBO0FBSUE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFHQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBOztBQUVBO0FBMkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFNQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBaE9BO0FBQ0E7QUFDQTtBQUNBO0FBT0E7QUFHQTtBQUlBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUEyTEE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUEiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zdXBlcnNldC8uL3BsdWdpbnMvcGx1Z2luLWNoYXJ0LXBpdm90LXRhYmxlL3NyYy9yZWFjdC1waXZvdHRhYmxlL3V0aWxpdGllcy5qcz9iZjU4Il0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7IHQgfSBmcm9tICdAc3VwZXJzZXQtdWkvY29yZSc7XG5cbmNvbnN0IGFkZFNlcGFyYXRvcnMgPSBmdW5jdGlvbiAoblN0ciwgdGhvdXNhbmRzU2VwLCBkZWNpbWFsU2VwKSB7XG4gIGNvbnN0IHggPSBTdHJpbmcoblN0cikuc3BsaXQoJy4nKTtcbiAgbGV0IHgxID0geFswXTtcbiAgY29uc3QgeDIgPSB4Lmxlbmd0aCA+IDEgPyBkZWNpbWFsU2VwICsgeFsxXSA6ICcnO1xuICBjb25zdCByZ3ggPSAvKFxcZCspKFxcZHszfSkvO1xuICB3aGlsZSAocmd4LnRlc3QoeDEpKSB7XG4gICAgeDEgPSB4MS5yZXBsYWNlKHJneCwgYCQxJHt0aG91c2FuZHNTZXB9JDJgKTtcbiAgfVxuICByZXR1cm4geDEgKyB4Mjtcbn07XG5cbmNvbnN0IG51bWJlckZvcm1hdCA9IGZ1bmN0aW9uIChvcHRzSW4pIHtcbiAgY29uc3QgZGVmYXVsdHMgPSB7XG4gICAgZGlnaXRzQWZ0ZXJEZWNpbWFsOiAyLFxuICAgIHNjYWxlcjogMSxcbiAgICB0aG91c2FuZHNTZXA6ICcsJyxcbiAgICBkZWNpbWFsU2VwOiAnLicsXG4gICAgcHJlZml4OiAnJyxcbiAgICBzdWZmaXg6ICcnLFxuICB9O1xuICBjb25zdCBvcHRzID0geyAuLi5kZWZhdWx0cywgLi4ub3B0c0luIH07XG4gIHJldHVybiBmdW5jdGlvbiAoeCkge1xuICAgIGlmIChOdW1iZXIuaXNOYU4oeCkgfHwgIU51bWJlci5pc0Zpbml0ZSh4KSkge1xuICAgICAgcmV0dXJuICcnO1xuICAgIH1cbiAgICBjb25zdCByZXN1bHQgPSBhZGRTZXBhcmF0b3JzKFxuICAgICAgKG9wdHMuc2NhbGVyICogeCkudG9GaXhlZChvcHRzLmRpZ2l0c0FmdGVyRGVjaW1hbCksXG4gICAgICBvcHRzLnRob3VzYW5kc1NlcCxcbiAgICAgIG9wdHMuZGVjaW1hbFNlcCxcbiAgICApO1xuICAgIHJldHVybiBgJHtvcHRzLnByZWZpeH0ke3Jlc3VsdH0ke29wdHMuc3VmZml4fWA7XG4gIH07XG59O1xuXG5jb25zdCByeCA9IC8oXFxkKyl8KFxcRCspL2c7XG5jb25zdCByZCA9IC9cXGQvO1xuY29uc3QgcnogPSAvXjAvO1xuY29uc3QgbmF0dXJhbFNvcnQgPSAoYXMsIGJzKSA9PiB7XG4gIC8vIG51bGxzIGZpcnN0XG4gIGlmIChicyAhPT0gbnVsbCAmJiBhcyA9PT0gbnVsbCkge1xuICAgIHJldHVybiAtMTtcbiAgfVxuICBpZiAoYXMgIT09IG51bGwgJiYgYnMgPT09IG51bGwpIHtcbiAgICByZXR1cm4gMTtcbiAgfVxuXG4gIC8vIHRoZW4gcmF3IE5hTnNcbiAgaWYgKHR5cGVvZiBhcyA9PT0gJ251bWJlcicgJiYgTnVtYmVyLmlzTmFOKGFzKSkge1xuICAgIHJldHVybiAtMTtcbiAgfVxuICBpZiAodHlwZW9mIGJzID09PSAnbnVtYmVyJyAmJiBOdW1iZXIuaXNOYU4oYnMpKSB7XG4gICAgcmV0dXJuIDE7XG4gIH1cblxuICAvLyBudW1iZXJzIGFuZCBudW1iZXJ5IHN0cmluZ3MgZ3JvdXAgdG9nZXRoZXJcbiAgY29uc3QgbmFzID0gTnVtYmVyKGFzKTtcbiAgY29uc3QgbmJzID0gTnVtYmVyKGJzKTtcbiAgaWYgKG5hcyA8IG5icykge1xuICAgIHJldHVybiAtMTtcbiAgfVxuICBpZiAobmFzID4gbmJzKSB7XG4gICAgcmV0dXJuIDE7XG4gIH1cblxuICAvLyB3aXRoaW4gdGhhdCwgdHJ1ZSBudW1iZXJzIGJlZm9yZSBudW1iZXJ5IHN0cmluZ3NcbiAgaWYgKHR5cGVvZiBhcyA9PT0gJ251bWJlcicgJiYgdHlwZW9mIGJzICE9PSAnbnVtYmVyJykge1xuICAgIHJldHVybiAtMTtcbiAgfVxuICBpZiAodHlwZW9mIGJzID09PSAnbnVtYmVyJyAmJiB0eXBlb2YgYXMgIT09ICdudW1iZXInKSB7XG4gICAgcmV0dXJuIDE7XG4gIH1cbiAgaWYgKHR5cGVvZiBhcyA9PT0gJ251bWJlcicgJiYgdHlwZW9mIGJzID09PSAnbnVtYmVyJykge1xuICAgIHJldHVybiAwO1xuICB9XG5cbiAgLy8gJ0luZmluaXR5JyBpcyBhIHRleHR1YWwgbnVtYmVyLCBzbyBsZXNzIHRoYW4gJ0EnXG4gIGlmIChOdW1iZXIuaXNOYU4obmJzKSAmJiAhTnVtYmVyLmlzTmFOKG5hcykpIHtcbiAgICByZXR1cm4gLTE7XG4gIH1cbiAgaWYgKE51bWJlci5pc05hTihuYXMpICYmICFOdW1iZXIuaXNOYU4obmJzKSkge1xuICAgIHJldHVybiAxO1xuICB9XG5cbiAgLy8gZmluYWxseSwgXCJzbWFydFwiIHN0cmluZyBzb3J0aW5nIHBlciBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS80MzczNDIxLzExMjg3MVxuICBsZXQgYSA9IFN0cmluZyhhcyk7XG4gIGxldCBiID0gU3RyaW5nKGJzKTtcbiAgaWYgKGEgPT09IGIpIHtcbiAgICByZXR1cm4gMDtcbiAgfVxuICBpZiAoIXJkLnRlc3QoYSkgfHwgIXJkLnRlc3QoYikpIHtcbiAgICByZXR1cm4gYSA+IGIgPyAxIDogLTE7XG4gIH1cblxuICAvLyBzcGVjaWFsIHRyZWF0bWVudCBmb3Igc3RyaW5ncyBjb250YWluaW5nIGRpZ2l0c1xuICBhID0gYS5tYXRjaChyeCk7XG4gIGIgPSBiLm1hdGNoKHJ4KTtcbiAgd2hpbGUgKGEubGVuZ3RoICYmIGIubGVuZ3RoKSB7XG4gICAgY29uc3QgYTEgPSBhLnNoaWZ0KCk7XG4gICAgY29uc3QgYjEgPSBiLnNoaWZ0KCk7XG4gICAgaWYgKGExICE9PSBiMSkge1xuICAgICAgaWYgKHJkLnRlc3QoYTEpICYmIHJkLnRlc3QoYjEpKSB7XG4gICAgICAgIHJldHVybiBhMS5yZXBsYWNlKHJ6LCAnLjAnKSAtIGIxLnJlcGxhY2UocnosICcuMCcpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGExID4gYjEgPyAxIDogLTE7XG4gICAgfVxuICB9XG4gIHJldHVybiBhLmxlbmd0aCAtIGIubGVuZ3RoO1xufTtcblxuY29uc3Qgc29ydEFzID0gZnVuY3Rpb24gKG9yZGVyKSB7XG4gIGNvbnN0IG1hcHBpbmcgPSB7fTtcblxuICAvLyBzb3J0IGxvd2VyY2FzZWQga2V5cyBzaW1pbGFybHlcbiAgY29uc3QgbE1hcHBpbmcgPSB7fTtcbiAgb3JkZXIuZm9yRWFjaCgoZWxlbWVudCwgaSkgPT4ge1xuICAgIG1hcHBpbmdbZWxlbWVudF0gPSBpO1xuICAgIGlmICh0eXBlb2YgZWxlbWVudCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGxNYXBwaW5nW2VsZW1lbnQudG9Mb3dlckNhc2UoKV0gPSBpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBmdW5jdGlvbiAoYSwgYikge1xuICAgIGlmIChhIGluIG1hcHBpbmcgJiYgYiBpbiBtYXBwaW5nKSB7XG4gICAgICByZXR1cm4gbWFwcGluZ1thXSAtIG1hcHBpbmdbYl07XG4gICAgfVxuICAgIGlmIChhIGluIG1hcHBpbmcpIHtcbiAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gICAgaWYgKGIgaW4gbWFwcGluZykge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfVxuICAgIGlmIChhIGluIGxNYXBwaW5nICYmIGIgaW4gbE1hcHBpbmcpIHtcbiAgICAgIHJldHVybiBsTWFwcGluZ1thXSAtIGxNYXBwaW5nW2JdO1xuICAgIH1cbiAgICBpZiAoYSBpbiBsTWFwcGluZykge1xuICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgICBpZiAoYiBpbiBsTWFwcGluZykge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfVxuICAgIHJldHVybiBuYXR1cmFsU29ydChhLCBiKTtcbiAgfTtcbn07XG5cbmNvbnN0IGdldFNvcnQgPSBmdW5jdGlvbiAoc29ydGVycywgYXR0cikge1xuICBpZiAoc29ydGVycykge1xuICAgIGlmICh0eXBlb2Ygc29ydGVycyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgY29uc3Qgc29ydCA9IHNvcnRlcnMoYXR0cik7XG4gICAgICBpZiAodHlwZW9mIHNvcnQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgcmV0dXJuIHNvcnQ7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChhdHRyIGluIHNvcnRlcnMpIHtcbiAgICAgIHJldHVybiBzb3J0ZXJzW2F0dHJdO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbmF0dXJhbFNvcnQ7XG59O1xuXG4vLyBhZ2dyZWdhdG9yIHRlbXBsYXRlcyBkZWZhdWx0IHRvIFVTIG51bWJlciBmb3JtYXR0aW5nIGJ1dCB0aGlzIGlzIG92ZXJyaWRhYmxlXG5jb25zdCB1c0ZtdCA9IG51bWJlckZvcm1hdCgpO1xuY29uc3QgdXNGbXRJbnQgPSBudW1iZXJGb3JtYXQoeyBkaWdpdHNBZnRlckRlY2ltYWw6IDAgfSk7XG5jb25zdCB1c0ZtdFBjdCA9IG51bWJlckZvcm1hdCh7XG4gIGRpZ2l0c0FmdGVyRGVjaW1hbDogMSxcbiAgc2NhbGVyOiAxMDAsXG4gIHN1ZmZpeDogJyUnLFxufSk7XG5cbmNvbnN0IGZtdE5vblN0cmluZyA9IGZvcm1hdHRlciA9PiB4ID0+XG4gIHR5cGVvZiB4ID09PSAnc3RyaW5nJyA/IHggOiBmb3JtYXR0ZXIoeCk7XG5cbmNvbnN0IGJhc2VBZ2dyZWdhdG9yVGVtcGxhdGVzID0ge1xuICBjb3VudChmb3JtYXR0ZXIgPSB1c0ZtdEludCkge1xuICAgIHJldHVybiAoKSA9PlxuICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGNvdW50OiAwLFxuICAgICAgICAgIHB1c2goKSB7XG4gICAgICAgICAgICB0aGlzLmNvdW50ICs9IDE7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB2YWx1ZSgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvdW50O1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZm9ybWF0OiBmb3JtYXR0ZXIsXG4gICAgICAgIH07XG4gICAgICB9O1xuICB9LFxuXG4gIHVuaXF1ZXMoZm4sIGZvcm1hdHRlciA9IHVzRm10SW50KSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChbYXR0cl0pIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdW5pcTogW10sXG4gICAgICAgICAgcHVzaChyZWNvcmQpIHtcbiAgICAgICAgICAgIGlmICghQXJyYXkuZnJvbSh0aGlzLnVuaXEpLmluY2x1ZGVzKHJlY29yZFthdHRyXSkpIHtcbiAgICAgICAgICAgICAgdGhpcy51bmlxLnB1c2gocmVjb3JkW2F0dHJdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHZhbHVlKCkge1xuICAgICAgICAgICAgcmV0dXJuIGZuKHRoaXMudW5pcSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmb3JtYXQ6IGZtdE5vblN0cmluZyhmb3JtYXR0ZXIpLFxuICAgICAgICAgIG51bUlucHV0czogdHlwZW9mIGF0dHIgIT09ICd1bmRlZmluZWQnID8gMCA6IDEsXG4gICAgICAgIH07XG4gICAgICB9O1xuICAgIH07XG4gIH0sXG5cbiAgc3VtKGZvcm1hdHRlciA9IHVzRm10KSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChbYXR0cl0pIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VtOiAwLFxuICAgICAgICAgIHB1c2gocmVjb3JkKSB7XG4gICAgICAgICAgICBpZiAoTnVtYmVyLmlzTmFOKE51bWJlcihyZWNvcmRbYXR0cl0pKSkge1xuICAgICAgICAgICAgICB0aGlzLnN1bSA9IHJlY29yZFthdHRyXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMuc3VtICs9IHBhcnNlRmxvYXQocmVjb3JkW2F0dHJdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHZhbHVlKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3VtO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZm9ybWF0OiBmbXROb25TdHJpbmcoZm9ybWF0dGVyKSxcbiAgICAgICAgICBudW1JbnB1dHM6IHR5cGVvZiBhdHRyICE9PSAndW5kZWZpbmVkJyA/IDAgOiAxLFxuICAgICAgICB9O1xuICAgICAgfTtcbiAgICB9O1xuICB9LFxuXG4gIGV4dHJlbWVzKG1vZGUsIGZvcm1hdHRlciA9IHVzRm10KSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChbYXR0cl0pIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbDogbnVsbCxcbiAgICAgICAgICBzb3J0ZXI6IGdldFNvcnQoXG4gICAgICAgICAgICB0eXBlb2YgZGF0YSAhPT0gJ3VuZGVmaW5lZCcgPyBkYXRhLnNvcnRlcnMgOiBudWxsLFxuICAgICAgICAgICAgYXR0cixcbiAgICAgICAgICApLFxuICAgICAgICAgIHB1c2gocmVjb3JkKSB7XG4gICAgICAgICAgICBjb25zdCB4ID0gcmVjb3JkW2F0dHJdO1xuICAgICAgICAgICAgaWYgKFsnbWluJywgJ21heCddLmluY2x1ZGVzKG1vZGUpKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGNvZXJjZWRWYWx1ZSA9IE51bWJlcih4KTtcbiAgICAgICAgICAgICAgaWYgKE51bWJlci5pc05hTihjb2VyY2VkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52YWwgPVxuICAgICAgICAgICAgICAgICAgIXRoaXMudmFsIHx8XG4gICAgICAgICAgICAgICAgICAobW9kZSA9PT0gJ21pbicgJiYgeCA8IHRoaXMudmFsKSB8fFxuICAgICAgICAgICAgICAgICAgKG1vZGUgPT09ICdtYXgnICYmIHggPiB0aGlzLnZhbClcbiAgICAgICAgICAgICAgICAgICAgPyB4XG4gICAgICAgICAgICAgICAgICAgIDogdGhpcy52YWw7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy52YWwgPSBNYXRoW21vZGVdKFxuICAgICAgICAgICAgICAgICAgY29lcmNlZFZhbHVlLFxuICAgICAgICAgICAgICAgICAgdGhpcy52YWwgIT09IG51bGwgPyB0aGlzLnZhbCA6IGNvZXJjZWRWYWx1ZSxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgICBtb2RlID09PSAnZmlyc3QnICYmXG4gICAgICAgICAgICAgIHRoaXMuc29ydGVyKHgsIHRoaXMudmFsICE9PSBudWxsID8gdGhpcy52YWwgOiB4KSA8PSAwXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgdGhpcy52YWwgPSB4O1xuICAgICAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICAgICAgbW9kZSA9PT0gJ2xhc3QnICYmXG4gICAgICAgICAgICAgIHRoaXMuc29ydGVyKHgsIHRoaXMudmFsICE9PSBudWxsID8gdGhpcy52YWwgOiB4KSA+PSAwXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgdGhpcy52YWwgPSB4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgdmFsdWUoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy52YWw7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmb3JtYXQoeCkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB4ID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0dGVyKHgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHg7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBudW1JbnB1dHM6IHR5cGVvZiBhdHRyICE9PSAndW5kZWZpbmVkJyA/IDAgOiAxLFxuICAgICAgICB9O1xuICAgICAgfTtcbiAgICB9O1xuICB9LFxuXG4gIHF1YW50aWxlKHEsIGZvcm1hdHRlciA9IHVzRm10KSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChbYXR0cl0pIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdmFsczogW10sXG4gICAgICAgICAgc3RyTWFwOiB7fSxcbiAgICAgICAgICBwdXNoKHJlY29yZCkge1xuICAgICAgICAgICAgY29uc3QgdmFsID0gcmVjb3JkW2F0dHJdO1xuICAgICAgICAgICAgY29uc3QgeCA9IE51bWJlcih2YWwpO1xuXG4gICAgICAgICAgICBpZiAoTnVtYmVyLmlzTmFOKHgpKSB7XG4gICAgICAgICAgICAgIHRoaXMuc3RyTWFwW3ZhbF0gPSAodGhpcy5zdHJNYXBbdmFsXSB8fCAwKSArIDE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aGlzLnZhbHMucHVzaCh4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHZhbHVlKCkge1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICB0aGlzLnZhbHMubGVuZ3RoID09PSAwICYmXG4gICAgICAgICAgICAgIE9iamVjdC5rZXlzKHRoaXMuc3RyTWFwKS5sZW5ndGggPT09IDBcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuc3RyTWFwKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgY29uc3QgdmFsdWVzID0gT2JqZWN0LnZhbHVlcyh0aGlzLnN0ck1hcCkuc29ydCgoYSwgYikgPT4gYSAtIGIpO1xuICAgICAgICAgICAgICBjb25zdCBtaWRkbGUgPSBNYXRoLmZsb29yKHZhbHVlcy5sZW5ndGggLyAyKTtcblxuICAgICAgICAgICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXModGhpcy5zdHJNYXApO1xuICAgICAgICAgICAgICByZXR1cm4ga2V5cy5sZW5ndGggJSAyICE9PSAwXG4gICAgICAgICAgICAgICAgPyBrZXlzW21pZGRsZV1cbiAgICAgICAgICAgICAgICA6IChrZXlzW21pZGRsZSAtIDFdICsga2V5c1ttaWRkbGVdKSAvIDI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMudmFscy5zb3J0KChhLCBiKSA9PiBhIC0gYik7XG4gICAgICAgICAgICBjb25zdCBpID0gKHRoaXMudmFscy5sZW5ndGggLSAxKSAqIHE7XG4gICAgICAgICAgICByZXR1cm4gKHRoaXMudmFsc1tNYXRoLmZsb29yKGkpXSArIHRoaXMudmFsc1tNYXRoLmNlaWwoaSldKSAvIDIuMDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZvcm1hdDogZm10Tm9uU3RyaW5nKGZvcm1hdHRlciksXG4gICAgICAgICAgbnVtSW5wdXRzOiB0eXBlb2YgYXR0ciAhPT0gJ3VuZGVmaW5lZCcgPyAwIDogMSxcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgfTtcbiAgfSxcblxuICBydW5uaW5nU3RhdChtb2RlID0gJ21lYW4nLCBkZG9mID0gMSwgZm9ybWF0dGVyID0gdXNGbXQpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKFthdHRyXSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBuOiAwLjAsXG4gICAgICAgICAgbTogMC4wLFxuICAgICAgICAgIHM6IDAuMCxcbiAgICAgICAgICBzdHJWYWx1ZTogbnVsbCxcbiAgICAgICAgICBwdXNoKHJlY29yZCkge1xuICAgICAgICAgICAgY29uc3QgeCA9IE51bWJlcihyZWNvcmRbYXR0cl0pO1xuICAgICAgICAgICAgaWYgKE51bWJlci5pc05hTih4KSkge1xuICAgICAgICAgICAgICB0aGlzLnN0clZhbHVlID1cbiAgICAgICAgICAgICAgICB0eXBlb2YgcmVjb3JkW2F0dHJdID09PSAnc3RyaW5nJyA/IHJlY29yZFthdHRyXSA6IHRoaXMuc3RyVmFsdWU7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubiArPSAxLjA7XG4gICAgICAgICAgICBpZiAodGhpcy5uID09PSAxLjApIHtcbiAgICAgICAgICAgICAgdGhpcy5tID0geDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IG1OZXcgPSB0aGlzLm0gKyAoeCAtIHRoaXMubSkgLyB0aGlzLm47XG4gICAgICAgICAgICB0aGlzLnMgKz0gKHggLSB0aGlzLm0pICogKHggLSBtTmV3KTtcbiAgICAgICAgICAgIHRoaXMubSA9IG1OZXc7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB2YWx1ZSgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0clZhbHVlKSB7XG4gICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0clZhbHVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobW9kZSA9PT0gJ21lYW4nKSB7XG4gICAgICAgICAgICAgIGlmICh0aGlzLm4gPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMCAvIDA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLm4gPD0gZGRvZikge1xuICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN3aXRjaCAobW9kZSkge1xuICAgICAgICAgICAgICBjYXNlICd2YXInOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnMgLyAodGhpcy5uIC0gZGRvZik7XG4gICAgICAgICAgICAgIGNhc2UgJ3N0ZGV2JzpcbiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KHRoaXMucyAvICh0aGlzLm4gLSBkZG9mKSk7XG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCd1bmtub3duIG1vZGUgZm9yIHJ1bm5pbmdTdGF0Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmb3JtYXQ6IGZtdE5vblN0cmluZyhmb3JtYXR0ZXIpLFxuICAgICAgICAgIG51bUlucHV0czogdHlwZW9mIGF0dHIgIT09ICd1bmRlZmluZWQnID8gMCA6IDEsXG4gICAgICAgIH07XG4gICAgICB9O1xuICAgIH07XG4gIH0sXG5cbiAgc3VtT3ZlclN1bShmb3JtYXR0ZXIgPSB1c0ZtdCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAoW251bSwgZGVub21dKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1bU51bTogMCxcbiAgICAgICAgICBzdW1EZW5vbTogMCxcbiAgICAgICAgICBwdXNoKHJlY29yZCkge1xuICAgICAgICAgICAgaWYgKCFOdW1iZXIuaXNOYU4oTnVtYmVyKHJlY29yZFtudW1dKSkpIHtcbiAgICAgICAgICAgICAgdGhpcy5zdW1OdW0gKz0gcGFyc2VGbG9hdChyZWNvcmRbbnVtXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIU51bWJlci5pc05hTihOdW1iZXIocmVjb3JkW2Rlbm9tXSkpKSB7XG4gICAgICAgICAgICAgIHRoaXMuc3VtRGVub20gKz0gcGFyc2VGbG9hdChyZWNvcmRbZGVub21dKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHZhbHVlKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3VtTnVtIC8gdGhpcy5zdW1EZW5vbTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZvcm1hdDogZm9ybWF0dGVyLFxuICAgICAgICAgIG51bUlucHV0czpcbiAgICAgICAgICAgIHR5cGVvZiBudW0gIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBkZW5vbSAhPT0gJ3VuZGVmaW5lZCcgPyAwIDogMixcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgfTtcbiAgfSxcblxuICBmcmFjdGlvbk9mKHdyYXBwZWQsIHR5cGUgPSAndG90YWwnLCBmb3JtYXR0ZXIgPSB1c0ZtdFBjdCkge1xuICAgIHJldHVybiAoLi4ueCkgPT5cbiAgICAgIGZ1bmN0aW9uIChkYXRhLCByb3dLZXksIGNvbEtleSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHNlbGVjdG9yOiB7IHRvdGFsOiBbW10sIFtdXSwgcm93OiBbcm93S2V5LCBbXV0sIGNvbDogW1tdLCBjb2xLZXldIH1bXG4gICAgICAgICAgICB0eXBlXG4gICAgICAgICAgXSxcbiAgICAgICAgICBpbm5lcjogd3JhcHBlZCguLi5BcnJheS5mcm9tKHggfHwgW10pKShkYXRhLCByb3dLZXksIGNvbEtleSksXG4gICAgICAgICAgcHVzaChyZWNvcmQpIHtcbiAgICAgICAgICAgIHRoaXMuaW5uZXIucHVzaChyZWNvcmQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZm9ybWF0OiBmbXROb25TdHJpbmcoZm9ybWF0dGVyKSxcbiAgICAgICAgICB2YWx1ZSgpIHtcbiAgICAgICAgICAgIGNvbnN0IGFjYyA9IGRhdGFcbiAgICAgICAgICAgICAgLmdldEFnZ3JlZ2F0b3IoLi4uQXJyYXkuZnJvbSh0aGlzLnNlbGVjdG9yIHx8IFtdKSlcbiAgICAgICAgICAgICAgLmlubmVyLnZhbHVlKCk7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgYWNjID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pbm5lci52YWx1ZSgpIC8gYWNjO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbnVtSW5wdXRzOiB3cmFwcGVkKC4uLkFycmF5LmZyb20oeCB8fCBbXSkpKCkubnVtSW5wdXRzLFxuICAgICAgICB9O1xuICAgICAgfTtcbiAgfSxcbn07XG5cbmNvbnN0IGV4dGVuZGVkQWdncmVnYXRvclRlbXBsYXRlcyA9IHtcbiAgY291bnRVbmlxdWUoZikge1xuICAgIHJldHVybiBiYXNlQWdncmVnYXRvclRlbXBsYXRlcy51bmlxdWVzKHggPT4geC5sZW5ndGgsIGYpO1xuICB9LFxuICBsaXN0VW5pcXVlKHMsIGYpIHtcbiAgICByZXR1cm4gYmFzZUFnZ3JlZ2F0b3JUZW1wbGF0ZXMudW5pcXVlcyh4ID0+IHguam9pbihzKSwgZiB8fCAoeCA9PiB4KSk7XG4gIH0sXG4gIG1heChmKSB7XG4gICAgcmV0dXJuIGJhc2VBZ2dyZWdhdG9yVGVtcGxhdGVzLmV4dHJlbWVzKCdtYXgnLCBmKTtcbiAgfSxcbiAgbWluKGYpIHtcbiAgICByZXR1cm4gYmFzZUFnZ3JlZ2F0b3JUZW1wbGF0ZXMuZXh0cmVtZXMoJ21pbicsIGYpO1xuICB9LFxuICBmaXJzdChmKSB7XG4gICAgcmV0dXJuIGJhc2VBZ2dyZWdhdG9yVGVtcGxhdGVzLmV4dHJlbWVzKCdmaXJzdCcsIGYpO1xuICB9LFxuICBsYXN0KGYpIHtcbiAgICByZXR1cm4gYmFzZUFnZ3JlZ2F0b3JUZW1wbGF0ZXMuZXh0cmVtZXMoJ2xhc3QnLCBmKTtcbiAgfSxcbiAgbWVkaWFuKGYpIHtcbiAgICByZXR1cm4gYmFzZUFnZ3JlZ2F0b3JUZW1wbGF0ZXMucXVhbnRpbGUoMC41LCBmKTtcbiAgfSxcbiAgYXZlcmFnZShmKSB7XG4gICAgcmV0dXJuIGJhc2VBZ2dyZWdhdG9yVGVtcGxhdGVzLnJ1bm5pbmdTdGF0KCdtZWFuJywgMSwgZik7XG4gIH0sXG4gIHZhcihkZG9mLCBmKSB7XG4gICAgcmV0dXJuIGJhc2VBZ2dyZWdhdG9yVGVtcGxhdGVzLnJ1bm5pbmdTdGF0KCd2YXInLCBkZG9mLCBmKTtcbiAgfSxcbiAgc3RkZXYoZGRvZiwgZikge1xuICAgIHJldHVybiBiYXNlQWdncmVnYXRvclRlbXBsYXRlcy5ydW5uaW5nU3RhdCgnc3RkZXYnLCBkZG9mLCBmKTtcbiAgfSxcbn07XG5cbmNvbnN0IGFnZ3JlZ2F0b3JUZW1wbGF0ZXMgPSB7XG4gIC4uLmJhc2VBZ2dyZWdhdG9yVGVtcGxhdGVzLFxuICAuLi5leHRlbmRlZEFnZ3JlZ2F0b3JUZW1wbGF0ZXMsXG59O1xuXG4vLyBkZWZhdWx0IGFnZ3JlZ2F0b3JzICYgcmVuZGVyZXJzIHVzZSBVUyBuYW1pbmcgYW5kIG51bWJlciBmb3JtYXR0aW5nXG5jb25zdCBhZ2dyZWdhdG9ycyA9ICh0cGwgPT4gKHtcbiAgQ291bnQ6IHRwbC5jb3VudCh1c0ZtdEludCksXG4gICdDb3VudCBVbmlxdWUgVmFsdWVzJzogdHBsLmNvdW50VW5pcXVlKHVzRm10SW50KSxcbiAgJ0xpc3QgVW5pcXVlIFZhbHVlcyc6IHRwbC5saXN0VW5pcXVlKCcsICcpLFxuICBTdW06IHRwbC5zdW0odXNGbXQpLFxuICAnSW50ZWdlciBTdW0nOiB0cGwuc3VtKHVzRm10SW50KSxcbiAgQXZlcmFnZTogdHBsLmF2ZXJhZ2UodXNGbXQpLFxuICBNZWRpYW46IHRwbC5tZWRpYW4odXNGbXQpLFxuICAnU2FtcGxlIFZhcmlhbmNlJzogdHBsLnZhcigxLCB1c0ZtdCksXG4gICdTYW1wbGUgU3RhbmRhcmQgRGV2aWF0aW9uJzogdHBsLnN0ZGV2KDEsIHVzRm10KSxcbiAgTWluaW11bTogdHBsLm1pbih1c0ZtdCksXG4gIE1heGltdW06IHRwbC5tYXgodXNGbXQpLFxuICBGaXJzdDogdHBsLmZpcnN0KHVzRm10KSxcbiAgTGFzdDogdHBsLmxhc3QodXNGbXQpLFxuICAnU3VtIG92ZXIgU3VtJzogdHBsLnN1bU92ZXJTdW0odXNGbXQpLFxuICAnU3VtIGFzIEZyYWN0aW9uIG9mIFRvdGFsJzogdHBsLmZyYWN0aW9uT2YodHBsLnN1bSgpLCAndG90YWwnLCB1c0ZtdFBjdCksXG4gICdTdW0gYXMgRnJhY3Rpb24gb2YgUm93cyc6IHRwbC5mcmFjdGlvbk9mKHRwbC5zdW0oKSwgJ3JvdycsIHVzRm10UGN0KSxcbiAgJ1N1bSBhcyBGcmFjdGlvbiBvZiBDb2x1bW5zJzogdHBsLmZyYWN0aW9uT2YodHBsLnN1bSgpLCAnY29sJywgdXNGbXRQY3QpLFxuICAnQ291bnQgYXMgRnJhY3Rpb24gb2YgVG90YWwnOiB0cGwuZnJhY3Rpb25PZih0cGwuY291bnQoKSwgJ3RvdGFsJywgdXNGbXRQY3QpLFxuICAnQ291bnQgYXMgRnJhY3Rpb24gb2YgUm93cyc6IHRwbC5mcmFjdGlvbk9mKHRwbC5jb3VudCgpLCAncm93JywgdXNGbXRQY3QpLFxuICAnQ291bnQgYXMgRnJhY3Rpb24gb2YgQ29sdW1ucyc6IHRwbC5mcmFjdGlvbk9mKHRwbC5jb3VudCgpLCAnY29sJywgdXNGbXRQY3QpLFxufSkpKGFnZ3JlZ2F0b3JUZW1wbGF0ZXMpO1xuXG5jb25zdCBsb2NhbGVzID0ge1xuICBlbjoge1xuICAgIGFnZ3JlZ2F0b3JzLFxuICAgIGxvY2FsZVN0cmluZ3M6IHtcbiAgICAgIHJlbmRlckVycm9yOiAnQW4gZXJyb3Igb2NjdXJyZWQgcmVuZGVyaW5nIHRoZSBQaXZvdFRhYmxlIHJlc3VsdHMuJyxcbiAgICAgIGNvbXB1dGVFcnJvcjogJ0FuIGVycm9yIG9jY3VycmVkIGNvbXB1dGluZyB0aGUgUGl2b3RUYWJsZSByZXN1bHRzLicsXG4gICAgICB1aVJlbmRlckVycm9yOiAnQW4gZXJyb3Igb2NjdXJyZWQgcmVuZGVyaW5nIHRoZSBQaXZvdFRhYmxlIFVJLicsXG4gICAgICBzZWxlY3RBbGw6ICdTZWxlY3QgQWxsJyxcbiAgICAgIHNlbGVjdE5vbmU6ICdTZWxlY3QgTm9uZScsXG4gICAgICB0b29NYW55OiAnKHRvbyBtYW55IHRvIGxpc3QpJyxcbiAgICAgIGZpbHRlclJlc3VsdHM6ICdGaWx0ZXIgdmFsdWVzJyxcbiAgICAgIGFwcGx5OiAnQXBwbHknLFxuICAgICAgY2FuY2VsOiAnQ2FuY2VsJyxcbiAgICAgIHRvdGFsczogJ1RvdGFscycsXG4gICAgICB2czogJ3ZzJyxcbiAgICAgIGJ5OiAnYnknLFxuICAgIH0sXG4gIH0sXG59O1xuXG4vLyBkYXRlRm9ybWF0IGRlcml2ZXIgbDEwbiByZXF1aXJlcyBtb250aCBhbmQgZGF5IG5hbWVzIHRvIGJlIHBhc3NlZCBpbiBkaXJlY3RseVxuY29uc3QgbXRoTmFtZXNFbiA9IFtcbiAgJ0phbicsXG4gICdGZWInLFxuICAnTWFyJyxcbiAgJ0FwcicsXG4gICdNYXknLFxuICAnSnVuJyxcbiAgJ0p1bCcsXG4gICdBdWcnLFxuICAnU2VwJyxcbiAgJ09jdCcsXG4gICdOb3YnLFxuICAnRGVjJyxcbl07XG5jb25zdCBkYXlOYW1lc0VuID0gWydTdW4nLCAnTW9uJywgJ1R1ZScsICdXZWQnLCAnVGh1JywgJ0ZyaScsICdTYXQnXTtcbmNvbnN0IHplcm9QYWQgPSBudW1iZXIgPT4gYDAke251bWJlcn1gLnN1YnN0cigtMiwgMik7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tbWFnaWMtbnVtYmVyc1xuXG5jb25zdCBkZXJpdmVycyA9IHtcbiAgYmluKGNvbCwgYmluV2lkdGgpIHtcbiAgICByZXR1cm4gcmVjb3JkID0+IHJlY29yZFtjb2xdIC0gKHJlY29yZFtjb2xdICUgYmluV2lkdGgpO1xuICB9LFxuICBkYXRlRm9ybWF0KFxuICAgIGNvbCxcbiAgICBmb3JtYXRTdHJpbmcsXG4gICAgdXRjT3V0cHV0ID0gZmFsc2UsXG4gICAgbXRoTmFtZXMgPSBtdGhOYW1lc0VuLFxuICAgIGRheU5hbWVzID0gZGF5TmFtZXNFbixcbiAgKSB7XG4gICAgY29uc3QgdXRjID0gdXRjT3V0cHV0ID8gJ1VUQycgOiAnJztcbiAgICByZXR1cm4gZnVuY3Rpb24gKHJlY29yZCkge1xuICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKERhdGUucGFyc2UocmVjb3JkW2NvbF0pKTtcbiAgICAgIGlmIChOdW1iZXIuaXNOYU4oZGF0ZSkpIHtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZvcm1hdFN0cmluZy5yZXBsYWNlKC8lKC4pL2csIGZ1bmN0aW9uIChtLCBwKSB7XG4gICAgICAgIHN3aXRjaCAocCkge1xuICAgICAgICAgIGNhc2UgJ3knOlxuICAgICAgICAgICAgcmV0dXJuIGRhdGVbYGdldCR7dXRjfUZ1bGxZZWFyYF0oKTtcbiAgICAgICAgICBjYXNlICdtJzpcbiAgICAgICAgICAgIHJldHVybiB6ZXJvUGFkKGRhdGVbYGdldCR7dXRjfU1vbnRoYF0oKSArIDEpO1xuICAgICAgICAgIGNhc2UgJ24nOlxuICAgICAgICAgICAgcmV0dXJuIG10aE5hbWVzW2RhdGVbYGdldCR7dXRjfU1vbnRoYF0oKV07XG4gICAgICAgICAgY2FzZSAnZCc6XG4gICAgICAgICAgICByZXR1cm4gemVyb1BhZChkYXRlW2BnZXQke3V0Y31EYXRlYF0oKSk7XG4gICAgICAgICAgY2FzZSAndyc6XG4gICAgICAgICAgICByZXR1cm4gZGF5TmFtZXNbZGF0ZVtgZ2V0JHt1dGN9RGF5YF0oKV07XG4gICAgICAgICAgY2FzZSAneCc6XG4gICAgICAgICAgICByZXR1cm4gZGF0ZVtgZ2V0JHt1dGN9RGF5YF0oKTtcbiAgICAgICAgICBjYXNlICdIJzpcbiAgICAgICAgICAgIHJldHVybiB6ZXJvUGFkKGRhdGVbYGdldCR7dXRjfUhvdXJzYF0oKSk7XG4gICAgICAgICAgY2FzZSAnTSc6XG4gICAgICAgICAgICByZXR1cm4gemVyb1BhZChkYXRlW2BnZXQke3V0Y31NaW51dGVzYF0oKSk7XG4gICAgICAgICAgY2FzZSAnUyc6XG4gICAgICAgICAgICByZXR1cm4gemVyb1BhZChkYXRlW2BnZXQke3V0Y31TZWNvbmRzYF0oKSk7XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBgJSR7cH1gO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICB9LFxufTtcblxuLy8gR2l2ZW4gYW4gYXJyYXkgb2YgYXR0cmlidXRlIHZhbHVlcywgY29udmVydCB0byBhIGtleSB0aGF0XG4vLyBjYW4gYmUgdXNlZCBpbiBvYmplY3RzLlxuY29uc3QgZmxhdEtleSA9IGF0dHJWYWxzID0+IGF0dHJWYWxzLmpvaW4oU3RyaW5nLmZyb21DaGFyQ29kZSgwKSk7XG5cbi8qXG5EYXRhIE1vZGVsIGNsYXNzXG4qL1xuXG5jbGFzcyBQaXZvdERhdGEge1xuICBjb25zdHJ1Y3RvcihpbnB1dFByb3BzID0ge30sIHN1YnRvdGFscyA9IHt9KSB7XG4gICAgdGhpcy5wcm9wcyA9IHsgLi4uUGl2b3REYXRhLmRlZmF1bHRQcm9wcywgLi4uaW5wdXRQcm9wcyB9O1xuICAgIHRoaXMucHJvY2Vzc1JlY29yZCA9IHRoaXMucHJvY2Vzc1JlY29yZC5iaW5kKHRoaXMpO1xuICAgIFByb3BUeXBlcy5jaGVja1Byb3BUeXBlcyhcbiAgICAgIFBpdm90RGF0YS5wcm9wVHlwZXMsXG4gICAgICB0aGlzLnByb3BzLFxuICAgICAgJ3Byb3AnLFxuICAgICAgJ1Bpdm90RGF0YScsXG4gICAgKTtcblxuICAgIHRoaXMuYWdncmVnYXRvciA9IHRoaXMucHJvcHNcbiAgICAgIC5hZ2dyZWdhdG9yc0ZhY3RvcnkodGhpcy5wcm9wcy5kZWZhdWx0Rm9ybWF0dGVyKVxuICAgICAgW3RoaXMucHJvcHMuYWdncmVnYXRvck5hbWVdKHRoaXMucHJvcHMudmFscyk7XG4gICAgdGhpcy5mb3JtYXR0ZWRBZ2dyZWdhdG9ycyA9XG4gICAgICB0aGlzLnByb3BzLmN1c3RvbUZvcm1hdHRlcnMgJiZcbiAgICAgIE9iamVjdC5lbnRyaWVzKHRoaXMucHJvcHMuY3VzdG9tRm9ybWF0dGVycykucmVkdWNlKFxuICAgICAgICAoYWNjLCBba2V5LCBjb2x1bW5Gb3JtYXR0ZXJdKSA9PiB7XG4gICAgICAgICAgYWNjW2tleV0gPSB7fTtcbiAgICAgICAgICBPYmplY3QuZW50cmllcyhjb2x1bW5Gb3JtYXR0ZXIpLmZvckVhY2goKFtjb2x1bW4sIGZvcm1hdHRlcl0pID0+IHtcbiAgICAgICAgICAgIGFjY1trZXldW2NvbHVtbl0gPSB0aGlzLnByb3BzXG4gICAgICAgICAgICAgIC5hZ2dyZWdhdG9yc0ZhY3RvcnkoZm9ybWF0dGVyKVxuICAgICAgICAgICAgICBbdGhpcy5wcm9wcy5hZ2dyZWdhdG9yTmFtZV0odGhpcy5wcm9wcy52YWxzKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICB9LFxuICAgICAgICB7fSxcbiAgICAgICk7XG4gICAgdGhpcy50cmVlID0ge307XG4gICAgdGhpcy5yb3dLZXlzID0gW107XG4gICAgdGhpcy5jb2xLZXlzID0gW107XG4gICAgdGhpcy5yb3dUb3RhbHMgPSB7fTtcbiAgICB0aGlzLmNvbFRvdGFscyA9IHt9O1xuICAgIHRoaXMuYWxsVG90YWwgPSB0aGlzLmFnZ3JlZ2F0b3IodGhpcywgW10sIFtdKTtcbiAgICB0aGlzLnN1YnRvdGFscyA9IHN1YnRvdGFscztcbiAgICB0aGlzLnNvcnRlZCA9IGZhbHNlO1xuXG4gICAgLy8gaXRlcmF0ZSB0aHJvdWdoIGlucHV0LCBhY2N1bXVsYXRpbmcgZGF0YSBmb3IgY2VsbHNcbiAgICBQaXZvdERhdGEuZm9yRWFjaFJlY29yZCh0aGlzLnByb3BzLmRhdGEsIHRoaXMucHJvY2Vzc1JlY29yZCk7XG4gIH1cblxuICBnZXRGb3JtYXR0ZWRBZ2dyZWdhdG9yKHJlY29yZCwgdG90YWxzS2V5cykge1xuICAgIGlmICghdGhpcy5mb3JtYXR0ZWRBZ2dyZWdhdG9ycykge1xuICAgICAgcmV0dXJuIHRoaXMuYWdncmVnYXRvcjtcbiAgICB9XG4gICAgY29uc3QgW2dyb3VwTmFtZSwgZ3JvdXBWYWx1ZV0gPVxuICAgICAgT2JqZWN0LmVudHJpZXMocmVjb3JkKS5maW5kKFxuICAgICAgICAoW25hbWUsIHZhbHVlXSkgPT5cbiAgICAgICAgICB0aGlzLmZvcm1hdHRlZEFnZ3JlZ2F0b3JzW25hbWVdICYmXG4gICAgICAgICAgdGhpcy5mb3JtYXR0ZWRBZ2dyZWdhdG9yc1tuYW1lXVt2YWx1ZV0sXG4gICAgICApIHx8IFtdO1xuICAgIGlmIChcbiAgICAgICFncm91cE5hbWUgfHxcbiAgICAgICFncm91cFZhbHVlIHx8XG4gICAgICAodG90YWxzS2V5cyAmJiAhdG90YWxzS2V5cy5pbmNsdWRlcyhncm91cFZhbHVlKSlcbiAgICApIHtcbiAgICAgIHJldHVybiB0aGlzLmFnZ3JlZ2F0b3I7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmZvcm1hdHRlZEFnZ3JlZ2F0b3JzW2dyb3VwTmFtZV1bZ3JvdXBWYWx1ZV0gfHwgdGhpcy5hZ2dyZWdhdG9yO1xuICB9XG5cbiAgYXJyU29ydChhdHRycywgcGFydGlhbE9uVG9wLCByZXZlcnNlID0gZmFsc2UpIHtcbiAgICBjb25zdCBzb3J0ZXJzQXJyID0gYXR0cnMubWFwKGEgPT4gZ2V0U29ydCh0aGlzLnByb3BzLnNvcnRlcnMsIGEpKTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgIGNvbnN0IGxpbWl0ID0gTWF0aC5taW4oYS5sZW5ndGgsIGIubGVuZ3RoKTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGltaXQ7IGkgKz0gMSkge1xuICAgICAgICBjb25zdCBzb3J0ZXIgPSBzb3J0ZXJzQXJyW2ldO1xuICAgICAgICBjb25zdCBjb21wYXJpc29uID0gcmV2ZXJzZSA/IHNvcnRlcihiW2ldLCBhW2ldKSA6IHNvcnRlcihhW2ldLCBiW2ldKTtcbiAgICAgICAgaWYgKGNvbXBhcmlzb24gIT09IDApIHtcbiAgICAgICAgICByZXR1cm4gY29tcGFyaXNvbjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHBhcnRpYWxPblRvcCA/IGEubGVuZ3RoIC0gYi5sZW5ndGggOiBiLmxlbmd0aCAtIGEubGVuZ3RoO1xuICAgIH07XG4gIH1cblxuICBzb3J0S2V5cygpIHtcbiAgICBpZiAoIXRoaXMuc29ydGVkKSB7XG4gICAgICB0aGlzLnNvcnRlZCA9IHRydWU7XG4gICAgICBjb25zdCB2ID0gKHIsIGMpID0+IHRoaXMuZ2V0QWdncmVnYXRvcihyLCBjKS52YWx1ZSgpO1xuICAgICAgc3dpdGNoICh0aGlzLnByb3BzLnJvd09yZGVyKSB7XG4gICAgICAgIGNhc2UgJ2tleV96X3RvX2EnOlxuICAgICAgICAgIHRoaXMucm93S2V5cy5zb3J0KFxuICAgICAgICAgICAgdGhpcy5hcnJTb3J0KHRoaXMucHJvcHMucm93cywgdGhpcy5zdWJ0b3RhbHMucm93UGFydGlhbE9uVG9wLCB0cnVlKSxcbiAgICAgICAgICApO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICd2YWx1ZV9hX3RvX3onOlxuICAgICAgICAgIHRoaXMucm93S2V5cy5zb3J0KChhLCBiKSA9PiBuYXR1cmFsU29ydCh2KGEsIFtdKSwgdihiLCBbXSkpKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAndmFsdWVfel90b19hJzpcbiAgICAgICAgICB0aGlzLnJvd0tleXMuc29ydCgoYSwgYikgPT4gLW5hdHVyYWxTb3J0KHYoYSwgW10pLCB2KGIsIFtdKSkpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHRoaXMucm93S2V5cy5zb3J0KFxuICAgICAgICAgICAgdGhpcy5hcnJTb3J0KHRoaXMucHJvcHMucm93cywgdGhpcy5zdWJ0b3RhbHMucm93UGFydGlhbE9uVG9wKSxcbiAgICAgICAgICApO1xuICAgICAgfVxuICAgICAgc3dpdGNoICh0aGlzLnByb3BzLmNvbE9yZGVyKSB7XG4gICAgICAgIGNhc2UgJ2tleV96X3RvX2EnOlxuICAgICAgICAgIHRoaXMuY29sS2V5cy5zb3J0KFxuICAgICAgICAgICAgdGhpcy5hcnJTb3J0KHRoaXMucHJvcHMuY29scywgdGhpcy5zdWJ0b3RhbHMuY29sUGFydGlhbE9uVG9wLCB0cnVlKSxcbiAgICAgICAgICApO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICd2YWx1ZV9hX3RvX3onOlxuICAgICAgICAgIHRoaXMuY29sS2V5cy5zb3J0KChhLCBiKSA9PiBuYXR1cmFsU29ydCh2KFtdLCBhKSwgdihbXSwgYikpKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAndmFsdWVfel90b19hJzpcbiAgICAgICAgICB0aGlzLmNvbEtleXMuc29ydCgoYSwgYikgPT4gLW5hdHVyYWxTb3J0KHYoW10sIGEpLCB2KFtdLCBiKSkpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHRoaXMuY29sS2V5cy5zb3J0KFxuICAgICAgICAgICAgdGhpcy5hcnJTb3J0KHRoaXMucHJvcHMuY29scywgdGhpcy5zdWJ0b3RhbHMuY29sUGFydGlhbE9uVG9wKSxcbiAgICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGdldENvbEtleXMoKSB7XG4gICAgdGhpcy5zb3J0S2V5cygpO1xuICAgIHJldHVybiB0aGlzLmNvbEtleXM7XG4gIH1cblxuICBnZXRSb3dLZXlzKCkge1xuICAgIHRoaXMuc29ydEtleXMoKTtcbiAgICByZXR1cm4gdGhpcy5yb3dLZXlzO1xuICB9XG5cbiAgcHJvY2Vzc1JlY29yZChyZWNvcmQpIHtcbiAgICAvLyB0aGlzIGNvZGUgaXMgY2FsbGVkIGluIGEgdGlnaHQgbG9vcFxuICAgIGNvbnN0IGNvbEtleSA9IFtdO1xuICAgIGNvbnN0IHJvd0tleSA9IFtdO1xuICAgIHRoaXMucHJvcHMuY29scy5mb3JFYWNoKGNvbCA9PiB7XG4gICAgICBjb2xLZXkucHVzaChjb2wgaW4gcmVjb3JkID8gcmVjb3JkW2NvbF0gOiAnbnVsbCcpO1xuICAgIH0pO1xuICAgIHRoaXMucHJvcHMucm93cy5mb3JFYWNoKHJvdyA9PiB7XG4gICAgICByb3dLZXkucHVzaChyb3cgaW4gcmVjb3JkID8gcmVjb3JkW3Jvd10gOiAnbnVsbCcpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5hbGxUb3RhbC5wdXNoKHJlY29yZCk7XG5cbiAgICBjb25zdCByb3dTdGFydCA9IHRoaXMuc3VidG90YWxzLnJvd0VuYWJsZWQgPyAxIDogTWF0aC5tYXgoMSwgcm93S2V5Lmxlbmd0aCk7XG4gICAgY29uc3QgY29sU3RhcnQgPSB0aGlzLnN1YnRvdGFscy5jb2xFbmFibGVkID8gMSA6IE1hdGgubWF4KDEsIGNvbEtleS5sZW5ndGgpO1xuXG4gICAgbGV0IGlzUm93U3VidG90YWw7XG4gICAgbGV0IGlzQ29sU3VidG90YWw7XG4gICAgZm9yIChsZXQgcmkgPSByb3dTdGFydDsgcmkgPD0gcm93S2V5Lmxlbmd0aDsgcmkgKz0gMSkge1xuICAgICAgaXNSb3dTdWJ0b3RhbCA9IHJpIDwgcm93S2V5Lmxlbmd0aDtcbiAgICAgIGNvbnN0IGZSb3dLZXkgPSByb3dLZXkuc2xpY2UoMCwgcmkpO1xuICAgICAgY29uc3QgZmxhdFJvd0tleSA9IGZsYXRLZXkoZlJvd0tleSk7XG4gICAgICBpZiAoIXRoaXMucm93VG90YWxzW2ZsYXRSb3dLZXldKSB7XG4gICAgICAgIHRoaXMucm93S2V5cy5wdXNoKGZSb3dLZXkpO1xuICAgICAgICB0aGlzLnJvd1RvdGFsc1tmbGF0Um93S2V5XSA9IHRoaXMuZ2V0Rm9ybWF0dGVkQWdncmVnYXRvcihcbiAgICAgICAgICByZWNvcmQsXG4gICAgICAgICAgcm93S2V5LFxuICAgICAgICApKHRoaXMsIGZSb3dLZXksIFtdKTtcbiAgICAgIH1cbiAgICAgIHRoaXMucm93VG90YWxzW2ZsYXRSb3dLZXldLnB1c2gocmVjb3JkKTtcbiAgICAgIHRoaXMucm93VG90YWxzW2ZsYXRSb3dLZXldLmlzU3VidG90YWwgPSBpc1Jvd1N1YnRvdGFsO1xuICAgIH1cblxuICAgIGZvciAobGV0IGNpID0gY29sU3RhcnQ7IGNpIDw9IGNvbEtleS5sZW5ndGg7IGNpICs9IDEpIHtcbiAgICAgIGlzQ29sU3VidG90YWwgPSBjaSA8IGNvbEtleS5sZW5ndGg7XG4gICAgICBjb25zdCBmQ29sS2V5ID0gY29sS2V5LnNsaWNlKDAsIGNpKTtcbiAgICAgIGNvbnN0IGZsYXRDb2xLZXkgPSBmbGF0S2V5KGZDb2xLZXkpO1xuICAgICAgaWYgKCF0aGlzLmNvbFRvdGFsc1tmbGF0Q29sS2V5XSkge1xuICAgICAgICB0aGlzLmNvbEtleXMucHVzaChmQ29sS2V5KTtcbiAgICAgICAgdGhpcy5jb2xUb3RhbHNbZmxhdENvbEtleV0gPSB0aGlzLmdldEZvcm1hdHRlZEFnZ3JlZ2F0b3IoXG4gICAgICAgICAgcmVjb3JkLFxuICAgICAgICAgIGNvbEtleSxcbiAgICAgICAgKSh0aGlzLCBbXSwgZkNvbEtleSk7XG4gICAgICB9XG4gICAgICB0aGlzLmNvbFRvdGFsc1tmbGF0Q29sS2V5XS5wdXNoKHJlY29yZCk7XG4gICAgICB0aGlzLmNvbFRvdGFsc1tmbGF0Q29sS2V5XS5pc1N1YnRvdGFsID0gaXNDb2xTdWJ0b3RhbDtcbiAgICB9XG5cbiAgICAvLyBBbmQgbm93IGZpbGwgaW4gZm9yIGFsbCB0aGUgc3ViLWNlbGxzLlxuICAgIGZvciAobGV0IHJpID0gcm93U3RhcnQ7IHJpIDw9IHJvd0tleS5sZW5ndGg7IHJpICs9IDEpIHtcbiAgICAgIGlzUm93U3VidG90YWwgPSByaSA8IHJvd0tleS5sZW5ndGg7XG4gICAgICBjb25zdCBmUm93S2V5ID0gcm93S2V5LnNsaWNlKDAsIHJpKTtcbiAgICAgIGNvbnN0IGZsYXRSb3dLZXkgPSBmbGF0S2V5KGZSb3dLZXkpO1xuICAgICAgaWYgKCF0aGlzLnRyZWVbZmxhdFJvd0tleV0pIHtcbiAgICAgICAgdGhpcy50cmVlW2ZsYXRSb3dLZXldID0ge307XG4gICAgICB9XG4gICAgICBmb3IgKGxldCBjaSA9IGNvbFN0YXJ0OyBjaSA8PSBjb2xLZXkubGVuZ3RoOyBjaSArPSAxKSB7XG4gICAgICAgIGlzQ29sU3VidG90YWwgPSBjaSA8IGNvbEtleS5sZW5ndGg7XG4gICAgICAgIGNvbnN0IGZDb2xLZXkgPSBjb2xLZXkuc2xpY2UoMCwgY2kpO1xuICAgICAgICBjb25zdCBmbGF0Q29sS2V5ID0gZmxhdEtleShmQ29sS2V5KTtcbiAgICAgICAgaWYgKCF0aGlzLnRyZWVbZmxhdFJvd0tleV1bZmxhdENvbEtleV0pIHtcbiAgICAgICAgICB0aGlzLnRyZWVbZmxhdFJvd0tleV1bZmxhdENvbEtleV0gPSB0aGlzLmdldEZvcm1hdHRlZEFnZ3JlZ2F0b3IoXG4gICAgICAgICAgICByZWNvcmQsXG4gICAgICAgICAgKSh0aGlzLCBmUm93S2V5LCBmQ29sS2V5KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRyZWVbZmxhdFJvd0tleV1bZmxhdENvbEtleV0ucHVzaChyZWNvcmQpO1xuXG4gICAgICAgIHRoaXMudHJlZVtmbGF0Um93S2V5XVtmbGF0Q29sS2V5XS5pc1Jvd1N1YnRvdGFsID0gaXNSb3dTdWJ0b3RhbDtcbiAgICAgICAgdGhpcy50cmVlW2ZsYXRSb3dLZXldW2ZsYXRDb2xLZXldLmlzQ29sU3VidG90YWwgPSBpc0NvbFN1YnRvdGFsO1xuICAgICAgICB0aGlzLnRyZWVbZmxhdFJvd0tleV1bZmxhdENvbEtleV0uaXNTdWJ0b3RhbCA9XG4gICAgICAgICAgaXNSb3dTdWJ0b3RhbCB8fCBpc0NvbFN1YnRvdGFsO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGdldEFnZ3JlZ2F0b3Iocm93S2V5LCBjb2xLZXkpIHtcbiAgICBsZXQgYWdnO1xuICAgIGNvbnN0IGZsYXRSb3dLZXkgPSBmbGF0S2V5KHJvd0tleSk7XG4gICAgY29uc3QgZmxhdENvbEtleSA9IGZsYXRLZXkoY29sS2V5KTtcbiAgICBpZiAocm93S2V5Lmxlbmd0aCA9PT0gMCAmJiBjb2xLZXkubGVuZ3RoID09PSAwKSB7XG4gICAgICBhZ2cgPSB0aGlzLmFsbFRvdGFsO1xuICAgIH0gZWxzZSBpZiAocm93S2V5Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgYWdnID0gdGhpcy5jb2xUb3RhbHNbZmxhdENvbEtleV07XG4gICAgfSBlbHNlIGlmIChjb2xLZXkubGVuZ3RoID09PSAwKSB7XG4gICAgICBhZ2cgPSB0aGlzLnJvd1RvdGFsc1tmbGF0Um93S2V5XTtcbiAgICB9IGVsc2Uge1xuICAgICAgYWdnID0gdGhpcy50cmVlW2ZsYXRSb3dLZXldW2ZsYXRDb2xLZXldO1xuICAgIH1cbiAgICByZXR1cm4gKFxuICAgICAgYWdnIHx8IHtcbiAgICAgICAgdmFsdWUoKSB7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH0sXG4gICAgICAgIGZvcm1hdCgpIHtcbiAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH0sXG4gICAgICB9XG4gICAgKTtcbiAgfVxufVxuXG4vLyBjYW4gaGFuZGxlIGFycmF5cyBvciBqUXVlcnkgc2VsZWN0aW9ucyBvZiB0YWJsZXNcblBpdm90RGF0YS5mb3JFYWNoUmVjb3JkID0gZnVuY3Rpb24gKGlucHV0LCBwcm9jZXNzUmVjb3JkKSB7XG4gIGlmIChBcnJheS5pc0FycmF5KGlucHV0KSkge1xuICAgIC8vIGFycmF5IG9mIG9iamVjdHNcbiAgICByZXR1cm4gaW5wdXQubWFwKHJlY29yZCA9PiBwcm9jZXNzUmVjb3JkKHJlY29yZCkpO1xuICB9XG4gIHRocm93IG5ldyBFcnJvcih0KCdVbmtub3duIGlucHV0IGZvcm1hdCcpKTtcbn07XG5cblBpdm90RGF0YS5kZWZhdWx0UHJvcHMgPSB7XG4gIGFnZ3JlZ2F0b3JzLFxuICBjb2xzOiBbXSxcbiAgcm93czogW10sXG4gIHZhbHM6IFtdLFxuICBhZ2dyZWdhdG9yTmFtZTogJ0NvdW50JyxcbiAgc29ydGVyczoge30sXG4gIHJvd09yZGVyOiAna2V5X2FfdG9feicsXG4gIGNvbE9yZGVyOiAna2V5X2FfdG9feicsXG59O1xuXG5QaXZvdERhdGEucHJvcFR5cGVzID0ge1xuICBkYXRhOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMuYXJyYXksIFByb3BUeXBlcy5vYmplY3QsIFByb3BUeXBlcy5mdW5jXSlcbiAgICAuaXNSZXF1aXJlZCxcbiAgYWdncmVnYXRvck5hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gIGNvbHM6IFByb3BUeXBlcy5hcnJheU9mKFByb3BUeXBlcy5zdHJpbmcpLFxuICByb3dzOiBQcm9wVHlwZXMuYXJyYXlPZihQcm9wVHlwZXMuc3RyaW5nKSxcbiAgdmFsczogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLnN0cmluZyksXG4gIHZhbHVlRmlsdGVyOiBQcm9wVHlwZXMub2JqZWN0T2YoUHJvcFR5cGVzLm9iamVjdE9mKFByb3BUeXBlcy5ib29sKSksXG4gIHNvcnRlcnM6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgIFByb3BUeXBlcy5mdW5jLFxuICAgIFByb3BUeXBlcy5vYmplY3RPZihQcm9wVHlwZXMuZnVuYyksXG4gIF0pLFxuICBkZXJpdmVkQXR0cmlidXRlczogUHJvcFR5cGVzLm9iamVjdE9mKFByb3BUeXBlcy5mdW5jKSxcbiAgcm93T3JkZXI6IFByb3BUeXBlcy5vbmVPZihbXG4gICAgJ2tleV9hX3RvX3onLFxuICAgICdrZXlfel90b19hJyxcbiAgICAndmFsdWVfYV90b196JyxcbiAgICAndmFsdWVfel90b19hJyxcbiAgXSksXG4gIGNvbE9yZGVyOiBQcm9wVHlwZXMub25lT2YoW1xuICAgICdrZXlfYV90b196JyxcbiAgICAna2V5X3pfdG9fYScsXG4gICAgJ3ZhbHVlX2FfdG9feicsXG4gICAgJ3ZhbHVlX3pfdG9fYScsXG4gIF0pLFxufTtcblxuZXhwb3J0IHtcbiAgYWdncmVnYXRvclRlbXBsYXRlcyxcbiAgYWdncmVnYXRvcnMsXG4gIGRlcml2ZXJzLFxuICBsb2NhbGVzLFxuICBuYXR1cmFsU29ydCxcbiAgbnVtYmVyRm9ybWF0LFxuICBnZXRTb3J0LFxuICBzb3J0QXMsXG4gIGZsYXRLZXksXG4gIFBpdm90RGF0YSxcbn07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./plugins/plugin-chart-pivot-table/src/react-pivottable/utilities.js\n\n}");

/***/ })

}]);